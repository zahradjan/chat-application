{"ast":null,"code":"import { makeAutoObservable, runInAction, toJS } from \"mobx\";\nexport class ChannelStore {\n  constructor(rootStore) {\n    this.rootStore = rootStore;\n    this.room = undefined;\n    this.chatRoomMessagesDb = undefined;\n    this.chatRoomMessages = [];\n    makeAutoObservable(this);\n  }\n\n  async init() {\n    if (this.rootStore.dataStore.ipfsNode === undefined) throw Error(\"IPFS Node not defined!\");\n    if (this.rootStore.dataStore.orbitDb === undefined) throw Error(\"OrbitDb not defined!\");\n    runInAction(async () => {\n      this.room = await this.rootStore.dataStore.ipfsNode.pubsub;\n      this.chatRoomMessagesDb = await this.rootStore.dataStore.orbitDb.feed(\"messages\");\n      await this.chatRoomMessagesDb.load();\n      await this.setMessagesFromDb();\n      console.log(await this.rootStore.dataStore.ipfsNode.pubsub.ls()); // await this.connectToChatRoom(\"FirstChatRoom\");\n    });\n  }\n\n  isChatRoomReady() {\n    return !!this.room;\n  }\n\n  async setMessagesFromDb() {\n    const entries = [];\n    const all = await toJS(this.chatRoomMessagesDb.all);\n    all.map(e => entries.push(e.payload.value));\n    runInAction(() => {\n      this.chatRoomMessages = entries;\n    });\n  }\n\n  async connectToChatRoom(chatRoomName) {\n    runInAction(async () => {\n      await this.room.subscribe(chatRoomName, this.handleReceivingMessages.bind(this));\n    });\n  }\n\n  async handleReceivingMessages(msg) {\n    runInAction(() => {\n      this.chatRoomMessagesDb.add({\n        message: msg\n      });\n      console.log(this.chatRoomMessagesDb.all);\n      this.chatRoomMessages.push(msg);\n      console.log(msg);\n    });\n  }\n\n  async sendMessageToChatRoom(chatRoomName, message) {\n    runInAction(async () => {\n      await this.room.publish(chatRoomName, message);\n    });\n  }\n\n}","map":{"version":3,"names":["makeAutoObservable","runInAction","toJS","ChannelStore","constructor","rootStore","room","undefined","chatRoomMessagesDb","chatRoomMessages","init","dataStore","ipfsNode","Error","orbitDb","pubsub","feed","load","setMessagesFromDb","console","log","ls","isChatRoomReady","entries","all","map","e","push","payload","value","connectToChatRoom","chatRoomName","subscribe","handleReceivingMessages","bind","msg","add","message","sendMessageToChatRoom","publish"],"sources":["C:/Users/zajan/GitHub/chatApplication/src/data/store/ChannelStore.js"],"sourcesContent":["import { makeAutoObservable, runInAction, toJS } from \"mobx\";\r\n\r\nexport class ChannelStore {\r\n  room;\r\n  chatRoomMessagesDb;\r\n  chatRoomMessages;\r\n  constructor(rootStore) {\r\n    this.rootStore = rootStore;\r\n    this.room = undefined;\r\n    this.chatRoomMessagesDb = undefined;\r\n    this.chatRoomMessages = [];\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  async init() {\r\n    if (this.rootStore.dataStore.ipfsNode === undefined) throw Error(\"IPFS Node not defined!\");\r\n    if (this.rootStore.dataStore.orbitDb === undefined) throw Error(\"OrbitDb not defined!\");\r\n    runInAction(async () => {\r\n      this.room = await this.rootStore.dataStore.ipfsNode.pubsub;\r\n      this.chatRoomMessagesDb = await this.rootStore.dataStore.orbitDb.feed(\"messages\");\r\n      await this.chatRoomMessagesDb.load();\r\n      await this.setMessagesFromDb();\r\n      console.log(await this.rootStore.dataStore.ipfsNode.pubsub.ls());\r\n      // await this.connectToChatRoom(\"FirstChatRoom\");\r\n    });\r\n  }\r\n  isChatRoomReady() {\r\n    return !!this.room;\r\n  }\r\n  async setMessagesFromDb() {\r\n    const entries = [];\r\n    const all = await toJS(this.chatRoomMessagesDb.all);\r\n    all.map((e) => entries.push(e.payload.value));\r\n    runInAction(() => {\r\n      this.chatRoomMessages = entries;\r\n    });\r\n  }\r\n\r\n  async connectToChatRoom(chatRoomName) {\r\n    runInAction(async () => {\r\n      await this.room.subscribe(chatRoomName, this.handleReceivingMessages.bind(this));\r\n    });\r\n  }\r\n\r\n  async handleReceivingMessages(msg) {\r\n    runInAction(() => {\r\n      this.chatRoomMessagesDb.add({ message: msg });\r\n      console.log(this.chatRoomMessagesDb.all);\r\n      this.chatRoomMessages.push(msg);\r\n      console.log(msg);\r\n    });\r\n  }\r\n  async sendMessageToChatRoom(chatRoomName, message) {\r\n    runInAction(async () => {\r\n      await this.room.publish(chatRoomName, message);\r\n    });\r\n  }\r\n}\r\n"],"mappings":"AAAA,SAASA,kBAAT,EAA6BC,WAA7B,EAA0CC,IAA1C,QAAsD,MAAtD;AAEA,OAAO,MAAMC,YAAN,CAAmB;EAIxBC,WAAW,CAACC,SAAD,EAAY;IACrB,KAAKA,SAAL,GAAiBA,SAAjB;IACA,KAAKC,IAAL,GAAYC,SAAZ;IACA,KAAKC,kBAAL,GAA0BD,SAA1B;IACA,KAAKE,gBAAL,GAAwB,EAAxB;IACAT,kBAAkB,CAAC,IAAD,CAAlB;EACD;;EAES,MAAJU,IAAI,GAAG;IACX,IAAI,KAAKL,SAAL,CAAeM,SAAf,CAAyBC,QAAzB,KAAsCL,SAA1C,EAAqD,MAAMM,KAAK,CAAC,wBAAD,CAAX;IACrD,IAAI,KAAKR,SAAL,CAAeM,SAAf,CAAyBG,OAAzB,KAAqCP,SAAzC,EAAoD,MAAMM,KAAK,CAAC,sBAAD,CAAX;IACpDZ,WAAW,CAAC,YAAY;MACtB,KAAKK,IAAL,GAAY,MAAM,KAAKD,SAAL,CAAeM,SAAf,CAAyBC,QAAzB,CAAkCG,MAApD;MACA,KAAKP,kBAAL,GAA0B,MAAM,KAAKH,SAAL,CAAeM,SAAf,CAAyBG,OAAzB,CAAiCE,IAAjC,CAAsC,UAAtC,CAAhC;MACA,MAAM,KAAKR,kBAAL,CAAwBS,IAAxB,EAAN;MACA,MAAM,KAAKC,iBAAL,EAAN;MACAC,OAAO,CAACC,GAAR,CAAY,MAAM,KAAKf,SAAL,CAAeM,SAAf,CAAyBC,QAAzB,CAAkCG,MAAlC,CAAyCM,EAAzC,EAAlB,EALsB,CAMtB;IACD,CAPU,CAAX;EAQD;;EACDC,eAAe,GAAG;IAChB,OAAO,CAAC,CAAC,KAAKhB,IAAd;EACD;;EACsB,MAAjBY,iBAAiB,GAAG;IACxB,MAAMK,OAAO,GAAG,EAAhB;IACA,MAAMC,GAAG,GAAG,MAAMtB,IAAI,CAAC,KAAKM,kBAAL,CAAwBgB,GAAzB,CAAtB;IACAA,GAAG,CAACC,GAAJ,CAASC,CAAD,IAAOH,OAAO,CAACI,IAAR,CAAaD,CAAC,CAACE,OAAF,CAAUC,KAAvB,CAAf;IACA5B,WAAW,CAAC,MAAM;MAChB,KAAKQ,gBAAL,GAAwBc,OAAxB;IACD,CAFU,CAAX;EAGD;;EAEsB,MAAjBO,iBAAiB,CAACC,YAAD,EAAe;IACpC9B,WAAW,CAAC,YAAY;MACtB,MAAM,KAAKK,IAAL,CAAU0B,SAAV,CAAoBD,YAApB,EAAkC,KAAKE,uBAAL,CAA6BC,IAA7B,CAAkC,IAAlC,CAAlC,CAAN;IACD,CAFU,CAAX;EAGD;;EAE4B,MAAvBD,uBAAuB,CAACE,GAAD,EAAM;IACjClC,WAAW,CAAC,MAAM;MAChB,KAAKO,kBAAL,CAAwB4B,GAAxB,CAA4B;QAAEC,OAAO,EAAEF;MAAX,CAA5B;MACAhB,OAAO,CAACC,GAAR,CAAY,KAAKZ,kBAAL,CAAwBgB,GAApC;MACA,KAAKf,gBAAL,CAAsBkB,IAAtB,CAA2BQ,GAA3B;MACAhB,OAAO,CAACC,GAAR,CAAYe,GAAZ;IACD,CALU,CAAX;EAMD;;EAC0B,MAArBG,qBAAqB,CAACP,YAAD,EAAeM,OAAf,EAAwB;IACjDpC,WAAW,CAAC,YAAY;MACtB,MAAM,KAAKK,IAAL,CAAUiC,OAAV,CAAkBR,YAAlB,EAAgCM,OAAhC,CAAN;IACD,CAFU,CAAX;EAGD;;AAtDuB"},"metadata":{},"sourceType":"module"}