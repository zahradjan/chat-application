{"ast":null,"code":"import OrbitDB from \"orbit-db\";\nimport IPFS from \"ipfs\";\nimport { makeAutoObservable } from \"mobx\";\nexport default class DataStore {\n  constructor(rootStore) {\n    this.rootStore = rootStore;\n    this.peers = [];\n    makeAutoObservable(this);\n  }\n\n  async init() {\n    // if (!this.rootStore.sessionStore.isAuthenticated()) throw Error(\"User is not defined\");\n    if (this.ipfsNode !== undefined) return;\n    if (this.orbitDb !== undefined) return;\n    const dbConfig = {\n      // If database doesn't exist, create it\n      create: true,\n      // Don't wait to load from the network\n      sync: true,\n      // directory: `/orbitdb/decentio-orbitdb-chat-${Math.random()}}`,\n      // Load only the local version of the database\n      localOnly: false,\n      // Allow anyone to write to the database,\n      // otherwise only the creator of the database can write\n      accessController: {\n        write: [\"*\"]\n      }\n    };\n    const ipfsConfig = {\n      preload: {\n        enabled: false\n      },\n      // relay: { enabled: true, hop: { enabled: true, active: true } },\n      // repo: `/orbitdb/decentio-orbitdb-chat-ipfs-${this.rootStore.sessionStore._user}`,\n      EXPERIMENTAL: {\n        pubsub: true\n      },\n      config: {\n        Addresses: {\n          Swarm: [\"/dns4/wrtc-star2.sjc.dwebops.pub/tcp/443/wss/p2p-webrtc-star/\", \"/dns4/webrtc-star.discovery.libp2p.io/tcp/443/wss/p2p-webrtc-star/\", \"/dns4/wrtc-star1.par.dwebops.pub/tcp/443/wss/p2p-webrtc-star\", \"/dns4/wrtc-star2.sjc.dwebops.pub/tcp/443/wss/p2p-webrtc-star\"]\n        },\n        Bootstrap: []\n      }\n    };\n    await this.start(ipfsConfig, dbConfig);\n  }\n\n  async start(ipfsConf, orbitDbconf) {\n    console.log(this.ipfsNode);\n    console.log(this.orbitDb);\n    await this.startIpfsNode(ipfsConf);\n    await this.startOrbitDb(orbitDbconf);\n    console.log(this.ipfsNode);\n    console.log(this.orbitDb);\n    this.peerId = await this.getPeerId();\n    console.log(this.orbitDb.identity.id); // setInterval(async () => {\n    //   const peers = await this.getIpfsPeers();\n    //   console.log(peers);\n    //   await peers.map(async (peerId) => {\n    //     try {\n    //       // await this.connectToPeer(peerId.peer);\n    //     } catch {}\n    //   });\n    //   // const topics = await this.ipfsNode.pubsub.ls();\n    //   // console.log(topics);\n    // }, 10000);\n\n    const multiaddr = await this.ipfsNode.swarm.localAddrs();\n    console.log(multiaddr); // this.ipfsNode.libp2p.connectionManager.on(\"peer:connect\", this.onPeerConnect.bind(this));\n  }\n\n  async onPeerConnect(connection) {\n    console.log(\"Peer connected:\" + connection.remotePeer._idB58String);\n  }\n\n  async getPeerId() {\n    if (this.ipfsNode === undefined) throw Error(\"IPFS Node not defined\");\n    const peerInfo = await this.ipfsNode.id();\n    return peerInfo.id;\n  }\n\n  async connectToPeer(multiaddr) {\n    let protocol = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"/dns4/webrtc-star.discovery.libp2p.io/tcp/443/wss/p2p-webrtc-star/\";\n\n    try {\n      await this.ipfsNode.swarm.connect(multiaddr);\n    } catch (err) {\n      console.log(err);\n      await this.ipfsNode.swarm.connect(multiaddr);\n    }\n  }\n\n  async startIpfsNode(ipfsConf) {\n    this.ipfsNode = await IPFS.create(ipfsConf);\n  }\n\n  async startOrbitDb(orbitDbconf) {\n    this.orbitDb = await OrbitDB.createInstance(this.ipfsNode, orbitDbconf);\n  }\n\n  async getIpfsPeers() {\n    const peers = await this.ipfsNode.swarm.peers(); // console.log(peers);\n\n    return peers;\n  }\n\n  async handleStop() {\n    await this.orbitDb.disconnect();\n    await this.ipfsNode.stop();\n    delete this.orbitDb;\n    delete this.ipfsNode;\n  }\n\n}","map":{"version":3,"names":["OrbitDB","IPFS","makeAutoObservable","DataStore","constructor","rootStore","peers","init","ipfsNode","undefined","orbitDb","dbConfig","create","sync","localOnly","accessController","write","ipfsConfig","preload","enabled","EXPERIMENTAL","pubsub","config","Addresses","Swarm","Bootstrap","start","ipfsConf","orbitDbconf","console","log","startIpfsNode","startOrbitDb","peerId","getPeerId","identity","id","multiaddr","swarm","localAddrs","onPeerConnect","connection","remotePeer","_idB58String","Error","peerInfo","connectToPeer","protocol","connect","err","createInstance","getIpfsPeers","handleStop","disconnect","stop"],"sources":["C:/Users/zajan/GitHub/chatApplication/src/data/store/DataStore.js"],"sourcesContent":["import OrbitDB from \"orbit-db\";\r\nimport IPFS from \"ipfs\";\r\nimport { makeAutoObservable } from \"mobx\";\r\nexport default class DataStore {\r\n  ipfsNode;\r\n  orbitDb;\r\n  peerId;\r\n  constructor(rootStore) {\r\n    this.rootStore = rootStore;\r\n    this.peers = [];\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  async init() {\r\n    // if (!this.rootStore.sessionStore.isAuthenticated()) throw Error(\"User is not defined\");\r\n    if (this.ipfsNode !== undefined) return;\r\n    if (this.orbitDb !== undefined) return;\r\n\r\n    const dbConfig = {\r\n      // If database doesn't exist, create it\r\n      create: true,\r\n      // Don't wait to load from the network\r\n      sync: true,\r\n      // directory: `/orbitdb/decentio-orbitdb-chat-${Math.random()}}`,\r\n      // Load only the local version of the database\r\n      localOnly: false,\r\n      // Allow anyone to write to the database,\r\n      // otherwise only the creator of the database can write\r\n      accessController: {\r\n        write: [\"*\"],\r\n      },\r\n    };\r\n    const ipfsConfig = {\r\n      preload: { enabled: false },\r\n      // relay: { enabled: true, hop: { enabled: true, active: true } },\r\n      // repo: `/orbitdb/decentio-orbitdb-chat-ipfs-${this.rootStore.sessionStore._user}`,\r\n      EXPERIMENTAL: {\r\n        pubsub: true,\r\n      },\r\n\r\n      config: {\r\n        Addresses: {\r\n          Swarm: [\r\n            \"/dns4/wrtc-star2.sjc.dwebops.pub/tcp/443/wss/p2p-webrtc-star/\",\r\n            \"/dns4/webrtc-star.discovery.libp2p.io/tcp/443/wss/p2p-webrtc-star/\",\r\n            \"/dns4/wrtc-star1.par.dwebops.pub/tcp/443/wss/p2p-webrtc-star\",\r\n            \"/dns4/wrtc-star2.sjc.dwebops.pub/tcp/443/wss/p2p-webrtc-star\",\r\n          ],\r\n        },\r\n        Bootstrap: [],\r\n      },\r\n    };\r\n\r\n    await this.start(ipfsConfig, dbConfig);\r\n  }\r\n\r\n  async start(ipfsConf, orbitDbconf) {\r\n    console.log(this.ipfsNode);\r\n    console.log(this.orbitDb);\r\n    await this.startIpfsNode(ipfsConf);\r\n    await this.startOrbitDb(orbitDbconf);\r\n    console.log(this.ipfsNode);\r\n    console.log(this.orbitDb);\r\n    this.peerId = await this.getPeerId();\r\n    console.log(this.orbitDb.identity.id);\r\n    // setInterval(async () => {\r\n    //   const peers = await this.getIpfsPeers();\r\n    //   console.log(peers);\r\n    //   await peers.map(async (peerId) => {\r\n    //     try {\r\n    //       // await this.connectToPeer(peerId.peer);\r\n    //     } catch {}\r\n    //   });\r\n    //   // const topics = await this.ipfsNode.pubsub.ls();\r\n    //   // console.log(topics);\r\n    // }, 10000);\r\n    const multiaddr = await this.ipfsNode.swarm.localAddrs();\r\n    console.log(multiaddr);\r\n    // this.ipfsNode.libp2p.connectionManager.on(\"peer:connect\", this.onPeerConnect.bind(this));\r\n  }\r\n  async onPeerConnect(connection) {\r\n    console.log(\"Peer connected:\" + connection.remotePeer._idB58String);\r\n  }\r\n\r\n  async getPeerId() {\r\n    if (this.ipfsNode === undefined) throw Error(\"IPFS Node not defined\");\r\n    const peerInfo = await this.ipfsNode.id();\r\n    return peerInfo.id;\r\n  }\r\n\r\n  async connectToPeer(multiaddr, protocol = \"/dns4/webrtc-star.discovery.libp2p.io/tcp/443/wss/p2p-webrtc-star/\") {\r\n    try {\r\n      await this.ipfsNode.swarm.connect(multiaddr);\r\n    } catch (err) {\r\n      console.log(err);\r\n      await this.ipfsNode.swarm.connect(multiaddr);\r\n    }\r\n  }\r\n\r\n  async startIpfsNode(ipfsConf) {\r\n    this.ipfsNode = await IPFS.create(ipfsConf);\r\n  }\r\n  async startOrbitDb(orbitDbconf) {\r\n    this.orbitDb = await OrbitDB.createInstance(this.ipfsNode, orbitDbconf);\r\n  }\r\n  async getIpfsPeers() {\r\n    const peers = await this.ipfsNode.swarm.peers();\r\n    // console.log(peers);\r\n    return peers;\r\n  }\r\n\r\n  async handleStop() {\r\n    await this.orbitDb.disconnect();\r\n    await this.ipfsNode.stop();\r\n    delete this.orbitDb;\r\n    delete this.ipfsNode;\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}