{"ast":null,"code":"'use strict';\n\nvar _regeneratorRuntime = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\n\nvar _asyncToGenerator = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar log = require('debug')('mss:handle');\n\nvar BufferList = require('bl/BufferList');\n\nvar multistream = require('./multistream');\n\nvar handshake = require('it-handshake');\n\nvar _require = require('./constants'),\n    PROTOCOL_ID = _require.PROTOCOL_ID;\n\nmodule.exports = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(stream, protocols) {\n    var _handshake, writer, reader, rest, shakeStream, protocol;\n\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            protocols = Array.isArray(protocols) ? protocols : [protocols];\n            _handshake = handshake(stream), writer = _handshake.writer, reader = _handshake.reader, rest = _handshake.rest, shakeStream = _handshake.stream;\n\n          case 2:\n            if (!true) {\n              _context.next = 24;\n              break;\n            }\n\n            _context.next = 5;\n            return multistream.read(reader);\n\n          case 5:\n            protocol = _context.sent.toString();\n            log('read \"%s\"', protocol);\n\n            if (!(protocol === PROTOCOL_ID)) {\n              _context.next = 11;\n              break;\n            }\n\n            log('respond with \"%s\" for \"%s\"', PROTOCOL_ID, protocol);\n            multistream.write(writer, PROTOCOL_ID);\n            return _context.abrupt(\"continue\", 2);\n\n          case 11:\n            if (!protocols.includes(protocol)) {\n              _context.next = 16;\n              break;\n            }\n\n            multistream.write(writer, protocol);\n            log('respond with \"%s\" for \"%s\"', protocol, protocol);\n            rest();\n            return _context.abrupt(\"return\", {\n              stream: shakeStream,\n              protocol: protocol\n            });\n\n          case 16:\n            if (!(protocol === 'ls')) {\n              _context.next = 20;\n              break;\n            }\n\n            // <varint-msg-len><varint-proto-name-len><proto-name>\\n<varint-proto-name-len><proto-name>\\n\\n\n            multistream.write(writer, new BufferList(protocols.map(function (p) {\n              return multistream.encode(p);\n            })));\n            log('respond with \"%s\" for %s', protocols, protocol);\n            return _context.abrupt(\"continue\", 2);\n\n          case 20:\n            multistream.write(writer, 'na');\n            log('respond with \"na\" for \"%s\"', protocol);\n            _context.next = 2;\n            break;\n\n          case 24:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["log","require","BufferList","multistream","handshake","PROTOCOL_ID","module","exports","stream","protocols","Array","isArray","writer","reader","rest","shakeStream","read","protocol","toString","write","includes","map","p","encode"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/multistream-select/src/handle.js"],"sourcesContent":["'use strict'\n\nconst log = require('debug')('mss:handle')\nconst BufferList = require('bl/BufferList')\nconst multistream = require('./multistream')\nconst handshake = require('it-handshake')\nconst { PROTOCOL_ID } = require('./constants')\n\nmodule.exports = async (stream, protocols) => {\n  protocols = Array.isArray(protocols) ? protocols : [protocols]\n  const { writer, reader, rest, stream: shakeStream } = handshake(stream)\n\n  while (true) {\n    const protocol = (await multistream.read(reader)).toString()\n    log('read \"%s\"', protocol)\n\n    if (protocol === PROTOCOL_ID) {\n      log('respond with \"%s\" for \"%s\"', PROTOCOL_ID, protocol)\n      multistream.write(writer, PROTOCOL_ID)\n      continue\n    }\n\n    if (protocols.includes(protocol)) {\n      multistream.write(writer, protocol)\n      log('respond with \"%s\" for \"%s\"', protocol, protocol)\n      rest()\n      return { stream: shakeStream, protocol }\n    }\n\n    if (protocol === 'ls') {\n      // <varint-msg-len><varint-proto-name-len><proto-name>\\n<varint-proto-name-len><proto-name>\\n\\n\n      multistream.write(writer, new BufferList(\n        protocols.map(p => multistream.encode(p))\n      ))\n      log('respond with \"%s\" for %s', protocols, protocol)\n      continue\n    }\n\n    multistream.write(writer, 'na')\n    log('respond with \"na\" for \"%s\"', protocol)\n  }\n}\n"],"mappings":"AAAA;;;;;;AAEA,IAAMA,GAAG,GAAGC,OAAO,CAAC,OAAD,CAAP,CAAiB,YAAjB,CAAZ;;AACA,IAAMC,UAAU,GAAGD,OAAO,CAAC,eAAD,CAA1B;;AACA,IAAME,WAAW,GAAGF,OAAO,CAAC,eAAD,CAA3B;;AACA,IAAMG,SAAS,GAAGH,OAAO,CAAC,cAAD,CAAzB;;AACA,eAAwBA,OAAO,CAAC,aAAD,CAA/B;AAAA,IAAQI,WAAR,YAAQA,WAAR;;AAEAC,MAAM,CAACC,OAAP;EAAA,sEAAiB,iBAAOC,MAAP,EAAeC,SAAf;IAAA;;IAAA;MAAA;QAAA;UAAA;YACfA,SAAS,GAAGC,KAAK,CAACC,OAAN,CAAcF,SAAd,IAA2BA,SAA3B,GAAuC,CAACA,SAAD,CAAnD;YADe,aAEuCL,SAAS,CAACI,MAAD,CAFhD,EAEPI,MAFO,cAEPA,MAFO,EAECC,MAFD,cAECA,MAFD,EAESC,IAFT,cAESA,IAFT,EAEuBC,WAFvB,cAEeP,MAFf;;UAAA;YAAA,KAIR,IAJQ;cAAA;cAAA;YAAA;;YAAA;YAAA,OAKWL,WAAW,CAACa,IAAZ,CAAiBH,MAAjB,CALX;;UAAA;YAKPI,QALO,iBAKqCC,QALrC;YAMblB,GAAG,CAAC,WAAD,EAAciB,QAAd,CAAH;;YANa,MAQTA,QAAQ,KAAKZ,WARJ;cAAA;cAAA;YAAA;;YASXL,GAAG,CAAC,4BAAD,EAA+BK,WAA/B,EAA4CY,QAA5C,CAAH;YACAd,WAAW,CAACgB,KAAZ,CAAkBP,MAAlB,EAA0BP,WAA1B;YAVW;;UAAA;YAAA,KAcTI,SAAS,CAACW,QAAV,CAAmBH,QAAnB,CAdS;cAAA;cAAA;YAAA;;YAeXd,WAAW,CAACgB,KAAZ,CAAkBP,MAAlB,EAA0BK,QAA1B;YACAjB,GAAG,CAAC,4BAAD,EAA+BiB,QAA/B,EAAyCA,QAAzC,CAAH;YACAH,IAAI;YAjBO,iCAkBJ;cAAEN,MAAM,EAAEO,WAAV;cAAuBE,QAAQ,EAARA;YAAvB,CAlBI;;UAAA;YAAA,MAqBTA,QAAQ,KAAK,IArBJ;cAAA;cAAA;YAAA;;YAsBX;YACAd,WAAW,CAACgB,KAAZ,CAAkBP,MAAlB,EAA0B,IAAIV,UAAJ,CACxBO,SAAS,CAACY,GAAV,CAAc,UAAAC,CAAC;cAAA,OAAInB,WAAW,CAACoB,MAAZ,CAAmBD,CAAnB,CAAJ;YAAA,CAAf,CADwB,CAA1B;YAGAtB,GAAG,CAAC,0BAAD,EAA6BS,SAA7B,EAAwCQ,QAAxC,CAAH;YA1BW;;UAAA;YA8Bbd,WAAW,CAACgB,KAAZ,CAAkBP,MAAlB,EAA0B,IAA1B;YACAZ,GAAG,CAAC,4BAAD,EAA+BiB,QAA/B,CAAH;YA/Ba;YAAA;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAAjB;;EAAA;IAAA;EAAA;AAAA"},"metadata":{},"sourceType":"script"}