{"ast":null,"code":"'use strict';\n\nvar inherits = require('inherits');\n\nvar AbstractIterator = require('abstract-leveldown').AbstractIterator;\n\nvar createKeyRange = require('./util/key-range');\n\nvar deserialize = require('./util/deserialize');\n\nvar noop = function noop() {};\n\nmodule.exports = Iterator;\n\nfunction Iterator(db, location, options) {\n  AbstractIterator.call(this, db);\n  this._limit = options.limit;\n  this._count = 0;\n  this._callback = null;\n  this._cache = [];\n  this._completed = false;\n  this._aborted = false;\n  this._error = null;\n  this._transaction = null;\n  this._keys = options.keys;\n  this._values = options.values;\n  this._keyAsBuffer = options.keyAsBuffer;\n  this._valueAsBuffer = options.valueAsBuffer;\n\n  if (this._limit === 0) {\n    this._completed = true;\n    return;\n  }\n\n  var keyRange;\n\n  try {\n    keyRange = createKeyRange(options);\n  } catch (e) {\n    // The lower key is greater than the upper key.\n    // IndexedDB throws an error, but we'll just return 0 results.\n    this._completed = true;\n    return;\n  }\n\n  this.createIterator(location, keyRange, options.reverse);\n}\n\ninherits(Iterator, AbstractIterator);\n\nIterator.prototype.createIterator = function (location, keyRange, reverse) {\n  var _this = this;\n\n  var transaction = this.db.db.transaction([location], 'readonly');\n  var store = transaction.objectStore(location);\n  var req = store.openCursor(keyRange, reverse ? 'prev' : 'next');\n\n  req.onsuccess = function (ev) {\n    var cursor = ev.target.result;\n    if (cursor) _this.onItem(cursor);\n  };\n\n  this._transaction = transaction; // If an error occurs (on the request), the transaction will abort.\n\n  transaction.onabort = function () {\n    _this.onAbort(_this._transaction.error || new Error('aborted by user'));\n  };\n\n  transaction.oncomplete = function () {\n    _this.onComplete();\n  };\n};\n\nIterator.prototype.onItem = function (cursor) {\n  this._cache.push(cursor.key, cursor.value);\n\n  if (this._limit <= 0 || ++this._count < this._limit) {\n    cursor.continue();\n  }\n\n  this.maybeNext();\n};\n\nIterator.prototype.onAbort = function (err) {\n  this._aborted = true;\n  this._error = err;\n  this.maybeNext();\n};\n\nIterator.prototype.onComplete = function () {\n  this._completed = true;\n  this.maybeNext();\n};\n\nIterator.prototype.maybeNext = function () {\n  if (this._callback) {\n    this._next(this._callback);\n\n    this._callback = null;\n  }\n};\n\nIterator.prototype._next = function (callback) {\n  if (this._aborted) {\n    // The error should be picked up by either next() or end().\n    var err = this._error;\n    this._error = null;\n\n    this._nextTick(callback, err);\n  } else if (this._cache.length > 0) {\n    var key = this._cache.shift();\n\n    var value = this._cache.shift();\n\n    if (this._keys && key !== undefined) {\n      key = this._deserializeKey(key, this._keyAsBuffer);\n    } else {\n      key = undefined;\n    }\n\n    if (this._values && value !== undefined) {\n      value = this._deserializeValue(value, this._valueAsBuffer);\n    } else {\n      value = undefined;\n    }\n\n    this._nextTick(callback, null, key, value);\n  } else if (this._completed) {\n    this._nextTick(callback);\n  } else {\n    this._callback = callback;\n  }\n}; // Exposed for the v4 to v5 upgrade utility\n\n\nIterator.prototype._deserializeKey = deserialize;\nIterator.prototype._deserializeValue = deserialize;\n\nIterator.prototype._end = function (callback) {\n  if (this._aborted || this._completed) {\n    return this._nextTick(callback, this._error);\n  } // Don't advance the cursor anymore, and the transaction will complete\n  // on its own in the next tick. This approach is much cleaner than calling\n  // transaction.abort() with its unpredictable event order.\n\n\n  this.onItem = noop;\n  this.onAbort = callback;\n  this.onComplete = callback;\n};","map":{"version":3,"names":["inherits","require","AbstractIterator","createKeyRange","deserialize","noop","module","exports","Iterator","db","location","options","call","_limit","limit","_count","_callback","_cache","_completed","_aborted","_error","_transaction","_keys","keys","_values","values","_keyAsBuffer","keyAsBuffer","_valueAsBuffer","valueAsBuffer","keyRange","e","createIterator","reverse","prototype","transaction","store","objectStore","req","openCursor","onsuccess","ev","cursor","target","result","onItem","onabort","onAbort","error","Error","oncomplete","onComplete","push","key","value","continue","maybeNext","err","_next","callback","_nextTick","length","shift","undefined","_deserializeKey","_deserializeValue","_end"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/level-js/iterator.js"],"sourcesContent":["'use strict'\n\nconst inherits = require('inherits')\nconst AbstractIterator = require('abstract-leveldown').AbstractIterator\nconst createKeyRange = require('./util/key-range')\nconst deserialize = require('./util/deserialize')\nconst noop = function () {}\n\nmodule.exports = Iterator\n\nfunction Iterator (db, location, options) {\n  AbstractIterator.call(this, db)\n\n  this._limit = options.limit\n  this._count = 0\n  this._callback = null\n  this._cache = []\n  this._completed = false\n  this._aborted = false\n  this._error = null\n  this._transaction = null\n\n  this._keys = options.keys\n  this._values = options.values\n  this._keyAsBuffer = options.keyAsBuffer\n  this._valueAsBuffer = options.valueAsBuffer\n\n  if (this._limit === 0) {\n    this._completed = true\n    return\n  }\n\n  let keyRange\n\n  try {\n    keyRange = createKeyRange(options)\n  } catch (e) {\n    // The lower key is greater than the upper key.\n    // IndexedDB throws an error, but we'll just return 0 results.\n    this._completed = true\n    return\n  }\n\n  this.createIterator(location, keyRange, options.reverse)\n}\n\ninherits(Iterator, AbstractIterator)\n\nIterator.prototype.createIterator = function (location, keyRange, reverse) {\n  const transaction = this.db.db.transaction([location], 'readonly')\n  const store = transaction.objectStore(location)\n  const req = store.openCursor(keyRange, reverse ? 'prev' : 'next')\n\n  req.onsuccess = (ev) => {\n    const cursor = ev.target.result\n    if (cursor) this.onItem(cursor)\n  }\n\n  this._transaction = transaction\n\n  // If an error occurs (on the request), the transaction will abort.\n  transaction.onabort = () => {\n    this.onAbort(this._transaction.error || new Error('aborted by user'))\n  }\n\n  transaction.oncomplete = () => {\n    this.onComplete()\n  }\n}\n\nIterator.prototype.onItem = function (cursor) {\n  this._cache.push(cursor.key, cursor.value)\n\n  if (this._limit <= 0 || ++this._count < this._limit) {\n    cursor.continue()\n  }\n\n  this.maybeNext()\n}\n\nIterator.prototype.onAbort = function (err) {\n  this._aborted = true\n  this._error = err\n  this.maybeNext()\n}\n\nIterator.prototype.onComplete = function () {\n  this._completed = true\n  this.maybeNext()\n}\n\nIterator.prototype.maybeNext = function () {\n  if (this._callback) {\n    this._next(this._callback)\n    this._callback = null\n  }\n}\n\nIterator.prototype._next = function (callback) {\n  if (this._aborted) {\n    // The error should be picked up by either next() or end().\n    const err = this._error\n    this._error = null\n    this._nextTick(callback, err)\n  } else if (this._cache.length > 0) {\n    let key = this._cache.shift()\n    let value = this._cache.shift()\n\n    if (this._keys && key !== undefined) {\n      key = this._deserializeKey(key, this._keyAsBuffer)\n    } else {\n      key = undefined\n    }\n\n    if (this._values && value !== undefined) {\n      value = this._deserializeValue(value, this._valueAsBuffer)\n    } else {\n      value = undefined\n    }\n\n    this._nextTick(callback, null, key, value)\n  } else if (this._completed) {\n    this._nextTick(callback)\n  } else {\n    this._callback = callback\n  }\n}\n\n// Exposed for the v4 to v5 upgrade utility\nIterator.prototype._deserializeKey = deserialize\nIterator.prototype._deserializeValue = deserialize\n\nIterator.prototype._end = function (callback) {\n  if (this._aborted || this._completed) {\n    return this._nextTick(callback, this._error)\n  }\n\n  // Don't advance the cursor anymore, and the transaction will complete\n  // on its own in the next tick. This approach is much cleaner than calling\n  // transaction.abort() with its unpredictable event order.\n  this.onItem = noop\n  this.onAbort = callback\n  this.onComplete = callback\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}