{"ast":null,"code":"'use strict';\n\nvar BufferList = require('bl/BufferList.js');\n\nvar rabinWasm = require('rabin-wasm');\n\nvar errCode = require('err-code');\n\nfunction _interopDefaultLegacy(e) {\n  return e && typeof e === 'object' && 'default' in e ? e : {\n    'default': e\n  };\n}\n\nvar BufferList__default = /*#__PURE__*/_interopDefaultLegacy(BufferList);\n\nvar errCode__default = /*#__PURE__*/_interopDefaultLegacy(errCode);\n\nasync function* rabinChunker(source, options) {\n  let min, max, avg;\n\n  if (options.minChunkSize && options.maxChunkSize && options.avgChunkSize) {\n    avg = options.avgChunkSize;\n    min = options.minChunkSize;\n    max = options.maxChunkSize;\n  } else if (!options.avgChunkSize) {\n    throw errCode__default[\"default\"](new Error('please specify an average chunk size'), 'ERR_INVALID_AVG_CHUNK_SIZE');\n  } else {\n    avg = options.avgChunkSize;\n    min = avg / 3;\n    max = avg + avg / 2;\n  }\n\n  if (min < 16) {\n    throw errCode__default[\"default\"](new Error('rabin min must be greater than 16'), 'ERR_INVALID_MIN_CHUNK_SIZE');\n  }\n\n  if (max < min) {\n    max = min;\n  }\n\n  if (avg < min) {\n    avg = min;\n  }\n\n  const sizepow = Math.floor(Math.log2(avg));\n\n  for await (const chunk of rabin(source, {\n    min: min,\n    max: max,\n    bits: sizepow,\n    window: options.window,\n    polynomial: options.polynomial\n  })) {\n    yield chunk;\n  }\n}\n\nasync function* rabin(source, options) {\n  const r = await rabinWasm.create(options.bits, options.min, options.max, options.window);\n  const buffers = new BufferList__default[\"default\"]();\n\n  for await (const chunk of source) {\n    buffers.append(chunk);\n    const sizes = r.fingerprint(chunk);\n\n    for (let i = 0; i < sizes.length; i++) {\n      const size = sizes[i];\n      const buf = buffers.slice(0, size);\n      buffers.consume(size);\n      yield buf;\n    }\n  }\n\n  if (buffers.length) {\n    yield buffers.slice(0);\n  }\n}\n\nmodule.exports = rabinChunker;","map":{"version":3,"names":["BufferList","require","rabinWasm","errCode","_interopDefaultLegacy","e","BufferList__default","errCode__default","rabinChunker","source","options","min","max","avg","minChunkSize","maxChunkSize","avgChunkSize","Error","sizepow","Math","floor","log2","chunk","rabin","bits","window","polynomial","r","create","buffers","append","sizes","fingerprint","i","length","size","buf","slice","consume","module","exports"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/ipfs-unixfs-importer/cjs/src/chunker/rabin.js"],"sourcesContent":["'use strict';\n\nvar BufferList = require('bl/BufferList.js');\nvar rabinWasm = require('rabin-wasm');\nvar errCode = require('err-code');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar BufferList__default = /*#__PURE__*/_interopDefaultLegacy(BufferList);\nvar errCode__default = /*#__PURE__*/_interopDefaultLegacy(errCode);\n\nasync function* rabinChunker(source, options) {\n  let min, max, avg;\n  if (options.minChunkSize && options.maxChunkSize && options.avgChunkSize) {\n    avg = options.avgChunkSize;\n    min = options.minChunkSize;\n    max = options.maxChunkSize;\n  } else if (!options.avgChunkSize) {\n    throw errCode__default[\"default\"](new Error('please specify an average chunk size'), 'ERR_INVALID_AVG_CHUNK_SIZE');\n  } else {\n    avg = options.avgChunkSize;\n    min = avg / 3;\n    max = avg + avg / 2;\n  }\n  if (min < 16) {\n    throw errCode__default[\"default\"](new Error('rabin min must be greater than 16'), 'ERR_INVALID_MIN_CHUNK_SIZE');\n  }\n  if (max < min) {\n    max = min;\n  }\n  if (avg < min) {\n    avg = min;\n  }\n  const sizepow = Math.floor(Math.log2(avg));\n  for await (const chunk of rabin(source, {\n      min: min,\n      max: max,\n      bits: sizepow,\n      window: options.window,\n      polynomial: options.polynomial\n    })) {\n    yield chunk;\n  }\n}\nasync function* rabin(source, options) {\n  const r = await rabinWasm.create(options.bits, options.min, options.max, options.window);\n  const buffers = new BufferList__default[\"default\"]();\n  for await (const chunk of source) {\n    buffers.append(chunk);\n    const sizes = r.fingerprint(chunk);\n    for (let i = 0; i < sizes.length; i++) {\n      const size = sizes[i];\n      const buf = buffers.slice(0, size);\n      buffers.consume(size);\n      yield buf;\n    }\n  }\n  if (buffers.length) {\n    yield buffers.slice(0);\n  }\n}\n\nmodule.exports = rabinChunker;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}