{"ast":null,"code":"import IpfsPubsubPeerMonitor from \"ipfs-pubsub-peer-monitor\";\nimport { makeAutoObservable, runInAction, toJS } from \"mobx\";\nexport class MonitorStore {\n  constructor(rootStore) {\n    this.rootStore = rootStore;\n    this.monitor = undefined;\n    this.peersDb = undefined;\n    this.peers = [];\n    this.errorMessage = \"\";\n    this.login = \"Login\";\n    this.topicName = \"DecentioGlobalNetwork\";\n    this.texDecoder = new TextDecoder();\n    makeAutoObservable(this);\n  }\n\n  async init() {\n    if (this.rootStore.dataStore.ipfsNode === undefined) throw Error(\"IPFS Node not defined!\");\n    if (this.rootStore.dataStore.orbitDb === undefined) throw Error(\"OrbitDb not defined!\");\n    runInAction(async () => {\n      await this.subscribeToOwnPubsub();\n      await this.subscribeToDecentioPubsub();\n      await this.loadPeersDb();\n      await this.setPeersFromDb();\n      this.monitor = new IpfsPubsubPeerMonitor(this.rootStore.dataStore.ipfsNode.pubsub, this.topicName);\n      await this.listenForJoinedPeers();\n      await this.listenForLeftPeers();\n    });\n  }\n\n  async isMonitorReady() {\n    return !!this.monitor;\n  }\n\n  async setPeersFromDb() {\n    const all = await toJS(this.peersDb.all);\n    runInAction(() => {\n      all.map(e => {\n        // console.log(e.payload.value);\n        return this.peers.push(e.payload.value);\n      });\n    });\n  }\n\n  async listenForJoinedPeers() {\n    this.monitor.on(\"join\", async peerJoined => {\n      console.log(\"Peer joined: \" + peerJoined);\n      console.log(`Peers on Pubsub ${this.topicName}: ` + (await this.monitor.getPeers()));\n      setTimeout(async () => {\n        let peerInDb = this.peerIsInDb(peerJoined);\n\n        if (!peerInDb) {\n          await this.sendUserDbId(peerJoined); // await this.sendPeersDbId(peerJoined);\n        }\n      }, 2000);\n    });\n  }\n\n  async listenForLeftPeers() {\n    this.monitor.on(\"leave\", async peerLeft => {\n      console.log(\"Peer left: \" + peerLeft);\n      console.log(`Peers on Pubsub ${this.topicName}: ` + (await this.monitor.getPeers()));\n      const peersFiltered = this.peers.filter(item => item.data.user.peerId !== peerLeft);\n      console.log(peersFiltered);\n      this.peers = peersFiltered;\n    });\n  }\n\n  setErrorMessage(errorMessage) {\n    this.errorMessage = errorMessage;\n  }\n\n  peerIsInDb(dbIdentity) {\n    console.log(dbIdentity);\n    const peers = toJS(this.peers);\n    console.log(toJS(this.peers));\n    return peers.find(item => item.identity === dbIdentity);\n  }\n\n  setLoginForm() {\n    this.login = \"Login\";\n  }\n\n  setSignUpForm() {\n    this.login = \"SignUp\";\n  }\n\n  isLoginForm() {\n    return this.login === \"Login\";\n  }\n\n  userAlreadyExist(user) {\n    console.log(user);\n    const peers = toJS(this.peers);\n    console.log(toJS(this.peers));\n    const existingUser = this.peersDb.iterator({\n      limit: -1\n    }).collect().find(item => item.payload.value.data.user._username === user);\n    return existingUser; // return peers.find((item) => item.data.user._username === user);\n  } // passwordCorrect(user) {\n  //   console.log(user);\n  //   const peers = toJS(this.peers);\n  //   console.log(toJS(this.peers));\n  //   return peers.find((item) => item.user._username === user);\n  // }\n\n\n  async savePeer(peer) {\n    runInAction(async () => {\n      console.log(!this.peerIsInDb(peer));\n\n      if (!this.peerIsInDb(peer)) {\n        this.peers.push(peer);\n        await this.peersDb.add(peer);\n      }\n    });\n  }\n\n  async removePeer(peer) {\n    const entry = await this.peersDb.iterator().collect().map(item => item.payload.value === peer ? item : undefined);\n    console.log(entry);\n\n    if (entry) {\n      await this.peersDb.remove(entry[0].hash);\n    }\n  }\n\n  async sendUserDbId(peer) {\n    const userDbId = await this.rootStore.userStore.getUserDbId();\n    const stringifyPayload = JSON.stringify({\n      userDb: userDbId\n    });\n    console.log(stringifyPayload);\n    await this.rootStore.dataStore.ipfsNode.pubsub.publish(peer, stringifyPayload);\n  }\n\n  async sendPeersDbId(peer) {\n    const peerDbId = await this.peersDb.id;\n    const stringifyPayload = JSON.stringify({\n      peersDb: peerDbId\n    });\n    console.log(stringifyPayload);\n    await this.rootStore.dataStore.ipfsNode.pubsub.publish(peer, stringifyPayload);\n  }\n\n  async subscribeToOwnPubsub() {\n    const peerInfoId = this.rootStore.dataStore.peerId;\n    console.log(\"Peer ID: \" + peerInfoId);\n    await this.rootStore.dataStore.ipfsNode.pubsub.subscribe(peerInfoId, async msg => {\n      if (typeof msg.data === \"object\") msg.data = this.texDecoder.decode(msg.data);\n      const parsedMsg = JSON.parse(msg.data);\n\n      if (parsedMsg.userDb) {\n        await this.replicateUserDb(parsedMsg);\n      }\n\n      if (parsedMsg.peersDb) {\n        await this.replicatePeersDb(parsedMsg);\n      }\n\n      if (parsedMsg.roomName) {\n        console.log(parsedMsg.roomName);\n        let room = this.rootStore.roomStore.getRoom(parsedMsg.roomName);\n\n        if (!room) {\n          room = await this.rootStore.roomStore.createRoom(parsedMsg.roomName);\n          room.setRoomUser(msg.from);\n          room.init();\n        }\n      } // let targetRoom;\n      // if (parsedMsg.userDb) {\n      //   await this.replicateUserDb(parsedMsg);\n      //   targetRoom = await this.rootStore.roomStore.createRoom(msg.from);\n      //   await targetRoom.init();\n      // } else {\n      //   targetRoom = this.rootStore.roomStore.getRoom(msg.from);\n      //   console.log(targetRoom);\n      // }\n      // if (targetRoom) {\n      //   targetRoom.setMessage(msg);\n      // }\n\n    });\n  }\n\n  async subscribeToDecentioPubsub() {\n    await this.rootStore.dataStore.ipfsNode.pubsub.subscribe(\"DecentioGlobalNetwork\", () => {});\n  }\n\n  async replicateUserDb(parsedMsg) {\n    console.log(parsedMsg.userDb);\n    var peerDbOuter = await this.rootStore.dataStore.orbitDb.open(parsedMsg.userDb);\n    console.log(peerDbOuter);\n    await peerDbOuter.load();\n    peerDbOuter.events.on(\"replicated\", async () => {\n      console.log(\"DB replicated\");\n      const db = {\n        identity: parsedMsg.userDb,\n        data: peerDbOuter.all\n      };\n      console.log(db);\n      await this.peersDb.add(db);\n      console.log(this.peersDb.all);\n      this.peers.push(db);\n    });\n  }\n\n  async replicatePeersDb(parsedMsg) {\n    console.log(parsedMsg.peersDb);\n    var peerDbOuter = await this.rootStore.dataStore.orbitDb.open(parsedMsg.peersDb);\n    console.log(peerDbOuter);\n    await peerDbOuter.load();\n    peerDbOuter.events.on(\"replicated\", async () => {\n      console.log(\"DB replicated\");\n      const db = {\n        identity: parsedMsg.peersDb,\n        data: peerDbOuter.all\n      };\n      if (this.peerIsInDb(parsedMsg.peersDb)) return;\n      console.log(db);\n      await this.peersDb.add(db);\n      console.log(this.peersDb.all);\n      this.peers.push(db);\n    });\n  }\n\n  async loadPeersDb() {\n    this.peersDb = await this.rootStore.dataStore.orbitDb.feed(\"peers\");\n    await this.peersDb.load();\n  } // async replicatePeersDB() {\n  //   const nodeId = await this.rootStore.dataStore.getPeerId();\n  //   const peersDbId = await this.peersDb.id;\n  //   console.log(nodeId);\n  //   await this.peersDb.all.map((peer) => {\n  //     const peerId = peer.payload.value;\n  //     console.log(peerId);\n  //     console.log(peersDbId);\n  //     const stringifyPayload = JSON.stringify({ peerDb: peersDbId });\n  //     this.rootStore.dataStore.ipfsNode.pubsub.publish(peerId, stringifyPayload);\n  //   });\n  // }\n\n\n  async removeDuplicateUser(duplicateUser) {\n    console.log(duplicateUser);\n    this.peers = this.peers.filter(item => item.data.user._username != duplicateUser.payload.value.data.user._username);\n    await this.peersDb.remove(duplicateUser.hash); // console.log(index);\n    // if (index > -1) {\n    //   // only splice array when item is found\n    //   this.peers.splice(index, 1);\n    //   // 2nd parameter means remove one item only\n    // }\n  }\n\n  async queryCatalog(queryFn) {\n    //  const dbAddrs = Object.values(this.peersDb.all).map(peer => peer.pieces)\n    const allPieces = await Promise.all(this.peersDb.all.map(async addr => {\n      const db = await this.rootStore.dataStore.orbitDb.open(addr);\n      await db.load();\n      return db.query(queryFn);\n    })); // return allPieces.reduce((flatPieces, pieces) => flatPieces.concat(pieces), this.pieces.query(queryFn))\n  }\n\n  processMessage(msg) {\n    if (typeof msg.data === \"object\") msg.data = this.texDecoder.decode(msg.data);\n  }\n\n  async getPeersDbId() {\n    const id = await this.peersDb.id;\n    return id;\n  }\n\n  filterDuplicates(array) {\n    let uniqueChars = array.filter((element, index) => {\n      return array.indexOf(element) === index;\n    });\n    return uniqueChars;\n  }\n\n}","map":{"version":3,"names":["IpfsPubsubPeerMonitor","makeAutoObservable","runInAction","toJS","MonitorStore","constructor","rootStore","monitor","undefined","peersDb","peers","errorMessage","login","topicName","texDecoder","TextDecoder","init","dataStore","ipfsNode","Error","orbitDb","subscribeToOwnPubsub","subscribeToDecentioPubsub","loadPeersDb","setPeersFromDb","pubsub","listenForJoinedPeers","listenForLeftPeers","isMonitorReady","all","map","e","push","payload","value","on","peerJoined","console","log","getPeers","setTimeout","peerInDb","peerIsInDb","sendUserDbId","peerLeft","peersFiltered","filter","item","data","user","peerId","setErrorMessage","dbIdentity","find","identity","setLoginForm","setSignUpForm","isLoginForm","userAlreadyExist","existingUser","iterator","limit","collect","_username","savePeer","peer","add","removePeer","entry","remove","hash","userDbId","userStore","getUserDbId","stringifyPayload","JSON","stringify","userDb","publish","sendPeersDbId","peerDbId","id","peerInfoId","subscribe","msg","decode","parsedMsg","parse","replicateUserDb","replicatePeersDb","roomName","room","roomStore","getRoom","createRoom","setRoomUser","from","peerDbOuter","open","load","events","db","feed","removeDuplicateUser","duplicateUser","queryCatalog","queryFn","allPieces","Promise","addr","query","processMessage","getPeersDbId","filterDuplicates","array","uniqueChars","element","index","indexOf"],"sources":["C:/Users/zajan/GitHub/chatApplication/src/data/store/MonitorStore.js"],"sourcesContent":["import IpfsPubsubPeerMonitor from \"ipfs-pubsub-peer-monitor\";\r\nimport { makeAutoObservable, runInAction, toJS } from \"mobx\";\r\n\r\nexport class MonitorStore {\r\n  monitor;\r\n  topicName;\r\n  peers;\r\n  peersDb;\r\n  texDecoder;\r\n  errorMessage;\r\n  login;\r\n  constructor(rootStore) {\r\n    this.rootStore = rootStore;\r\n    this.monitor = undefined;\r\n    this.peersDb = undefined;\r\n    this.peers = [];\r\n    this.errorMessage = \"\";\r\n    this.login = \"Login\";\r\n    this.topicName = \"DecentioGlobalNetwork\";\r\n    this.texDecoder = new TextDecoder();\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  async init() {\r\n    if (this.rootStore.dataStore.ipfsNode === undefined) throw Error(\"IPFS Node not defined!\");\r\n    if (this.rootStore.dataStore.orbitDb === undefined) throw Error(\"OrbitDb not defined!\");\r\n    runInAction(async () => {\r\n      await this.subscribeToOwnPubsub();\r\n      await this.subscribeToDecentioPubsub();\r\n      await this.loadPeersDb();\r\n      await this.setPeersFromDb();\r\n      this.monitor = new IpfsPubsubPeerMonitor(this.rootStore.dataStore.ipfsNode.pubsub, this.topicName);\r\n      await this.listenForJoinedPeers();\r\n      await this.listenForLeftPeers();\r\n    });\r\n  }\r\n  async isMonitorReady() {\r\n    return !!this.monitor;\r\n  }\r\n\r\n  async setPeersFromDb() {\r\n    const all = await toJS(this.peersDb.all);\r\n    runInAction(() => {\r\n      all.map((e) => {\r\n        // console.log(e.payload.value);\r\n        return this.peers.push(e.payload.value);\r\n      });\r\n    });\r\n  }\r\n\r\n  async listenForJoinedPeers() {\r\n    this.monitor.on(\"join\", async (peerJoined) => {\r\n      console.log(\"Peer joined: \" + peerJoined);\r\n      console.log(`Peers on Pubsub ${this.topicName}: ` + (await this.monitor.getPeers()));\r\n      setTimeout(async () => {\r\n        let peerInDb = this.peerIsInDb(peerJoined);\r\n\r\n        if (!peerInDb) {\r\n          await this.sendUserDbId(peerJoined);\r\n          // await this.sendPeersDbId(peerJoined);\r\n        }\r\n      }, 2000);\r\n    });\r\n  }\r\n\r\n  async listenForLeftPeers() {\r\n    this.monitor.on(\"leave\", async (peerLeft) => {\r\n      console.log(\"Peer left: \" + peerLeft);\r\n      console.log(`Peers on Pubsub ${this.topicName}: ` + (await this.monitor.getPeers()));\r\n      const peersFiltered = this.peers.filter((item) => item.data.user.peerId !== peerLeft);\r\n      console.log(peersFiltered);\r\n      this.peers = peersFiltered;\r\n    });\r\n  }\r\n  setErrorMessage(errorMessage) {\r\n    this.errorMessage = errorMessage;\r\n  }\r\n\r\n  peerIsInDb(dbIdentity) {\r\n    console.log(dbIdentity);\r\n    const peers = toJS(this.peers);\r\n    console.log(toJS(this.peers));\r\n    return peers.find((item) => item.identity === dbIdentity);\r\n  }\r\n\r\n  setLoginForm() {\r\n    this.login = \"Login\";\r\n  }\r\n  setSignUpForm() {\r\n    this.login = \"SignUp\";\r\n  }\r\n\r\n  isLoginForm() {\r\n    return this.login === \"Login\";\r\n  }\r\n\r\n  userAlreadyExist(user) {\r\n    console.log(user);\r\n    const peers = toJS(this.peers);\r\n    console.log(toJS(this.peers));\r\n\r\n    const existingUser = this.peersDb\r\n      .iterator({ limit: -1 })\r\n      .collect()\r\n      .find((item) => item.payload.value.data.user._username === user);\r\n    return existingUser;\r\n    // return peers.find((item) => item.data.user._username === user);\r\n  }\r\n\r\n  // passwordCorrect(user) {\r\n  //   console.log(user);\r\n  //   const peers = toJS(this.peers);\r\n  //   console.log(toJS(this.peers));\r\n  //   return peers.find((item) => item.user._username === user);\r\n  // }\r\n\r\n  async savePeer(peer) {\r\n    runInAction(async () => {\r\n      console.log(!this.peerIsInDb(peer));\r\n      if (!this.peerIsInDb(peer)) {\r\n        this.peers.push(peer);\r\n        await this.peersDb.add(peer);\r\n      }\r\n    });\r\n  }\r\n  async removePeer(peer) {\r\n    const entry = await this.peersDb\r\n      .iterator()\r\n      .collect()\r\n      .map((item) => (item.payload.value === peer ? item : undefined));\r\n    console.log(entry);\r\n    if (entry) {\r\n      await this.peersDb.remove(entry[0].hash);\r\n    }\r\n  }\r\n  async sendUserDbId(peer) {\r\n    const userDbId = await this.rootStore.userStore.getUserDbId();\r\n\r\n    const stringifyPayload = JSON.stringify({ userDb: userDbId });\r\n    console.log(stringifyPayload);\r\n    await this.rootStore.dataStore.ipfsNode.pubsub.publish(peer, stringifyPayload);\r\n  }\r\n  async sendPeersDbId(peer) {\r\n    const peerDbId = await this.peersDb.id;\r\n\r\n    const stringifyPayload = JSON.stringify({ peersDb: peerDbId });\r\n    console.log(stringifyPayload);\r\n    await this.rootStore.dataStore.ipfsNode.pubsub.publish(peer, stringifyPayload);\r\n  }\r\n\r\n  async subscribeToOwnPubsub() {\r\n    const peerInfoId = this.rootStore.dataStore.peerId;\r\n    console.log(\"Peer ID: \" + peerInfoId);\r\n    await this.rootStore.dataStore.ipfsNode.pubsub.subscribe(peerInfoId, async (msg) => {\r\n      if (typeof msg.data === \"object\") msg.data = this.texDecoder.decode(msg.data);\r\n      const parsedMsg = JSON.parse(msg.data);\r\n      if (parsedMsg.userDb) {\r\n        await this.replicateUserDb(parsedMsg);\r\n      }\r\n      if (parsedMsg.peersDb) {\r\n        await this.replicatePeersDb(parsedMsg);\r\n      }\r\n      if (parsedMsg.roomName) {\r\n        console.log(parsedMsg.roomName);\r\n        let room = this.rootStore.roomStore.getRoom(parsedMsg.roomName);\r\n\r\n        if (!room) {\r\n          room = await this.rootStore.roomStore.createRoom(parsedMsg.roomName);\r\n          room.setRoomUser(msg.from);\r\n\r\n          room.init();\r\n        }\r\n      }\r\n\r\n      // let targetRoom;\r\n      // if (parsedMsg.userDb) {\r\n      //   await this.replicateUserDb(parsedMsg);\r\n      //   targetRoom = await this.rootStore.roomStore.createRoom(msg.from);\r\n      //   await targetRoom.init();\r\n      // } else {\r\n      //   targetRoom = this.rootStore.roomStore.getRoom(msg.from);\r\n      //   console.log(targetRoom);\r\n      // }\r\n      // if (targetRoom) {\r\n      //   targetRoom.setMessage(msg);\r\n      // }\r\n    });\r\n  }\r\n\r\n  async subscribeToDecentioPubsub() {\r\n    await this.rootStore.dataStore.ipfsNode.pubsub.subscribe(\"DecentioGlobalNetwork\", () => {});\r\n  }\r\n\r\n  async replicateUserDb(parsedMsg) {\r\n    console.log(parsedMsg.userDb);\r\n    var peerDbOuter = await this.rootStore.dataStore.orbitDb.open(parsedMsg.userDb);\r\n    console.log(peerDbOuter);\r\n    await peerDbOuter.load();\r\n    peerDbOuter.events.on(\"replicated\", async () => {\r\n      console.log(\"DB replicated\");\r\n      const db = { identity: parsedMsg.userDb, data: peerDbOuter.all };\r\n      console.log(db);\r\n\r\n      await this.peersDb.add(db);\r\n      console.log(this.peersDb.all);\r\n      this.peers.push(db);\r\n    });\r\n  }\r\n\r\n  async replicatePeersDb(parsedMsg) {\r\n    console.log(parsedMsg.peersDb);\r\n    var peerDbOuter = await this.rootStore.dataStore.orbitDb.open(parsedMsg.peersDb);\r\n    console.log(peerDbOuter);\r\n    await peerDbOuter.load();\r\n    peerDbOuter.events.on(\"replicated\", async () => {\r\n      console.log(\"DB replicated\");\r\n      const db = { identity: parsedMsg.peersDb, data: peerDbOuter.all };\r\n      if (this.peerIsInDb(parsedMsg.peersDb)) return;\r\n      console.log(db);\r\n      await this.peersDb.add(db);\r\n      console.log(this.peersDb.all);\r\n      this.peers.push(db);\r\n    });\r\n  }\r\n\r\n  async loadPeersDb() {\r\n    this.peersDb = await this.rootStore.dataStore.orbitDb.feed(\"peers\");\r\n    await this.peersDb.load();\r\n  }\r\n\r\n  // async replicatePeersDB() {\r\n  //   const nodeId = await this.rootStore.dataStore.getPeerId();\r\n  //   const peersDbId = await this.peersDb.id;\r\n  //   console.log(nodeId);\r\n  //   await this.peersDb.all.map((peer) => {\r\n  //     const peerId = peer.payload.value;\r\n  //     console.log(peerId);\r\n  //     console.log(peersDbId);\r\n  //     const stringifyPayload = JSON.stringify({ peerDb: peersDbId });\r\n  //     this.rootStore.dataStore.ipfsNode.pubsub.publish(peerId, stringifyPayload);\r\n  //   });\r\n  // }\r\n\r\n  async removeDuplicateUser(duplicateUser) {\r\n    console.log(duplicateUser);\r\n    this.peers = this.peers.filter((item) => item.data.user._username != duplicateUser.payload.value.data.user._username);\r\n    await this.peersDb.remove(duplicateUser.hash);\r\n\r\n    // console.log(index);\r\n    // if (index > -1) {\r\n    //   // only splice array when item is found\r\n    //   this.peers.splice(index, 1);\r\n    //   // 2nd parameter means remove one item only\r\n    // }\r\n  }\r\n\r\n  async queryCatalog(queryFn) {\r\n    //  const dbAddrs = Object.values(this.peersDb.all).map(peer => peer.pieces)\r\n\r\n    const allPieces = await Promise.all(\r\n      this.peersDb.all.map(async (addr) => {\r\n        const db = await this.rootStore.dataStore.orbitDb.open(addr);\r\n        await db.load();\r\n\r\n        return db.query(queryFn);\r\n      })\r\n    );\r\n\r\n    // return allPieces.reduce((flatPieces, pieces) => flatPieces.concat(pieces), this.pieces.query(queryFn))\r\n  }\r\n\r\n  processMessage(msg) {\r\n    if (typeof msg.data === \"object\") msg.data = this.texDecoder.decode(msg.data);\r\n  }\r\n  async getPeersDbId() {\r\n    const id = await this.peersDb.id;\r\n    return id;\r\n  }\r\n\r\n  filterDuplicates(array) {\r\n    let uniqueChars = array.filter((element, index) => {\r\n      return array.indexOf(element) === index;\r\n    });\r\n    return uniqueChars;\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}