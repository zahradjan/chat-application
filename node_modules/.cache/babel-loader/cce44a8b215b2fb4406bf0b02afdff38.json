{"ast":null,"code":"'use strict';\n\nconst {\n  UnixFS\n} = require('ipfs-unixfs');\n\nconst dagPb = require('@ipld/dag-pb');\n\nconst {\n  CID\n} = require('multiformats/cid');\n/**\n * @typedef {import('ipfs-unixfs').MtimeLike} MtimeLike\n * @typedef {import('multiformats/cid').CIDVersion} CIDVersion\n * @typedef {import('../').MfsContext} MfsContext\n */\n\n/**\n * @param {MfsContext} context\n * @param {'file' | 'directory'} type\n * @param {object} options\n * @param {string} options.hashAlg\n * @param {CIDVersion} options.cidVersion\n * @param {boolean} options.flush\n * @param {MtimeLike} [options.mtime]\n * @param {number} [options.mode]\n */\n\n\nconst createNode = async (context, type, options) => {\n  const metadata = new UnixFS({\n    type,\n    mode: options.mode,\n    // @ts-ignore TODO: restore hrtime support to ipfs-unixfs constructor - it's in the code, just not the signature\n    mtime: options.mtime\n  }); // Persist the new parent PBNode\n\n  const hasher = await context.hashers.getHasher(options.hashAlg);\n  const node = {\n    Data: metadata.marshal(),\n    Links: []\n  };\n  const buf = dagPb.encode(node);\n  const hash = await hasher.digest(buf);\n  const cid = CID.create(options.cidVersion, dagPb.code, hash);\n\n  if (options.flush) {\n    await context.repo.blocks.put(cid, buf);\n  }\n\n  return {\n    cid,\n    node\n  };\n};\n\nmodule.exports = createNode;","map":{"version":3,"names":["UnixFS","require","dagPb","CID","createNode","context","type","options","metadata","mode","mtime","hasher","hashers","getHasher","hashAlg","node","Data","marshal","Links","buf","encode","hash","digest","cid","create","cidVersion","code","flush","repo","blocks","put","module","exports"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/ipfs-core/src/components/files/utils/create-node.js"],"sourcesContent":["'use strict'\n\nconst { UnixFS } = require('ipfs-unixfs')\nconst dagPb = require('@ipld/dag-pb')\nconst { CID } = require('multiformats/cid')\n\n/**\n * @typedef {import('ipfs-unixfs').MtimeLike} MtimeLike\n * @typedef {import('multiformats/cid').CIDVersion} CIDVersion\n * @typedef {import('../').MfsContext} MfsContext\n */\n\n/**\n * @param {MfsContext} context\n * @param {'file' | 'directory'} type\n * @param {object} options\n * @param {string} options.hashAlg\n * @param {CIDVersion} options.cidVersion\n * @param {boolean} options.flush\n * @param {MtimeLike} [options.mtime]\n * @param {number} [options.mode]\n */\nconst createNode = async (context, type, options) => {\n  const metadata = new UnixFS({\n    type,\n    mode: options.mode,\n    // @ts-ignore TODO: restore hrtime support to ipfs-unixfs constructor - it's in the code, just not the signature\n    mtime: options.mtime\n  })\n\n  // Persist the new parent PBNode\n  const hasher = await context.hashers.getHasher(options.hashAlg)\n  const node = {\n    Data: metadata.marshal(),\n    Links: []\n  }\n  const buf = dagPb.encode(node)\n  const hash = await hasher.digest(buf)\n  const cid = CID.create(options.cidVersion, dagPb.code, hash)\n\n  if (options.flush) {\n    await context.repo.blocks.put(cid, buf)\n  }\n\n  return {\n    cid,\n    node\n  }\n}\n\nmodule.exports = createNode\n"],"mappings":"AAAA;;AAEA,MAAM;EAAEA;AAAF,IAAaC,OAAO,CAAC,aAAD,CAA1B;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAC,cAAD,CAArB;;AACA,MAAM;EAAEE;AAAF,IAAUF,OAAO,CAAC,kBAAD,CAAvB;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,MAAMG,UAAU,GAAG,OAAOC,OAAP,EAAgBC,IAAhB,EAAsBC,OAAtB,KAAkC;EACnD,MAAMC,QAAQ,GAAG,IAAIR,MAAJ,CAAW;IAC1BM,IAD0B;IAE1BG,IAAI,EAAEF,OAAO,CAACE,IAFY;IAG1B;IACAC,KAAK,EAAEH,OAAO,CAACG;EAJW,CAAX,CAAjB,CADmD,CAQnD;;EACA,MAAMC,MAAM,GAAG,MAAMN,OAAO,CAACO,OAAR,CAAgBC,SAAhB,CAA0BN,OAAO,CAACO,OAAlC,CAArB;EACA,MAAMC,IAAI,GAAG;IACXC,IAAI,EAAER,QAAQ,CAACS,OAAT,EADK;IAEXC,KAAK,EAAE;EAFI,CAAb;EAIA,MAAMC,GAAG,GAAGjB,KAAK,CAACkB,MAAN,CAAaL,IAAb,CAAZ;EACA,MAAMM,IAAI,GAAG,MAAMV,MAAM,CAACW,MAAP,CAAcH,GAAd,CAAnB;EACA,MAAMI,GAAG,GAAGpB,GAAG,CAACqB,MAAJ,CAAWjB,OAAO,CAACkB,UAAnB,EAA+BvB,KAAK,CAACwB,IAArC,EAA2CL,IAA3C,CAAZ;;EAEA,IAAId,OAAO,CAACoB,KAAZ,EAAmB;IACjB,MAAMtB,OAAO,CAACuB,IAAR,CAAaC,MAAb,CAAoBC,GAApB,CAAwBP,GAAxB,EAA6BJ,GAA7B,CAAN;EACD;;EAED,OAAO;IACLI,GADK;IAELR;EAFK,CAAP;AAID,CA1BD;;AA4BAgB,MAAM,CAACC,OAAP,GAAiB5B,UAAjB"},"metadata":{},"sourceType":"script"}