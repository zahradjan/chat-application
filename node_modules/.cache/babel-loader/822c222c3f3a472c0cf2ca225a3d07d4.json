{"ast":null,"code":"'use strict';\n\nvar _inherits = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/inherits.js\").default;\n\nvar _createSuper = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/createSuper.js\").default;\n\nvar _regeneratorRuntime = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\n\nvar _classCallCheck = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\n\nvar _createClass = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/createClass.js\").default;\n\nvar _asyncToGenerator = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _asyncIterator = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/asyncIterator.js\").default;\n\nvar batch = require('it-batch');\n\nfunction _interopDefaultLegacy(e) {\n  return e && typeof e === 'object' && 'default' in e ? e : {\n    'default': e\n  };\n}\n\nvar batch__default = /*#__PURE__*/_interopDefaultLegacy(batch);\n\nfunction trickleStream(_x, _x2, _x3) {\n  return _trickleStream.apply(this, arguments);\n}\n\nfunction _trickleStream() {\n  _trickleStream = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(source, reduce, options) {\n    var root, iteration, maxDepth, subTree, _iteratorAbruptCompletion, _didIteratorError, _iteratorError, _iterator, _step, layer;\n\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            root = new Root(options.layerRepeat);\n            iteration = 0;\n            maxDepth = 1;\n            subTree = root;\n            _iteratorAbruptCompletion = false;\n            _didIteratorError = false;\n            _context2.prev = 6;\n            _iterator = _asyncIterator(batch__default[\"default\"](source, options.maxChildrenPerNode));\n\n          case 8:\n            _context2.next = 10;\n            return _iterator.next();\n\n          case 10:\n            if (!(_iteratorAbruptCompletion = !(_step = _context2.sent).done)) {\n              _context2.next = 26;\n              break;\n            }\n\n            layer = _step.value;\n\n            if (!subTree.isFull()) {\n              _context2.next = 22;\n              break;\n            }\n\n            if (!(subTree !== root)) {\n              _context2.next = 19;\n              break;\n            }\n\n            _context2.t0 = root;\n            _context2.next = 17;\n            return subTree.reduce(reduce);\n\n          case 17:\n            _context2.t1 = _context2.sent;\n\n            _context2.t0.addChild.call(_context2.t0, _context2.t1);\n\n          case 19:\n            if (iteration && iteration % options.layerRepeat === 0) {\n              maxDepth++;\n            }\n\n            subTree = new SubTree(maxDepth, options.layerRepeat, iteration);\n            iteration++;\n\n          case 22:\n            subTree.append(layer);\n\n          case 23:\n            _iteratorAbruptCompletion = false;\n            _context2.next = 8;\n            break;\n\n          case 26:\n            _context2.next = 32;\n            break;\n\n          case 28:\n            _context2.prev = 28;\n            _context2.t2 = _context2[\"catch\"](6);\n            _didIteratorError = true;\n            _iteratorError = _context2.t2;\n\n          case 32:\n            _context2.prev = 32;\n            _context2.prev = 33;\n\n            if (!(_iteratorAbruptCompletion && _iterator.return != null)) {\n              _context2.next = 37;\n              break;\n            }\n\n            _context2.next = 37;\n            return _iterator.return();\n\n          case 37:\n            _context2.prev = 37;\n\n            if (!_didIteratorError) {\n              _context2.next = 40;\n              break;\n            }\n\n            throw _iteratorError;\n\n          case 40:\n            return _context2.finish(37);\n\n          case 41:\n            return _context2.finish(32);\n\n          case 42:\n            if (!(subTree && subTree !== root)) {\n              _context2.next = 48;\n              break;\n            }\n\n            _context2.t3 = root;\n            _context2.next = 46;\n            return subTree.reduce(reduce);\n\n          case 46:\n            _context2.t4 = _context2.sent;\n\n            _context2.t3.addChild.call(_context2.t3, _context2.t4);\n\n          case 48:\n            return _context2.abrupt(\"return\", root.reduce(reduce));\n\n          case 49:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[6, 28, 32, 42], [33,, 37, 41]]);\n  }));\n  return _trickleStream.apply(this, arguments);\n}\n\nvar SubTree = /*#__PURE__*/function () {\n  function SubTree(maxDepth, layerRepeat) {\n    var iteration = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    _classCallCheck(this, SubTree);\n\n    this.maxDepth = maxDepth;\n    this.layerRepeat = layerRepeat;\n    this.currentDepth = 1;\n    this.iteration = iteration;\n    this.root = this.node = this.parent = {\n      children: [],\n      depth: this.currentDepth,\n      maxDepth: maxDepth,\n      maxChildren: (this.maxDepth - this.currentDepth) * this.layerRepeat\n    };\n  }\n\n  _createClass(SubTree, [{\n    key: \"isFull\",\n    value: function isFull() {\n      if (!this.root.data) {\n        return false;\n      }\n\n      if (this.currentDepth < this.maxDepth && this.node.maxChildren) {\n        this._addNextNodeToParent(this.node);\n\n        return false;\n      }\n\n      var distantRelative = this._findParent(this.node, this.currentDepth);\n\n      if (distantRelative) {\n        this._addNextNodeToParent(distantRelative);\n\n        return false;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"_addNextNodeToParent\",\n    value: function _addNextNodeToParent(parent) {\n      this.parent = parent;\n      var nextNode = {\n        children: [],\n        depth: parent.depth + 1,\n        parent: parent,\n        maxDepth: this.maxDepth,\n        maxChildren: Math.floor(parent.children.length / this.layerRepeat) * this.layerRepeat\n      };\n      parent.children.push(nextNode);\n      this.currentDepth = nextNode.depth;\n      this.node = nextNode;\n    }\n  }, {\n    key: \"append\",\n    value: function append(layer) {\n      this.node.data = layer;\n    }\n  }, {\n    key: \"reduce\",\n    value: function reduce(_reduce) {\n      return this._reduce(this.root, _reduce);\n    }\n  }, {\n    key: \"_reduce\",\n    value: function () {\n      var _reduce2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(node, reduce) {\n        var _this = this;\n\n        var children;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                children = [];\n\n                if (!node.children.length) {\n                  _context.next = 5;\n                  break;\n                }\n\n                _context.next = 4;\n                return Promise.all(node.children.filter(function (child) {\n                  return child.data;\n                }).map(function (child) {\n                  return _this._reduce(child, reduce);\n                }));\n\n              case 4:\n                children = _context.sent;\n\n              case 5:\n                return _context.abrupt(\"return\", reduce((node.data || []).concat(children)));\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function _reduce(_x4, _x5) {\n        return _reduce2.apply(this, arguments);\n      }\n\n      return _reduce;\n    }()\n  }, {\n    key: \"_findParent\",\n    value: function _findParent(node, depth) {\n      var parent = node.parent;\n\n      if (!parent || parent.depth === 0) {\n        return;\n      }\n\n      if (parent.children.length === parent.maxChildren || !parent.maxChildren) {\n        return this._findParent(parent, depth);\n      }\n\n      return parent;\n    }\n  }]);\n\n  return SubTree;\n}();\n\nvar Root = /*#__PURE__*/function (_SubTree) {\n  _inherits(Root, _SubTree);\n\n  var _super = _createSuper(Root);\n\n  function Root(layerRepeat) {\n    var _this2;\n\n    _classCallCheck(this, Root);\n\n    _this2 = _super.call(this, 0, layerRepeat);\n    _this2.root.depth = 0;\n    _this2.currentDepth = 1;\n    return _this2;\n  }\n\n  _createClass(Root, [{\n    key: \"addChild\",\n    value: function addChild(child) {\n      this.root.children.push(child);\n    }\n  }, {\n    key: \"reduce\",\n    value: function reduce(_reduce3) {\n      return _reduce3((this.root.data || []).concat(this.root.children));\n    }\n  }]);\n\n  return Root;\n}(SubTree);\n\nmodule.exports = trickleStream;","map":{"version":3,"names":["batch","require","_interopDefaultLegacy","e","batch__default","trickleStream","source","reduce","options","root","Root","layerRepeat","iteration","maxDepth","subTree","maxChildrenPerNode","layer","isFull","addChild","SubTree","append","currentDepth","node","parent","children","depth","maxChildren","data","_addNextNodeToParent","distantRelative","_findParent","nextNode","Math","floor","length","push","_reduce","Promise","all","filter","child","map","concat","module","exports"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/ipfs-unixfs-importer/cjs/src/dag-builder/file/trickle.js"],"sourcesContent":["'use strict';\n\nvar batch = require('it-batch');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar batch__default = /*#__PURE__*/_interopDefaultLegacy(batch);\n\nasync function trickleStream(source, reduce, options) {\n  const root = new Root(options.layerRepeat);\n  let iteration = 0;\n  let maxDepth = 1;\n  let subTree = root;\n  for await (const layer of batch__default[\"default\"](source, options.maxChildrenPerNode)) {\n    if (subTree.isFull()) {\n      if (subTree !== root) {\n        root.addChild(await subTree.reduce(reduce));\n      }\n      if (iteration && iteration % options.layerRepeat === 0) {\n        maxDepth++;\n      }\n      subTree = new SubTree(maxDepth, options.layerRepeat, iteration);\n      iteration++;\n    }\n    subTree.append(layer);\n  }\n  if (subTree && subTree !== root) {\n    root.addChild(await subTree.reduce(reduce));\n  }\n  return root.reduce(reduce);\n}\nclass SubTree {\n  constructor(maxDepth, layerRepeat, iteration = 0) {\n    this.maxDepth = maxDepth;\n    this.layerRepeat = layerRepeat;\n    this.currentDepth = 1;\n    this.iteration = iteration;\n    this.root = this.node = this.parent = {\n      children: [],\n      depth: this.currentDepth,\n      maxDepth,\n      maxChildren: (this.maxDepth - this.currentDepth) * this.layerRepeat\n    };\n  }\n  isFull() {\n    if (!this.root.data) {\n      return false;\n    }\n    if (this.currentDepth < this.maxDepth && this.node.maxChildren) {\n      this._addNextNodeToParent(this.node);\n      return false;\n    }\n    const distantRelative = this._findParent(this.node, this.currentDepth);\n    if (distantRelative) {\n      this._addNextNodeToParent(distantRelative);\n      return false;\n    }\n    return true;\n  }\n  _addNextNodeToParent(parent) {\n    this.parent = parent;\n    const nextNode = {\n      children: [],\n      depth: parent.depth + 1,\n      parent,\n      maxDepth: this.maxDepth,\n      maxChildren: Math.floor(parent.children.length / this.layerRepeat) * this.layerRepeat\n    };\n    parent.children.push(nextNode);\n    this.currentDepth = nextNode.depth;\n    this.node = nextNode;\n  }\n  append(layer) {\n    this.node.data = layer;\n  }\n  reduce(reduce) {\n    return this._reduce(this.root, reduce);\n  }\n  async _reduce(node, reduce) {\n    let children = [];\n    if (node.children.length) {\n      children = await Promise.all(node.children.filter(child => child.data).map(child => this._reduce(child, reduce)));\n    }\n    return reduce((node.data || []).concat(children));\n  }\n  _findParent(node, depth) {\n    const parent = node.parent;\n    if (!parent || parent.depth === 0) {\n      return;\n    }\n    if (parent.children.length === parent.maxChildren || !parent.maxChildren) {\n      return this._findParent(parent, depth);\n    }\n    return parent;\n  }\n}\nclass Root extends SubTree {\n  constructor(layerRepeat) {\n    super(0, layerRepeat);\n    this.root.depth = 0;\n    this.currentDepth = 1;\n  }\n  addChild(child) {\n    this.root.children.push(child);\n  }\n  reduce(reduce) {\n    return reduce((this.root.data || []).concat(this.root.children));\n  }\n}\n\nmodule.exports = trickleStream;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}