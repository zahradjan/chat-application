{"ast":null,"code":"import IpfsPubsubPeerMonitor from \"ipfs-pubsub-peer-monitor\";\nimport { makeAutoObservable, runInAction, toJS } from \"mobx\";\nexport class MonitorStore {\n  constructor(rootStore) {\n    this.rootStore = rootStore;\n    this.monitor = undefined;\n    this.peersDb = undefined;\n    this.peers = [];\n    this.topicName = \"DecentioGlobalNetwork\";\n    this.texDecoder = new TextDecoder();\n    makeAutoObservable(this);\n  }\n\n  async init() {\n    if (this.rootStore.dataStore.ipfsNode === undefined) throw Error(\"IPFS Node not defined!\");\n    if (this.rootStore.dataStore.orbitDb === undefined) throw Error(\"OrbitDb not defined!\");\n    runInAction(async () => {\n      await this.subscribeToOwnPubsub();\n      await this.subscribeToDecentioPubsub();\n      await this.loadPeersDb();\n      await this.setPeersFromDb();\n      this.monitor = new IpfsPubsubPeerMonitor(this.rootStore.dataStore.ipfsNode.pubsub, this.topicName);\n      await this.listenForJoinedPeers();\n      await this.listenForLeftPeers();\n    });\n  }\n\n  async isMonitorReady() {\n    return this.monitor;\n  }\n\n  async setPeersFromDb() {\n    const all = await toJS(this.peersDb.all);\n    runInAction(() => {\n      all.map(e => {\n        // console.log(e.payload.value);\n        return this.peers.push(e.payload.value);\n      });\n    });\n  }\n\n  async listenForJoinedPeers() {\n    this.monitor.on(\"join\", async peerJoined => {\n      console.log(\"Peer joined: \" + peerJoined);\n      console.log(`Peers on Pubsub ${this.topicName}: ` + (await this.monitor.getPeers()));\n      setTimeout(async () => {\n        let peerInDb = this.peerIsInDb(peerJoined); //TODO:tahle vubec nefunguje\n\n        if (peerInDb) {\n          const room = await this.rootStore.roomStore.getRoom(peerJoined); //mozna lepsi ten init\n\n          await room.connectToChatRoom();\n        } else {\n          await this.sendUserDbId(peerJoined); // const room = await this.rootStore.roomStore.createRoom(peerJoined);\n          // await room.init();\n        }\n      }, 2000);\n    });\n  }\n\n  async listenForLeftPeers() {\n    this.monitor.on(\"leave\", async peerLeft => {\n      console.log(\"Peer left: \" + peerLeft);\n      console.log(`Peers on Pubsub ${this.topicName}: ` + (await this.monitor.getPeers())); // await this.removePeer(peerLeft);\n    });\n  }\n\n  peerIsInDb(peer) {\n    console.log(peer);\n    const peers = toJS(this.peers);\n    console.log(toJS(this.peers));\n    return peers.find(item => item.user.peerId === peer);\n  }\n\n  async savePeer(peer) {\n    runInAction(async () => {\n      console.log(!this.peerIsInDb(peer));\n\n      if (!this.peerIsInDb(peer)) {\n        this.peers.push(peer);\n        await this.peersDb.add(peer);\n      }\n    });\n  }\n\n  async removePeer(peer) {\n    const entry = await this.peersDb.iterator().collect().map(item => item.payload.value === peer ? item : undefined);\n    console.log(entry);\n\n    if (entry) {\n      await this.peersDb.remove(entry[0].hash);\n    }\n  }\n\n  async sendUserDbId(peer) {\n    console.log(this.peerIsInDb(peer));\n    const userDbId = await this.rootStore.userStore.getUserDbId();\n    const stringifyPayload = JSON.stringify({\n      userDb: userDbId\n    });\n    console.log(stringifyPayload);\n    await this.rootStore.dataStore.ipfsNode.pubsub.publish(peer, stringifyPayload);\n  }\n\n  async subscribeToOwnPubsub() {\n    const peerInfoId = this.rootStore.dataStore.peerId;\n    console.log(\"Peer ID: \" + peerInfoId);\n    await this.rootStore.dataStore.ipfsNode.pubsub.subscribe(peerInfoId, async msg => {\n      console.log(msg.data); // this.processMessage(msg);\n\n      if (typeof msg.data === \"object\") msg.data = this.texDecoder.decode(msg.data);\n      const parsedMsg = JSON.parse(msg.data);\n      console.log(parsedMsg);\n      console.log(parsedMsg.userDb); //TODO: tahle podminka vubec nefunguje\n\n      if (parsedMsg.userDb) {\n        await this.replicateUserDb(parsedMsg);\n        const room = await this.rootStore.roomStore.createRoom(msg.from);\n        await room.init();\n      } else {\n        const targetRoom = this.rootStore.roomStore.getRoom(msg.from);\n        console.log(targetRoom);\n\n        if (targetRoom) {\n          targetRoom.setMessage(msg);\n        }\n      }\n    });\n  }\n\n  async subscribeToDecentioPubsub() {\n    await this.rootStore.dataStore.ipfsNode.pubsub.subscribe(\"DecentioGlobalNetwork\", () => {});\n  }\n\n  async replicateUserDb(parsedMsg) {\n    var peerDbOuter = await this.rootStore.dataStore.orbitDb.open(parsedMsg.userDb);\n    peerDbOuter.events.on(\"replicated\", async () => {\n      console.log(\"DB replicated\");\n      await this.peersDb.add(peerDbOuter.all);\n      console.log(peerDbOuter.all);\n      this.peers.push(peerDbOuter.all);\n      console.log(this.peersDb.all);\n      console.log(this.peers);\n    });\n  }\n\n  async loadPeersDb() {\n    this.peersDb = await this.rootStore.dataStore.orbitDb.feed(\"peers\");\n    await this.peersDb.load();\n  }\n\n  replicatePeersDB() {\n    setTimeout(async () => {\n      const nodeId = await this.rootStore.dataStore.getPeerId();\n      const peersDbId = await this.peersDb.id;\n      console.log(nodeId);\n      await this.peersDb.all.map(peer => {\n        const peerId = peer.payload.value;\n\n        if (peerId !== nodeId) {\n          console.log(\"jsem tu \");\n          console.log(peerId);\n          console.log(peersDbId);\n          const stringifyPayload = JSON.stringify({\n            peerDb: peersDbId\n          });\n          this.rootStore.dataStore.ipfsNode.pubsub.publish(peerId, stringifyPayload);\n        }\n      });\n    }, 2000);\n  }\n\n  processMessage(msg) {\n    if (typeof msg.data === \"object\") msg.data = this.texDecoder.decode(msg.data);\n  }\n\n  async getPeersDbId() {\n    const id = await this.peersDb.id;\n    return id;\n  }\n\n}","map":{"version":3,"names":["IpfsPubsubPeerMonitor","makeAutoObservable","runInAction","toJS","MonitorStore","constructor","rootStore","monitor","undefined","peersDb","peers","topicName","texDecoder","TextDecoder","init","dataStore","ipfsNode","Error","orbitDb","subscribeToOwnPubsub","subscribeToDecentioPubsub","loadPeersDb","setPeersFromDb","pubsub","listenForJoinedPeers","listenForLeftPeers","isMonitorReady","all","map","e","push","payload","value","on","peerJoined","console","log","getPeers","setTimeout","peerInDb","peerIsInDb","room","roomStore","getRoom","connectToChatRoom","sendUserDbId","peerLeft","peer","find","item","user","peerId","savePeer","add","removePeer","entry","iterator","collect","remove","hash","userDbId","userStore","getUserDbId","stringifyPayload","JSON","stringify","userDb","publish","peerInfoId","subscribe","msg","data","decode","parsedMsg","parse","replicateUserDb","createRoom","from","targetRoom","setMessage","peerDbOuter","open","events","feed","load","replicatePeersDB","nodeId","getPeerId","peersDbId","id","peerDb","processMessage","getPeersDbId"],"sources":["C:/Users/zajan/GitHub/chatApplication/src/data/store/MonitorStore.js"],"sourcesContent":["import IpfsPubsubPeerMonitor from \"ipfs-pubsub-peer-monitor\";\r\nimport { makeAutoObservable, runInAction, toJS } from \"mobx\";\r\n\r\nexport class MonitorStore {\r\n  monitor;\r\n  topicName;\r\n  peers;\r\n  peersDb;\r\n  texDecoder;\r\n  constructor(rootStore) {\r\n    this.rootStore = rootStore;\r\n    this.monitor = undefined;\r\n    this.peersDb = undefined;\r\n    this.peers = [];\r\n    this.topicName = \"DecentioGlobalNetwork\";\r\n    this.texDecoder = new TextDecoder();\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  async init() {\r\n    if (this.rootStore.dataStore.ipfsNode === undefined) throw Error(\"IPFS Node not defined!\");\r\n    if (this.rootStore.dataStore.orbitDb === undefined) throw Error(\"OrbitDb not defined!\");\r\n    runInAction(async () => {\r\n      await this.subscribeToOwnPubsub();\r\n      await this.subscribeToDecentioPubsub();\r\n      await this.loadPeersDb();\r\n      await this.setPeersFromDb();\r\n      this.monitor = new IpfsPubsubPeerMonitor(this.rootStore.dataStore.ipfsNode.pubsub, this.topicName);\r\n      await this.listenForJoinedPeers();\r\n      await this.listenForLeftPeers();\r\n    });\r\n  }\r\n  async isMonitorReady() {\r\n    return this.monitor;\r\n  }\r\n\r\n  async setPeersFromDb() {\r\n    const all = await toJS(this.peersDb.all);\r\n    runInAction(() => {\r\n      all.map((e) => {\r\n        // console.log(e.payload.value);\r\n        return this.peers.push(e.payload.value);\r\n      });\r\n    });\r\n  }\r\n\r\n  async listenForJoinedPeers() {\r\n    this.monitor.on(\"join\", async (peerJoined) => {\r\n      console.log(\"Peer joined: \" + peerJoined);\r\n      console.log(`Peers on Pubsub ${this.topicName}: ` + (await this.monitor.getPeers()));\r\n      setTimeout(async () => {\r\n        let peerInDb = this.peerIsInDb(peerJoined);\r\n        //TODO:tahle vubec nefunguje\r\n        if (peerInDb) {\r\n          const room = await this.rootStore.roomStore.getRoom(peerJoined);\r\n          //mozna lepsi ten init\r\n          await room.connectToChatRoom();\r\n        } else {\r\n          await this.sendUserDbId(peerJoined);\r\n          // const room = await this.rootStore.roomStore.createRoom(peerJoined);\r\n          // await room.init();\r\n        }\r\n      }, 2000);\r\n    });\r\n  }\r\n\r\n  async listenForLeftPeers() {\r\n    this.monitor.on(\"leave\", async (peerLeft) => {\r\n      console.log(\"Peer left: \" + peerLeft);\r\n      console.log(`Peers on Pubsub ${this.topicName}: ` + (await this.monitor.getPeers()));\r\n      // await this.removePeer(peerLeft);\r\n    });\r\n  }\r\n\r\n  peerIsInDb(peer) {\r\n    console.log(peer);\r\n    const peers = toJS(this.peers);\r\n    console.log(toJS(this.peers));\r\n    return peers.find((item) => item.user.peerId === peer);\r\n  }\r\n\r\n  async savePeer(peer) {\r\n    runInAction(async () => {\r\n      console.log(!this.peerIsInDb(peer));\r\n      if (!this.peerIsInDb(peer)) {\r\n        this.peers.push(peer);\r\n        await this.peersDb.add(peer);\r\n      }\r\n    });\r\n  }\r\n  async removePeer(peer) {\r\n    const entry = await this.peersDb\r\n      .iterator()\r\n      .collect()\r\n      .map((item) => (item.payload.value === peer ? item : undefined));\r\n    console.log(entry);\r\n    if (entry) {\r\n      await this.peersDb.remove(entry[0].hash);\r\n    }\r\n  }\r\n  async sendUserDbId(peer) {\r\n    console.log(this.peerIsInDb(peer));\r\n\r\n    const userDbId = await this.rootStore.userStore.getUserDbId();\r\n\r\n    const stringifyPayload = JSON.stringify({ userDb: userDbId });\r\n    console.log(stringifyPayload);\r\n    await this.rootStore.dataStore.ipfsNode.pubsub.publish(peer, stringifyPayload);\r\n  }\r\n\r\n  async subscribeToOwnPubsub() {\r\n    const peerInfoId = this.rootStore.dataStore.peerId;\r\n    console.log(\"Peer ID: \" + peerInfoId);\r\n    await this.rootStore.dataStore.ipfsNode.pubsub.subscribe(peerInfoId, async (msg) => {\r\n      console.log(msg.data);\r\n\r\n      // this.processMessage(msg);\r\n      if (typeof msg.data === \"object\") msg.data = this.texDecoder.decode(msg.data);\r\n      const parsedMsg = JSON.parse(msg.data);\r\n      console.log(parsedMsg);\r\n      console.log(parsedMsg.userDb);\r\n      //TODO: tahle podminka vubec nefunguje\r\n\r\n      if (parsedMsg.userDb) {\r\n        await this.replicateUserDb(parsedMsg);\r\n        const room = await this.rootStore.roomStore.createRoom(msg.from);\r\n        await room.init();\r\n      } else {\r\n        const targetRoom = this.rootStore.roomStore.getRoom(msg.from);\r\n        console.log(targetRoom);\r\n        if (targetRoom) {\r\n          targetRoom.setMessage(msg);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  async subscribeToDecentioPubsub() {\r\n    await this.rootStore.dataStore.ipfsNode.pubsub.subscribe(\"DecentioGlobalNetwork\", () => {});\r\n  }\r\n\r\n  async replicateUserDb(parsedMsg) {\r\n    var peerDbOuter = await this.rootStore.dataStore.orbitDb.open(parsedMsg.userDb);\r\n    peerDbOuter.events.on(\"replicated\", async () => {\r\n      console.log(\"DB replicated\");\r\n      await this.peersDb.add(peerDbOuter.all);\r\n      console.log(peerDbOuter.all);\r\n      this.peers.push(peerDbOuter.all);\r\n      console.log(this.peersDb.all);\r\n      console.log(this.peers);\r\n    });\r\n  }\r\n\r\n  async loadPeersDb() {\r\n    this.peersDb = await this.rootStore.dataStore.orbitDb.feed(\"peers\");\r\n    await this.peersDb.load();\r\n  }\r\n\r\n  replicatePeersDB() {\r\n    setTimeout(async () => {\r\n      const nodeId = await this.rootStore.dataStore.getPeerId();\r\n      const peersDbId = await this.peersDb.id;\r\n      console.log(nodeId);\r\n      await this.peersDb.all.map((peer) => {\r\n        const peerId = peer.payload.value;\r\n        if (peerId !== nodeId) {\r\n          console.log(\"jsem tu \");\r\n          console.log(peerId);\r\n          console.log(peersDbId);\r\n          const stringifyPayload = JSON.stringify({ peerDb: peersDbId });\r\n          this.rootStore.dataStore.ipfsNode.pubsub.publish(peerId, stringifyPayload);\r\n        }\r\n      });\r\n    }, 2000);\r\n  }\r\n  processMessage(msg) {\r\n    if (typeof msg.data === \"object\") msg.data = this.texDecoder.decode(msg.data);\r\n  }\r\n  async getPeersDbId() {\r\n    const id = await this.peersDb.id;\r\n    return id;\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}