{"ast":null,"code":"var _regeneratorRuntime = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\n\nvar _asyncToGenerator = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _asyncIterator = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/asyncIterator.js\").default;\n\nvar ready = require('./ready');\n\nmodule.exports = function (socket, options) {\n  options = options || {};\n  options.closeOnEnd = options.closeOnEnd !== false;\n  return /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(source) {\n      var _iteratorAbruptCompletion, _didIteratorError, _iteratorError, _iterator, _step, data;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _iteratorAbruptCompletion = false;\n              _didIteratorError = false;\n              _context.prev = 2;\n              _iterator = _asyncIterator(source);\n\n            case 4:\n              _context.next = 6;\n              return _iterator.next();\n\n            case 6:\n              if (!(_iteratorAbruptCompletion = !(_step = _context.sent).done)) {\n                _context.next = 22;\n                break;\n              }\n\n              data = _step.value;\n              _context.prev = 8;\n              _context.next = 11;\n              return ready(socket);\n\n            case 11:\n              _context.next = 18;\n              break;\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](8);\n\n              if (!(_context.t0.message === 'socket closed')) {\n                _context.next = 17;\n                break;\n              }\n\n              return _context.abrupt(\"break\", 22);\n\n            case 17:\n              throw _context.t0;\n\n            case 18:\n              socket.send(data);\n\n            case 19:\n              _iteratorAbruptCompletion = false;\n              _context.next = 4;\n              break;\n\n            case 22:\n              _context.next = 28;\n              break;\n\n            case 24:\n              _context.prev = 24;\n              _context.t1 = _context[\"catch\"](2);\n              _didIteratorError = true;\n              _iteratorError = _context.t1;\n\n            case 28:\n              _context.prev = 28;\n              _context.prev = 29;\n\n              if (!(_iteratorAbruptCompletion && _iterator.return != null)) {\n                _context.next = 33;\n                break;\n              }\n\n              _context.next = 33;\n              return _iterator.return();\n\n            case 33:\n              _context.prev = 33;\n\n              if (!_didIteratorError) {\n                _context.next = 36;\n                break;\n              }\n\n              throw _iteratorError;\n\n            case 36:\n              return _context.finish(33);\n\n            case 37:\n              return _context.finish(28);\n\n            case 38:\n              if (!(options.closeOnEnd && socket.readyState <= 1)) {\n                _context.next = 40;\n                break;\n              }\n\n              return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n                socket.addEventListener('close', function (event) {\n                  if (event.wasClean || event.code === 1006) {\n                    resolve();\n                  } else {\n                    var err = Object.assign(new Error('ws error'), {\n                      event: event\n                    });\n                    reject(err);\n                  }\n                });\n                setTimeout(function () {\n                  return socket.close();\n                });\n              }));\n\n            case 40:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 24, 28, 38], [8, 13], [29,, 33, 37]]);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n};","map":{"version":3,"names":["ready","require","module","exports","socket","options","closeOnEnd","source","data","message","send","readyState","Promise","resolve","reject","addEventListener","event","wasClean","code","err","Object","assign","Error","setTimeout","close"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/it-ws/sink.js"],"sourcesContent":["const ready = require('./ready')\n\nmodule.exports = (socket, options) => {\n  options = options || {}\n  options.closeOnEnd = options.closeOnEnd !== false\n\n  return async source => {\n    for await (const data of source) {\n      try {\n        await ready(socket)\n      } catch (err) {\n        if (err.message === 'socket closed') break\n        throw err\n      }\n\n      socket.send(data)\n    }\n\n    if (options.closeOnEnd && socket.readyState <= 1) {\n      return new Promise((resolve, reject) => {\n        socket.addEventListener('close', event => {\n          if (event.wasClean || event.code === 1006) {\n            resolve()\n          } else {\n            const err = Object.assign(new Error('ws error'), { event })\n            reject(err)\n          }\n        })\n\n        setTimeout(() => socket.close())\n      })\n    }\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAMA,KAAK,GAAGC,OAAO,CAAC,SAAD,CAArB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,UAACC,MAAD,EAASC,OAAT,EAAqB;EACpCA,OAAO,GAAGA,OAAO,IAAI,EAArB;EACAA,OAAO,CAACC,UAAR,GAAqBD,OAAO,CAACC,UAAR,KAAuB,KAA5C;EAEA;IAAA,sEAAO,iBAAMC,MAAN;MAAA;;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA;cAAA;cAAA,2BACoBA,MADpB;;YAAA;cAAA;cAAA;;YAAA;cAAA;gBAAA;gBAAA;cAAA;;cACYC,IADZ;cAAA;cAAA;cAAA,OAGKR,KAAK,CAACI,MAAD,CAHV;;YAAA;cAAA;cAAA;;YAAA;cAAA;cAAA;;cAAA,MAKG,YAAIK,OAAJ,KAAgB,eALnB;gBAAA;gBAAA;cAAA;;cAAA;;YAAA;cAAA;;YAAA;cASHL,MAAM,CAACM,IAAP,CAAYF,IAAZ;;YATG;cAAA;cAAA;cAAA;;YAAA;cAAA;cAAA;;YAAA;cAAA;cAAA;cAAA;cAAA;;YAAA;cAAA;cAAA;;cAAA;gBAAA;gBAAA;cAAA;;cAAA;cAAA;;YAAA;cAAA;;cAAA;gBAAA;gBAAA;cAAA;;cAAA;;YAAA;cAAA;;YAAA;cAAA;;YAAA;cAAA,MAYDH,OAAO,CAACC,UAAR,IAAsBF,MAAM,CAACO,UAAP,IAAqB,CAZ1C;gBAAA;gBAAA;cAAA;;cAAA,iCAaI,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;gBACtCV,MAAM,CAACW,gBAAP,CAAwB,OAAxB,EAAiC,UAAAC,KAAK,EAAI;kBACxC,IAAIA,KAAK,CAACC,QAAN,IAAkBD,KAAK,CAACE,IAAN,KAAe,IAArC,EAA2C;oBACzCL,OAAO;kBACR,CAFD,MAEO;oBACL,IAAMM,GAAG,GAAGC,MAAM,CAACC,MAAP,CAAc,IAAIC,KAAJ,CAAU,UAAV,CAAd,EAAqC;sBAAEN,KAAK,EAALA;oBAAF,CAArC,CAAZ;oBACAF,MAAM,CAACK,GAAD,CAAN;kBACD;gBACF,CAPD;gBASAI,UAAU,CAAC;kBAAA,OAAMnB,MAAM,CAACoB,KAAP,EAAN;gBAAA,CAAD,CAAV;cACD,CAXM,CAbJ;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAP;;IAAA;MAAA;IAAA;EAAA;AA2BD,CA/BD"},"metadata":{},"sourceType":"script"}