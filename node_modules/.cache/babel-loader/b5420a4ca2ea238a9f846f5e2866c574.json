{"ast":null,"code":"'use strict';\n\nconst Store = require('orbit-db-store');\n\nconst DocumentIndex = require('./DocumentIndex');\n\nconst pMap = require('p-map');\n\nconst Readable = require('readable-stream');\n\nconst replaceAll = (str, search, replacement) => str.toString().split(search).join(replacement);\n\nclass DocumentStore extends Store {\n  constructor(ipfs, id, dbname, options) {\n    if (!options) options = {};\n    if (!options.indexBy) Object.assign(options, {\n      indexBy: '_id'\n    });\n    if (!options.Index) Object.assign(options, {\n      Index: DocumentIndex\n    });\n    super(ipfs, id, dbname, options);\n    this._type = 'docstore';\n  }\n\n  get(key) {\n    let caseSensitive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    key = key.toString();\n    const terms = key.split(' ');\n    key = terms.length > 1 ? replaceAll(key, '.', ' ').toLowerCase() : key.toLowerCase();\n\n    const search = e => {\n      if (terms.length > 1) {\n        return replaceAll(e, '.', ' ').toLowerCase().indexOf(key) !== -1;\n      }\n\n      return e.toLowerCase().indexOf(key) !== -1;\n    };\n\n    const mapper = e => this._index.get(e);\n\n    const filter = e => caseSensitive ? e.indexOf(key) !== -1 : search(e);\n\n    return Object.keys(this._index._index).filter(filter).map(mapper);\n  }\n\n  query(mapper) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    // Whether we return the full operation data or just the db value\n    const fullOp = options.fullOp || false;\n    return Object.keys(this._index._index).map(e => this._index.get(e, fullOp)).filter(mapper);\n  }\n\n  batchPut(docs, onProgressCallback) {\n    const mapper = (doc, idx) => {\n      return this._addOperationBatch({\n        op: 'PUT',\n        key: doc[this.options.indexBy],\n        value: doc\n      }, true, idx === docs.length - 1, onProgressCallback);\n    };\n\n    return pMap(docs, mapper, {\n      concurrency: 1\n    }).then(() => this.saveSnapshot());\n  }\n\n  put(doc) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    if (!doc[this.options.indexBy]) {\n      throw new Error(`The provided document doesn't contain field '${this.options.indexBy}'`);\n    }\n\n    return this._addOperation({\n      op: 'PUT',\n      key: doc[this.options.indexBy],\n      value: doc\n    }, options);\n  }\n\n  putAll(docs) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    if (!Array.isArray(docs)) {\n      docs = [docs];\n    }\n\n    if (!docs.every(d => d[this.options.indexBy])) {\n      throw new Error(`The provided document doesn't contain field '${this.options.indexBy}'`);\n    }\n\n    return this._addOperation({\n      op: 'PUTALL',\n      docs: docs.map(value => ({\n        key: value[this.options.indexBy],\n        value\n      }))\n    }, options);\n  }\n\n  del(key) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    if (!this._index.get(key)) {\n      throw new Error(`No entry with key '${key}' in the database`);\n    }\n\n    return this._addOperation({\n      op: 'DEL',\n      key: key,\n      value: null\n    }, options);\n  }\n\n}\n\nmodule.exports = DocumentStore;","map":{"version":3,"names":["Store","require","DocumentIndex","pMap","Readable","replaceAll","str","search","replacement","toString","split","join","DocumentStore","constructor","ipfs","id","dbname","options","indexBy","Object","assign","Index","_type","get","key","caseSensitive","terms","length","toLowerCase","e","indexOf","mapper","_index","filter","keys","map","query","fullOp","batchPut","docs","onProgressCallback","doc","idx","_addOperationBatch","op","value","concurrency","then","saveSnapshot","put","Error","_addOperation","putAll","Array","isArray","every","d","del","module","exports"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/orbit-db-docstore/src/DocumentStore.js"],"sourcesContent":["'use strict'\n\nconst Store = require('orbit-db-store')\nconst DocumentIndex = require('./DocumentIndex')\nconst pMap = require('p-map')\nconst Readable = require('readable-stream')\n\nconst replaceAll = (str, search, replacement) => str.toString().split(search).join(replacement)\n\nclass DocumentStore extends Store {\n  constructor (ipfs, id, dbname, options) {\n    if (!options) options = {}\n    if (!options.indexBy) Object.assign(options, { indexBy: '_id' })\n    if (!options.Index) Object.assign(options, { Index: DocumentIndex })\n    super(ipfs, id, dbname, options)\n    this._type = 'docstore'\n  }\n\n  get (key, caseSensitive = false) {\n    key = key.toString()\n    const terms = key.split(' ')\n    key = terms.length > 1 ? replaceAll(key, '.', ' ').toLowerCase() : key.toLowerCase()\n\n    const search = (e) => {\n      if (terms.length > 1) {\n        return replaceAll(e, '.', ' ').toLowerCase().indexOf(key) !== -1\n      }\n      return e.toLowerCase().indexOf(key) !== -1\n    }\n    const mapper = e => this._index.get(e)\n    const filter = e => caseSensitive\n      ? e.indexOf(key) !== -1\n      : search(e)\n\n    return Object.keys(this._index._index)\n      .filter(filter)\n      .map(mapper)\n  }\n\n  query (mapper, options = {}) {\n    // Whether we return the full operation data or just the db value\n    const fullOp = options.fullOp || false\n\n    return Object.keys(this._index._index)\n      .map((e) => this._index.get(e, fullOp))\n      .filter(mapper)\n  }\n\n  batchPut (docs, onProgressCallback) {\n    const mapper = (doc, idx) => {\n      return this._addOperationBatch(\n        {\n          op: 'PUT',\n          key: doc[this.options.indexBy],\n          value: doc\n        },\n        true,\n        idx === docs.length - 1,\n        onProgressCallback\n      )\n    }\n\n    return pMap(docs, mapper, { concurrency: 1 })\n      .then(() => this.saveSnapshot())\n  }\n\n  put (doc, options = {}) {\n    if (!doc[this.options.indexBy]) { throw new Error(`The provided document doesn't contain field '${this.options.indexBy}'`) }\n\n    return this._addOperation({\n      op: 'PUT',\n      key: doc[this.options.indexBy],\n      value: doc\n    }, options)\n  }\n\n  putAll (docs, options = {}) {\n    if (!(Array.isArray(docs))) {\n      docs = [docs]\n    }\n    if (!(docs.every(d => d[this.options.indexBy]))) { throw new Error(`The provided document doesn't contain field '${this.options.indexBy}'`) }\n    return this._addOperation({\n      op: 'PUTALL',\n      docs: docs.map((value) => ({\n        key: value[this.options.indexBy],\n        value\n      }))\n    }, options)\n  }\n\n  del (key, options = {}) {\n    if (!this._index.get(key)) { throw new Error(`No entry with key '${key}' in the database`) }\n\n    return this._addOperation({\n      op: 'DEL',\n      key: key,\n      value: null\n    }, options)\n  }\n}\n\nmodule.exports = DocumentStore\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}