{"ast":null,"code":"import { Message } from \"@chatscope/chat-ui-kit-react\";\nimport { runInAction } from \"mobx\";\nexport class ChatRoom {\n  constructor(pubsub, roomName) {\n    this.pubsub = pubsub;\n    this.roomName = roomName;\n    this.textDecoder = new TextDecoder();\n  }\n\n  async setMessagesFromDb() {\n    const entries = [];\n    const all = await toJS(this.chatRoomMessagesDb.all);\n    all.map(e => entries.push(e.payload.value));\n    this.chatRoomMessages = entries;\n  }\n\n  async echo(msg) {\n    console.log(typeof msg.data);\n    console.log(msg); //TODO: nevim proc ale kdyz je to zprava odeslana ze stejneho peeru tak je to string a jinak je to object\n\n    if (typeof msg.data === \"object\") msg.data = this.textDecoder.decode(msg.data);\n    const date = new Date(Date.now());\n    const message = new Message(msg.from, msg.data, `${date.getHours()}:${date.getMinutes()}`, this.avatar.generateRandomAvatar(msg.from));\n    console.log(message);\n    this.chatRoomMessagesDb.add(message);\n    this.chatRoomMessages.push(message);\n  }\n\n  async connectToChatRoom(chatRoomName) {\n    runInAction(async () => {\n      await this.pubsub.subscribe(chatRoomName, await this.echo.bind(this));\n    });\n  }\n\n  async sendMessageToChatRoom(chatRoomName, message) {\n    runInAction(async () => {\n      await this.pubsub.publish(chatRoomName, message);\n    });\n  }\n\n}","map":{"version":3,"names":["Message","runInAction","ChatRoom","constructor","pubsub","roomName","textDecoder","TextDecoder","setMessagesFromDb","entries","all","toJS","chatRoomMessagesDb","map","e","push","payload","value","chatRoomMessages","echo","msg","console","log","data","decode","date","Date","now","message","from","getHours","getMinutes","avatar","generateRandomAvatar","add","connectToChatRoom","chatRoomName","subscribe","bind","sendMessageToChatRoom","publish"],"sources":["C:/Users/zajan/GitHub/chatApplication/src/data/models/Room.js"],"sourcesContent":["import { Message } from \"@chatscope/chat-ui-kit-react\";\r\nimport { runInAction } from \"mobx\";\r\n\r\nexport class ChatRoom {\r\n  pubsub;\r\n  roomName;\r\n  textDecoder;\r\n  chatMessagesDb;\r\n\r\n  constructor(pubsub, roomName) {\r\n    this.pubsub = pubsub;\r\n    this.roomName = roomName;\r\n    this.textDecoder = new TextDecoder();\r\n  }\r\n\r\n  async setMessagesFromDb() {\r\n    const entries = [];\r\n    const all = await toJS(this.chatRoomMessagesDb.all);\r\n    all.map((e) => entries.push(e.payload.value));\r\n    this.chatRoomMessages = entries;\r\n  }\r\n  async echo(msg) {\r\n    console.log(typeof msg.data);\r\n    console.log(msg);\r\n    //TODO: nevim proc ale kdyz je to zprava odeslana ze stejneho peeru tak je to string a jinak je to object\r\n    if (typeof msg.data === \"object\") msg.data = this.textDecoder.decode(msg.data);\r\n    const date = new Date(Date.now());\r\n    const message = new Message(msg.from, msg.data, `${date.getHours()}:${date.getMinutes()}`, this.avatar.generateRandomAvatar(msg.from));\r\n    console.log(message);\r\n    this.chatRoomMessagesDb.add(message);\r\n    this.chatRoomMessages.push(message);\r\n  }\r\n\r\n  async connectToChatRoom(chatRoomName) {\r\n    runInAction(async () => {\r\n      await this.pubsub.subscribe(chatRoomName, await this.echo.bind(this));\r\n    });\r\n  }\r\n\r\n  async sendMessageToChatRoom(chatRoomName, message) {\r\n    runInAction(async () => {\r\n      await this.pubsub.publish(chatRoomName, message);\r\n    });\r\n  }\r\n}\r\n"],"mappings":"AAAA,SAASA,OAAT,QAAwB,8BAAxB;AACA,SAASC,WAAT,QAA4B,MAA5B;AAEA,OAAO,MAAMC,QAAN,CAAe;EAMpBC,WAAW,CAACC,MAAD,EAASC,QAAT,EAAmB;IAC5B,KAAKD,MAAL,GAAcA,MAAd;IACA,KAAKC,QAAL,GAAgBA,QAAhB;IACA,KAAKC,WAAL,GAAmB,IAAIC,WAAJ,EAAnB;EACD;;EAEsB,MAAjBC,iBAAiB,GAAG;IACxB,MAAMC,OAAO,GAAG,EAAhB;IACA,MAAMC,GAAG,GAAG,MAAMC,IAAI,CAAC,KAAKC,kBAAL,CAAwBF,GAAzB,CAAtB;IACAA,GAAG,CAACG,GAAJ,CAASC,CAAD,IAAOL,OAAO,CAACM,IAAR,CAAaD,CAAC,CAACE,OAAF,CAAUC,KAAvB,CAAf;IACA,KAAKC,gBAAL,GAAwBT,OAAxB;EACD;;EACS,MAAJU,IAAI,CAACC,GAAD,EAAM;IACdC,OAAO,CAACC,GAAR,CAAY,OAAOF,GAAG,CAACG,IAAvB;IACAF,OAAO,CAACC,GAAR,CAAYF,GAAZ,EAFc,CAGd;;IACA,IAAI,OAAOA,GAAG,CAACG,IAAX,KAAoB,QAAxB,EAAkCH,GAAG,CAACG,IAAJ,GAAW,KAAKjB,WAAL,CAAiBkB,MAAjB,CAAwBJ,GAAG,CAACG,IAA5B,CAAX;IAClC,MAAME,IAAI,GAAG,IAAIC,IAAJ,CAASA,IAAI,CAACC,GAAL,EAAT,CAAb;IACA,MAAMC,OAAO,GAAG,IAAI5B,OAAJ,CAAYoB,GAAG,CAACS,IAAhB,EAAsBT,GAAG,CAACG,IAA1B,EAAiC,GAAEE,IAAI,CAACK,QAAL,EAAgB,IAAGL,IAAI,CAACM,UAAL,EAAkB,EAAxE,EAA2E,KAAKC,MAAL,CAAYC,oBAAZ,CAAiCb,GAAG,CAACS,IAArC,CAA3E,CAAhB;IACAR,OAAO,CAACC,GAAR,CAAYM,OAAZ;IACA,KAAKhB,kBAAL,CAAwBsB,GAAxB,CAA4BN,OAA5B;IACA,KAAKV,gBAAL,CAAsBH,IAAtB,CAA2Ba,OAA3B;EACD;;EAEsB,MAAjBO,iBAAiB,CAACC,YAAD,EAAe;IACpCnC,WAAW,CAAC,YAAY;MACtB,MAAM,KAAKG,MAAL,CAAYiC,SAAZ,CAAsBD,YAAtB,EAAoC,MAAM,KAAKjB,IAAL,CAAUmB,IAAV,CAAe,IAAf,CAA1C,CAAN;IACD,CAFU,CAAX;EAGD;;EAE0B,MAArBC,qBAAqB,CAACH,YAAD,EAAeR,OAAf,EAAwB;IACjD3B,WAAW,CAAC,YAAY;MACtB,MAAM,KAAKG,MAAL,CAAYoC,OAAZ,CAAoBJ,YAApB,EAAkCR,OAAlC,CAAN;IACD,CAFU,CAAX;EAGD;;AAxCmB"},"metadata":{},"sourceType":"module"}