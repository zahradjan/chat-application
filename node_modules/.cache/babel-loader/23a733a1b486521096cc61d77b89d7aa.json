{"ast":null,"code":"'use strict';\n\nvar _createForOfIteratorHelper = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\n\nvar _classCallCheck = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\n\nvar _createClass = require(\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/createClass.js\").default;\n\nvar DocumentIndex = /*#__PURE__*/function () {\n  function DocumentIndex() {\n    _classCallCheck(this, DocumentIndex);\n\n    this._index = {};\n  }\n\n  _createClass(DocumentIndex, [{\n    key: \"get\",\n    value: function get(key) {\n      var fullOp = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      return fullOp ? this._index[key] : this._index[key] ? this._index[key].payload.value : null;\n    }\n  }, {\n    key: \"updateIndex\",\n    value: function updateIndex(oplog, onProgressCallback) {\n      var _this = this;\n\n      var reducer = function reducer(handled, item, idx) {\n        if (item.payload.op === 'PUTALL' && item.payload.docs[Symbol.iterator]) {\n          var _iterator = _createForOfIteratorHelper(item.payload.docs),\n              _step;\n\n          try {\n            for (_iterator.s(); !(_step = _iterator.n()).done;) {\n              var doc = _step.value;\n\n              if (doc && handled[doc.key] !== true) {\n                handled[doc.key] = true;\n                _this._index[doc.key] = {\n                  payload: {\n                    op: 'PUT',\n                    key: doc.key,\n                    value: doc.value\n                  }\n                };\n              }\n            }\n          } catch (err) {\n            _iterator.e(err);\n          } finally {\n            _iterator.f();\n          }\n        } else if (handled[item.payload.key] !== true) {\n          handled[item.payload.key] = true;\n\n          if (item.payload.op === 'PUT') {\n            _this._index[item.payload.key] = item;\n          } else if (item.payload.op === 'DEL') {\n            delete _this._index[item.payload.key];\n          }\n        }\n\n        if (onProgressCallback) onProgressCallback(item, idx);\n        return handled;\n      };\n\n      oplog.values.slice().reverse().reduce(reducer, {});\n    }\n  }]);\n\n  return DocumentIndex;\n}();\n\nmodule.exports = DocumentIndex;","map":{"version":3,"names":["DocumentIndex","_index","key","fullOp","payload","value","oplog","onProgressCallback","reducer","handled","item","idx","op","docs","Symbol","iterator","doc","values","slice","reverse","reduce","module","exports"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/orbit-db-docstore/src/DocumentIndex.js"],"sourcesContent":["'use strict'\n\nclass DocumentIndex {\n  constructor () {\n    this._index = {}\n  }\n\n  get (key, fullOp = false) {\n    return fullOp\n      ? this._index[key]\n      : this._index[key] ? this._index[key].payload.value : null\n  }\n\n  updateIndex (oplog, onProgressCallback) {\n    const reducer = (handled, item, idx) => {\n      if (item.payload.op === 'PUTALL' && item.payload.docs[Symbol.iterator]) {\n        for (const doc of item.payload.docs) {\n          if (doc && handled[doc.key] !== true) {\n            handled[doc.key] = true\n            this._index[doc.key] = {\n              payload: {\n                op: 'PUT',\n                key: doc.key,\n                value: doc.value\n              }\n            }\n          }\n        }\n      } else if (handled[item.payload.key] !== true) {\n        handled[item.payload.key] = true\n        if (item.payload.op === 'PUT') {\n          this._index[item.payload.key] = item\n        } else if (item.payload.op === 'DEL') {\n          delete this._index[item.payload.key]\n        }\n      }\n      if (onProgressCallback) onProgressCallback(item, idx)\n      return handled\n    }\n\n    oplog.values\n      .slice()\n      .reverse()\n      .reduce(reducer, {})\n  }\n}\n\nmodule.exports = DocumentIndex\n"],"mappings":"AAAA;;;;;;;;IAEMA,a;EACJ,yBAAe;IAAA;;IACb,KAAKC,MAAL,GAAc,EAAd;EACD;;;;WAED,aAAKC,GAAL,EAA0B;MAAA,IAAhBC,MAAgB,uEAAP,KAAO;MACxB,OAAOA,MAAM,GACT,KAAKF,MAAL,CAAYC,GAAZ,CADS,GAET,KAAKD,MAAL,CAAYC,GAAZ,IAAmB,KAAKD,MAAL,CAAYC,GAAZ,EAAiBE,OAAjB,CAAyBC,KAA5C,GAAoD,IAFxD;IAGD;;;WAED,qBAAaC,KAAb,EAAoBC,kBAApB,EAAwC;MAAA;;MACtC,IAAMC,OAAO,GAAG,SAAVA,OAAU,CAACC,OAAD,EAAUC,IAAV,EAAgBC,GAAhB,EAAwB;QACtC,IAAID,IAAI,CAACN,OAAL,CAAaQ,EAAb,KAAoB,QAApB,IAAgCF,IAAI,CAACN,OAAL,CAAaS,IAAb,CAAkBC,MAAM,CAACC,QAAzB,CAApC,EAAwE;UAAA,2CACpDL,IAAI,CAACN,OAAL,CAAaS,IADuC;UAAA;;UAAA;YACtE,oDAAqC;cAAA,IAA1BG,GAA0B;;cACnC,IAAIA,GAAG,IAAIP,OAAO,CAACO,GAAG,CAACd,GAAL,CAAP,KAAqB,IAAhC,EAAsC;gBACpCO,OAAO,CAACO,GAAG,CAACd,GAAL,CAAP,GAAmB,IAAnB;gBACA,KAAI,CAACD,MAAL,CAAYe,GAAG,CAACd,GAAhB,IAAuB;kBACrBE,OAAO,EAAE;oBACPQ,EAAE,EAAE,KADG;oBAEPV,GAAG,EAAEc,GAAG,CAACd,GAFF;oBAGPG,KAAK,EAAEW,GAAG,CAACX;kBAHJ;gBADY,CAAvB;cAOD;YACF;UAZqE;YAAA;UAAA;YAAA;UAAA;QAavE,CAbD,MAaO,IAAII,OAAO,CAACC,IAAI,CAACN,OAAL,CAAaF,GAAd,CAAP,KAA8B,IAAlC,EAAwC;UAC7CO,OAAO,CAACC,IAAI,CAACN,OAAL,CAAaF,GAAd,CAAP,GAA4B,IAA5B;;UACA,IAAIQ,IAAI,CAACN,OAAL,CAAaQ,EAAb,KAAoB,KAAxB,EAA+B;YAC7B,KAAI,CAACX,MAAL,CAAYS,IAAI,CAACN,OAAL,CAAaF,GAAzB,IAAgCQ,IAAhC;UACD,CAFD,MAEO,IAAIA,IAAI,CAACN,OAAL,CAAaQ,EAAb,KAAoB,KAAxB,EAA+B;YACpC,OAAO,KAAI,CAACX,MAAL,CAAYS,IAAI,CAACN,OAAL,CAAaF,GAAzB,CAAP;UACD;QACF;;QACD,IAAIK,kBAAJ,EAAwBA,kBAAkB,CAACG,IAAD,EAAOC,GAAP,CAAlB;QACxB,OAAOF,OAAP;MACD,CAxBD;;MA0BAH,KAAK,CAACW,MAAN,CACGC,KADH,GAEGC,OAFH,GAGGC,MAHH,CAGUZ,OAHV,EAGmB,EAHnB;IAID;;;;;;AAGHa,MAAM,CAACC,OAAP,GAAiBtB,aAAjB"},"metadata":{},"sourceType":"script"}