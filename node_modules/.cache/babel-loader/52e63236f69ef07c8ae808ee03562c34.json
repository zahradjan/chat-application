{"ast":null,"code":"'use strict';\n\nconst batch = require('it-batch');\n/**\n * @template T\n * @typedef {{ok:true, value:T}} Success\n */\n\n/**\n * @typedef {{ok:false, err:Error}} Failure\n */\n\n/**\n * Takes an (async) iterator that emits promise-returning functions,\n * invokes them in parallel and emits the results as they become available but\n * in the same order as the input\n *\n * @template T\n * @param {AsyncIterable<() => Promise<T>>} source\n * @param {number} [size=1]\n * @returns {AsyncIterable<T>}\n */\n\n\nasync function* parallelBatch(source) {\n  let size = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n\n  for await (const tasks of batch(source, size)) {\n    /** @type {Promise<Success<T>|Failure>[]} */\n    const things = tasks.map(\n    /**\n     * @param {() => Promise<T>} p\n     */\n    p => {\n      return p().then(value => ({\n        ok: true,\n        value\n      }), err => ({\n        ok: false,\n        err\n      }));\n    });\n\n    for (let i = 0; i < things.length; i++) {\n      const result = await things[i];\n\n      if (result.ok) {\n        yield result.value;\n      } else {\n        throw result.err;\n      }\n    }\n  }\n}\n\nmodule.exports = parallelBatch;","map":{"version":3,"names":["batch","require","parallelBatch","source","size","tasks","things","map","p","then","value","ok","err","i","length","result","module","exports"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/it-parallel-batch/index.js"],"sourcesContent":["'use strict'\n\nconst batch = require('it-batch')\n\n/**\n * @template T\n * @typedef {{ok:true, value:T}} Success\n */\n\n/**\n * @typedef {{ok:false, err:Error}} Failure\n */\n\n/**\n * Takes an (async) iterator that emits promise-returning functions,\n * invokes them in parallel and emits the results as they become available but\n * in the same order as the input\n *\n * @template T\n * @param {AsyncIterable<() => Promise<T>>} source\n * @param {number} [size=1]\n * @returns {AsyncIterable<T>}\n */\nasync function * parallelBatch (source, size = 1) {\n  for await (const tasks of batch(source, size)) {\n    /** @type {Promise<Success<T>|Failure>[]} */\n    const things = tasks.map(\n      /**\n       * @param {() => Promise<T>} p\n       */\n      p => {\n        return p().then(value => ({ ok: true, value }), err => ({ ok: false, err }))\n      })\n\n    for (let i = 0; i < things.length; i++) {\n      const result = await things[i]\n\n      if (result.ok) {\n        yield result.value\n      } else {\n        throw result.err\n      }\n    }\n  }\n}\n\nmodule.exports = parallelBatch\n"],"mappings":"AAAA;;AAEA,MAAMA,KAAK,GAAGC,OAAO,CAAC,UAAD,CAArB;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,gBAAiBC,aAAjB,CAAgCC,MAAhC,EAAkD;EAAA,IAAVC,IAAU,uEAAH,CAAG;;EAChD,WAAW,MAAMC,KAAjB,IAA0BL,KAAK,CAACG,MAAD,EAASC,IAAT,CAA/B,EAA+C;IAC7C;IACA,MAAME,MAAM,GAAGD,KAAK,CAACE,GAAN;IACb;AACN;AACA;IACMC,CAAC,IAAI;MACH,OAAOA,CAAC,GAAGC,IAAJ,CAASC,KAAK,KAAK;QAAEC,EAAE,EAAE,IAAN;QAAYD;MAAZ,CAAL,CAAd,EAAyCE,GAAG,KAAK;QAAED,EAAE,EAAE,KAAN;QAAaC;MAAb,CAAL,CAA5C,CAAP;IACD,CANY,CAAf;;IAQA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGP,MAAM,CAACQ,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;MACtC,MAAME,MAAM,GAAG,MAAMT,MAAM,CAACO,CAAD,CAA3B;;MAEA,IAAIE,MAAM,CAACJ,EAAX,EAAe;QACb,MAAMI,MAAM,CAACL,KAAb;MACD,CAFD,MAEO;QACL,MAAMK,MAAM,CAACH,GAAb;MACD;IACF;EACF;AACF;;AAEDI,MAAM,CAACC,OAAP,GAAiBf,aAAjB"},"metadata":{},"sourceType":"script"}