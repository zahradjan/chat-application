{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Avatar,ChatContainer,ConversationHeader,InfoButton,Message,MessageInput,MessageList,VideoCallButton,VoiceCallButton}from\"@chatscope/chat-ui-kit-react\";import{toJS}from\"mobx\";import{observer}from\"mobx-react\";import{useEffect,useRef}from\"react\";import{FileIcon}from\"react-file-icon\";import{Link}from\"react-router-dom\";import{useFilePicker}from\"use-file-picker\";import{ContentColorLight,PrimaryColor}from\"../../constants/constants.js\";import{useStores}from\"../../data/store/RootStore.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var ChatRoom=observer(function(_ref){var room=_ref.room;var _useStores=useStores(),dataStore=_useStores.dataStore,roomStore=_useStores.roomStore;// const room = toJS(roomStore.selectedRoom);\nconsole.log(room);console.log(roomStore.selectedReceiver);// useEffect(() => {\n//   async function initRoom() {\n//     await room.init();\n//   }\n//   initRoom();\n// }, [room]);\nvar _useFilePicker=useFilePicker({accept:[\"*\"],readAs:\"ArrayBuffer\",multiple:false}),_useFilePicker2=_slicedToArray(_useFilePicker,2),openFileSelector=_useFilePicker2[0],filesContent=_useFilePicker2[1].filesContent;useEffect(function(){function loadFile(){return _loadFile.apply(this,arguments);}function _loadFile(){_loadFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(filesContent);if(!filesContent.length){_context.next=4;break;}_context.next=4;return room.uploadFile(filesContent);case 4:case\"end\":return _context.stop();}}},_callee);}));return _loadFile.apply(this,arguments);}loadFile();},[filesContent]);var data=toJS(room.chatRoomMessages);var nodeId=dataStore.peerId;return/*#__PURE__*/_jsxs(ChatContainer,{style:{backgroundColor:ContentColorLight},children:[/*#__PURE__*/_jsxs(ConversationHeader,{style:{backgroundColor:PrimaryColor},children:[/*#__PURE__*/_jsx(ConversationHeader.Back,{style:{backgroundColor:PrimaryColor}}),/*#__PURE__*/_jsx(ConversationHeader.Content,{style:{backgroundColor:PrimaryColor},userName:roomStore.selectedReceiver}),/*#__PURE__*/_jsxs(ConversationHeader.Actions,{children:[/*#__PURE__*/_jsx(VoiceCallButton,{}),/*#__PURE__*/_jsx(VideoCallButton,{}),/*#__PURE__*/_jsx(InfoButton,{})]})]}),/*#__PURE__*/_jsx(MessageList,{loading:!data,children:data?data.map(function(msg){if(msg.type===\"file\")console.log(msg.data.file);return msg.type===\"message\"?/*#__PURE__*/_jsxs(Message,{model:{direction:msg.from===nodeId?\"outgoing\":\"incoming\",position:\"first\",message:msg.data.msg},children:[/*#__PURE__*/_jsx(Avatar,{src:msg.avatar},msg._id),/*#__PURE__*/_jsx(Message.Footer,{sender:msg.data.sender,sentTime:msg.sentTime})]},msg._id):/*#__PURE__*/_jsxs(Message,{model:{direction:msg.from===nodeId?\"outgoing\":\"incoming\",position:\"first\"},children:[/*#__PURE__*/_jsx(Message.CustomContent,{children:room.fileIsImage(msg.data.msg.fileName)?/*#__PURE__*/_jsx(\"img\",{src:URL.createObjectURL(new Blob(msg.data.file)),alt:msg.data.msg.fileName,width:400,height:550}):/*#__PURE__*/_jsx(\"a\",{href:URL.createObjectURL(new Blob(msg.data.file)),download:msg.data.msg.fileName,children:msg.data.msg.fileName})}),/*#__PURE__*/_jsx(Avatar,{src:msg.avatar},msg._id),/*#__PURE__*/_jsx(Message.Footer,{sender:msg.data.sender,sentTime:msg.sentTime})]},msg._id);}):\"\"}),/*#__PURE__*/_jsx(MessageInput,{placeholder:\"Type message here\",onSend:function onSend(msg){room.sendMessageToChatRoom(msg);},onAttachClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",openFileSelector());case 1:case\"end\":return _context2.stop();}}},_callee2);}))})]});});","map":{"version":3,"names":["Avatar","ChatContainer","ConversationHeader","InfoButton","Message","MessageInput","MessageList","VideoCallButton","VoiceCallButton","toJS","observer","useEffect","useRef","FileIcon","Link","useFilePicker","ContentColorLight","PrimaryColor","useStores","ChatRoom","room","dataStore","roomStore","console","log","selectedReceiver","accept","readAs","multiple","openFileSelector","filesContent","loadFile","length","uploadFile","data","chatRoomMessages","nodeId","peerId","backgroundColor","map","msg","type","file","direction","from","position","message","avatar","_id","sender","sentTime","fileIsImage","fileName","URL","createObjectURL","Blob","sendMessageToChatRoom"],"sources":["C:/Users/zajan/GitHub/chatApplication/src/pages/chat/ChatRoom.js"],"sourcesContent":["import {\r\n  Avatar,\r\n  ChatContainer,\r\n  ConversationHeader,\r\n  InfoButton,\r\n  Message,\r\n  MessageInput,\r\n  MessageList,\r\n  VideoCallButton,\r\n  VoiceCallButton,\r\n} from \"@chatscope/chat-ui-kit-react\";\r\nimport { toJS } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { useEffect, useRef } from \"react\";\r\nimport { FileIcon } from \"react-file-icon\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useFilePicker } from \"use-file-picker\";\r\nimport { ContentColorLight, PrimaryColor } from \"../../constants/constants.js\";\r\nimport { useStores } from \"../../data/store/RootStore.js\";\r\n\r\nexport const ChatRoom = observer(({ room }) => {\r\n  const { dataStore, roomStore } = useStores();\r\n  // const room = toJS(roomStore.selectedRoom);\r\n  console.log(room);\r\n  console.log(roomStore.selectedReceiver);\r\n\r\n  // useEffect(() => {\r\n  //   async function initRoom() {\r\n  //     await room.init();\r\n  //   }\r\n  //   initRoom();\r\n  // }, [room]);\r\n  const [openFileSelector, { filesContent }] = useFilePicker({\r\n    accept: [\"*\"],\r\n    readAs: \"ArrayBuffer\",\r\n    multiple: false,\r\n  });\r\n  useEffect(() => {\r\n    async function loadFile() {\r\n      console.log(filesContent);\r\n      if (filesContent.length) await room.uploadFile(filesContent);\r\n    }\r\n    loadFile();\r\n  }, [filesContent]);\r\n\r\n  const data = toJS(room.chatRoomMessages);\r\n  const nodeId = dataStore.peerId;\r\n  return (\r\n    <ChatContainer style={{ backgroundColor: ContentColorLight }}>\r\n      <ConversationHeader style={{ backgroundColor: PrimaryColor }}>\r\n        <ConversationHeader.Back style={{ backgroundColor: PrimaryColor }} />\r\n        {/* <Avatar src={Chani} name=\"Zoe\" /> */}\r\n        <ConversationHeader.Content style={{ backgroundColor: PrimaryColor }} userName={roomStore.selectedReceiver} />\r\n        <ConversationHeader.Actions>\r\n          <VoiceCallButton />\r\n          <VideoCallButton />\r\n          <InfoButton />\r\n        </ConversationHeader.Actions>\r\n      </ConversationHeader>\r\n      <MessageList loading={!data}>\r\n        {data\r\n          ? data.map((msg) => {\r\n              if (msg.type === \"file\") console.log(msg.data.file);\r\n              return msg.type === \"message\" ? (\r\n                <Message key={msg._id} model={{ direction: msg.from === nodeId ? \"outgoing\" : \"incoming\", position: \"first\", message: msg.data.msg }}>\r\n                  <Avatar key={msg._id} src={msg.avatar}></Avatar>\r\n                  <Message.Footer sender={msg.data.sender} sentTime={msg.sentTime}></Message.Footer>\r\n                </Message>\r\n              ) : (\r\n                <Message key={msg._id} model={{ direction: msg.from === nodeId ? \"outgoing\" : \"incoming\", position: \"first\" }}>\r\n                  <Message.CustomContent>\r\n                    {room.fileIsImage(msg.data.msg.fileName) ? (\r\n                      <img src={URL.createObjectURL(new Blob(msg.data.file))} alt={msg.data.msg.fileName} width={400} height={550}></img>\r\n                    ) : (\r\n                      <a href={URL.createObjectURL(new Blob(msg.data.file))} download={msg.data.msg.fileName}>\r\n                        {/* <FileIcon extension={room.getFileExtension(msg.data.fileName)} labelTextStyle={{ width: 100, height: 100 }} type=\"image\" /> */}\r\n                        {msg.data.msg.fileName}\r\n                      </a>\r\n                    )}\r\n                  </Message.CustomContent>\r\n                  <Avatar key={msg._id} src={msg.avatar}></Avatar>\r\n                  <Message.Footer sender={msg.data.sender} sentTime={msg.sentTime}></Message.Footer>\r\n                </Message>\r\n              );\r\n            })\r\n          : \"\"}\r\n      </MessageList>\r\n      <MessageInput\r\n        placeholder=\"Type message here\"\r\n        onSend={(msg) => {\r\n          room.sendMessageToChatRoom(msg);\r\n        }}\r\n        onAttachClick={async () => openFileSelector()}\r\n      />\r\n    </ChatContainer>\r\n  );\r\n});\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}