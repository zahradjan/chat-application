{"ast":null,"code":"'use strict';\n\nconst map = require('it-map');\n\nconst errCode = require('err-code');\n\nconst {\n  PinTypes\n} = require('./pins');\n/**\n * @typedef {import('interface-datastore').Query} Query\n * @typedef {import('interface-datastore').Datastore} Datastore\n * @typedef {import('interface-datastore').Options} DatastoreOptions\n * @typedef {import('interface-blockstore').Blockstore} Blockstore\n * @typedef {import('multiformats/cid').CID} CID\n * @typedef {import('./pins').Pins} Pins\n */\n\n/**\n *\n * @param {Blockstore} blockstore\n */\n\n\nmodule.exports = createPinnedBlockstore;\n/**\n * @param {Pins} pins\n * @param {Blockstore} store\n * @returns {Blockstore}\n */\n\nfunction createPinnedBlockstore(pins, store) {\n  return {\n    open() {\n      return store.open();\n    },\n\n    close() {\n      return store.close();\n    },\n\n    query(query, options) {\n      return store.query(query, options);\n    },\n\n    queryKeys(query, options) {\n      return store.queryKeys(query, options);\n    },\n\n    async get(cid, options) {\n      return store.get(cid, options);\n    },\n\n    async *getMany(cids, options) {\n      yield* store.getMany(cids, options);\n    },\n\n    async put(cid, buf, options) {\n      await store.put(cid, buf, options);\n    },\n\n    async *putMany(pairs, options) {\n      yield* store.putMany(pairs, options);\n    },\n\n    has(cid, options) {\n      return store.has(cid, options);\n    },\n\n    async delete(cid, options) {\n      await ensureNotPinned(cid, pins);\n      return store.delete(cid, options);\n    },\n\n    deleteMany(cids, options) {\n      return store.deleteMany(map(cids, async cid => {\n        await ensureNotPinned(cid, pins);\n        return cid;\n      }), options);\n    },\n\n    batch() {\n      return store.batch();\n    }\n\n  };\n}\n/**\n * @param {CID} cid\n * @param {Pins} pins\n */\n\n\nasync function ensureNotPinned(cid, pins) {\n  const {\n    pinned,\n    reason\n  } = await pins.isPinnedWithType(cid, PinTypes.all);\n\n  if (pinned) {\n    throw errCode(new Error(`pinned: ${reason}`), 'ERR_BLOCK_PINNED');\n  }\n}","map":{"version":3,"names":["map","require","errCode","PinTypes","module","exports","createPinnedBlockstore","pins","store","open","close","query","options","queryKeys","get","cid","getMany","cids","put","buf","putMany","pairs","has","delete","ensureNotPinned","deleteMany","batch","pinned","reason","isPinnedWithType","all","Error"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/ipfs-repo/src/pinned-blockstore.js"],"sourcesContent":["'use strict'\n\nconst map = require('it-map')\nconst errCode = require('err-code')\nconst { PinTypes } = require('./pins')\n\n/**\n * @typedef {import('interface-datastore').Query} Query\n * @typedef {import('interface-datastore').Datastore} Datastore\n * @typedef {import('interface-datastore').Options} DatastoreOptions\n * @typedef {import('interface-blockstore').Blockstore} Blockstore\n * @typedef {import('multiformats/cid').CID} CID\n * @typedef {import('./pins').Pins} Pins\n */\n\n/**\n *\n * @param {Blockstore} blockstore\n */\nmodule.exports = createPinnedBlockstore\n\n/**\n * @param {Pins} pins\n * @param {Blockstore} store\n * @returns {Blockstore}\n */\nfunction createPinnedBlockstore (pins, store) {\n  return {\n    open () {\n      return store.open()\n    },\n\n    close () {\n      return store.close()\n    },\n\n    query (query, options) {\n      return store.query(query, options)\n    },\n\n    queryKeys (query, options) {\n      return store.queryKeys(query, options)\n    },\n\n    async get (cid, options) {\n      return store.get(cid, options)\n    },\n\n    async * getMany (cids, options) {\n      yield * store.getMany(cids, options)\n    },\n\n    async put (cid, buf, options) {\n      await store.put(cid, buf, options)\n    },\n\n    async * putMany (pairs, options) {\n      yield * store.putMany(pairs, options)\n    },\n\n    has (cid, options) {\n      return store.has(cid, options)\n    },\n\n    async delete (cid, options) {\n      await ensureNotPinned(cid, pins)\n\n      return store.delete(cid, options)\n    },\n\n    deleteMany (cids, options) {\n      return store.deleteMany(map(cids, async cid => {\n        await ensureNotPinned(cid, pins)\n\n        return cid\n      }), options)\n    },\n\n    batch () {\n      return store.batch()\n    }\n  }\n}\n\n/**\n * @param {CID} cid\n * @param {Pins} pins\n */\nasync function ensureNotPinned (cid, pins) {\n  const { pinned, reason } = await pins.isPinnedWithType(cid, PinTypes.all)\n\n  if (pinned) {\n    throw errCode(new Error(`pinned: ${reason}`), 'ERR_BLOCK_PINNED')\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}