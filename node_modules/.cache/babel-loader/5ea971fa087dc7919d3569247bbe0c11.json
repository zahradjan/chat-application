{"ast":null,"code":"'use strict';\n\nclass DocumentIndex {\n  constructor() {\n    this._index = {};\n  }\n\n  get(key) {\n    let fullOp = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    return fullOp ? this._index[key] : this._index[key] ? this._index[key].payload.value : null;\n  }\n\n  updateIndex(oplog, onProgressCallback) {\n    const reducer = (handled, item, idx) => {\n      if (item.payload.op === 'PUTALL' && item.payload.docs[Symbol.iterator]) {\n        for (const doc of item.payload.docs) {\n          if (doc && handled[doc.key] !== true) {\n            handled[doc.key] = true;\n            this._index[doc.key] = {\n              payload: {\n                op: 'PUT',\n                key: doc.key,\n                value: doc.value\n              }\n            };\n          }\n        }\n      } else if (handled[item.payload.key] !== true) {\n        handled[item.payload.key] = true;\n\n        if (item.payload.op === 'PUT') {\n          this._index[item.payload.key] = item;\n        } else if (item.payload.op === 'DEL') {\n          delete this._index[item.payload.key];\n        }\n      }\n\n      if (onProgressCallback) onProgressCallback(item, idx);\n      return handled;\n    };\n\n    oplog.values.slice().reverse().reduce(reducer, {});\n  }\n\n}\n\nmodule.exports = DocumentIndex;","map":{"version":3,"names":["DocumentIndex","constructor","_index","get","key","fullOp","payload","value","updateIndex","oplog","onProgressCallback","reducer","handled","item","idx","op","docs","Symbol","iterator","doc","values","slice","reverse","reduce","module","exports"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/orbit-db-docstore/src/DocumentIndex.js"],"sourcesContent":["'use strict'\n\nclass DocumentIndex {\n  constructor () {\n    this._index = {}\n  }\n\n  get (key, fullOp = false) {\n    return fullOp\n      ? this._index[key]\n      : this._index[key] ? this._index[key].payload.value : null\n  }\n\n  updateIndex (oplog, onProgressCallback) {\n    const reducer = (handled, item, idx) => {\n      if (item.payload.op === 'PUTALL' && item.payload.docs[Symbol.iterator]) {\n        for (const doc of item.payload.docs) {\n          if (doc && handled[doc.key] !== true) {\n            handled[doc.key] = true\n            this._index[doc.key] = {\n              payload: {\n                op: 'PUT',\n                key: doc.key,\n                value: doc.value\n              }\n            }\n          }\n        }\n      } else if (handled[item.payload.key] !== true) {\n        handled[item.payload.key] = true\n        if (item.payload.op === 'PUT') {\n          this._index[item.payload.key] = item\n        } else if (item.payload.op === 'DEL') {\n          delete this._index[item.payload.key]\n        }\n      }\n      if (onProgressCallback) onProgressCallback(item, idx)\n      return handled\n    }\n\n    oplog.values\n      .slice()\n      .reverse()\n      .reduce(reducer, {})\n  }\n}\n\nmodule.exports = DocumentIndex\n"],"mappings":"AAAA;;AAEA,MAAMA,aAAN,CAAoB;EAClBC,WAAW,GAAI;IACb,KAAKC,MAAL,GAAc,EAAd;EACD;;EAEDC,GAAG,CAAEC,GAAF,EAAuB;IAAA,IAAhBC,MAAgB,uEAAP,KAAO;IACxB,OAAOA,MAAM,GACT,KAAKH,MAAL,CAAYE,GAAZ,CADS,GAET,KAAKF,MAAL,CAAYE,GAAZ,IAAmB,KAAKF,MAAL,CAAYE,GAAZ,EAAiBE,OAAjB,CAAyBC,KAA5C,GAAoD,IAFxD;EAGD;;EAEDC,WAAW,CAAEC,KAAF,EAASC,kBAAT,EAA6B;IACtC,MAAMC,OAAO,GAAG,CAACC,OAAD,EAAUC,IAAV,EAAgBC,GAAhB,KAAwB;MACtC,IAAID,IAAI,CAACP,OAAL,CAAaS,EAAb,KAAoB,QAApB,IAAgCF,IAAI,CAACP,OAAL,CAAaU,IAAb,CAAkBC,MAAM,CAACC,QAAzB,CAApC,EAAwE;QACtE,KAAK,MAAMC,GAAX,IAAkBN,IAAI,CAACP,OAAL,CAAaU,IAA/B,EAAqC;UACnC,IAAIG,GAAG,IAAIP,OAAO,CAACO,GAAG,CAACf,GAAL,CAAP,KAAqB,IAAhC,EAAsC;YACpCQ,OAAO,CAACO,GAAG,CAACf,GAAL,CAAP,GAAmB,IAAnB;YACA,KAAKF,MAAL,CAAYiB,GAAG,CAACf,GAAhB,IAAuB;cACrBE,OAAO,EAAE;gBACPS,EAAE,EAAE,KADG;gBAEPX,GAAG,EAAEe,GAAG,CAACf,GAFF;gBAGPG,KAAK,EAAEY,GAAG,CAACZ;cAHJ;YADY,CAAvB;UAOD;QACF;MACF,CAbD,MAaO,IAAIK,OAAO,CAACC,IAAI,CAACP,OAAL,CAAaF,GAAd,CAAP,KAA8B,IAAlC,EAAwC;QAC7CQ,OAAO,CAACC,IAAI,CAACP,OAAL,CAAaF,GAAd,CAAP,GAA4B,IAA5B;;QACA,IAAIS,IAAI,CAACP,OAAL,CAAaS,EAAb,KAAoB,KAAxB,EAA+B;UAC7B,KAAKb,MAAL,CAAYW,IAAI,CAACP,OAAL,CAAaF,GAAzB,IAAgCS,IAAhC;QACD,CAFD,MAEO,IAAIA,IAAI,CAACP,OAAL,CAAaS,EAAb,KAAoB,KAAxB,EAA+B;UACpC,OAAO,KAAKb,MAAL,CAAYW,IAAI,CAACP,OAAL,CAAaF,GAAzB,CAAP;QACD;MACF;;MACD,IAAIM,kBAAJ,EAAwBA,kBAAkB,CAACG,IAAD,EAAOC,GAAP,CAAlB;MACxB,OAAOF,OAAP;IACD,CAxBD;;IA0BAH,KAAK,CAACW,MAAN,CACGC,KADH,GAEGC,OAFH,GAGGC,MAHH,CAGUZ,OAHV,EAGmB,EAHnB;EAID;;AA1CiB;;AA6CpBa,MAAM,CAACC,OAAP,GAAiBzB,aAAjB"},"metadata":{},"sourceType":"script"}