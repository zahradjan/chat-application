{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/createClass.js\";import IpfsPubsubPeerMonitor from\"ipfs-pubsub-peer-monitor\";import{makeAutoObservable,runInAction,toJS}from\"mobx\";export var MonitorStore=/*#__PURE__*/function(){function MonitorStore(rootStore){_classCallCheck(this,MonitorStore);this.rootStore=rootStore;this.monitor=undefined;this.peersDb=undefined;this.peers=[];this.topicName=\"DecentioGlobalNetwork\";this.texDecoder=new TextDecoder();makeAutoObservable(this);}_createClass(MonitorStore,[{key:\"init\",value:function(){var _init=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _this=this;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(this.rootStore.dataStore.ipfsNode===undefined)){_context2.next=2;break;}throw Error(\"IPFS Node not defined!\");case 2:if(!(this.rootStore.dataStore.orbitDb===undefined)){_context2.next=4;break;}throw Error(\"OrbitDb not defined!\");case 4:runInAction(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.subscribeToOwnPubsub();case 2:_context.next=4;return _this.subscribeToDecentioPubsub();case 4:_context.next=6;return _this.loadPeersDb();case 6:_context.next=8;return _this.setPeersFromDb();case 8:_this.monitor=new IpfsPubsubPeerMonitor(_this.rootStore.dataStore.ipfsNode.pubsub,_this.topicName);_context.next=11;return _this.listenForJoinedPeers();case 11:_context.next=13;return _this.listenForLeftPeers();case 13:case\"end\":return _context.stop();}}},_callee);})));case 5:case\"end\":return _context2.stop();}}},_callee2,this);}));function init(){return _init.apply(this,arguments);}return init;}()},{key:\"isMonitorReady\",value:function(){var _isMonitorReady=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",this.monitor);case 1:case\"end\":return _context3.stop();}}},_callee3,this);}));function isMonitorReady(){return _isMonitorReady.apply(this,arguments);}return isMonitorReady;}()},{key:\"setPeersFromDb\",value:function(){var _setPeersFromDb=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var _this2=this;var all;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return toJS(this.peersDb.all);case 2:all=_context4.sent;runInAction(function(){all.map(function(e){// console.log(e.payload.value);\nreturn _this2.peers.push(e.payload.value);});});case 4:case\"end\":return _context4.stop();}}},_callee4,this);}));function setPeersFromDb(){return _setPeersFromDb.apply(this,arguments);}return setPeersFromDb;}()},{key:\"listenForJoinedPeers\",value:function(){var _listenForJoinedPeers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(){var _this3=this;return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:this.monitor.on(\"join\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(peerJoined){return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:console.log(\"Peer joined: \"+peerJoined);_context6.t0=console;_context6.t1=\"Peers on Pubsub \".concat(_this3.topicName,\": \");_context6.next=5;return _this3.monitor.getPeers();case 5:_context6.t2=_context6.sent;_context6.t3=_context6.t1+_context6.t2;_context6.t0.log.call(_context6.t0,_context6.t3);setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var peerInDb;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:peerInDb=_this3.peerIsInDb(peerJoined);if(!peerInDb){_context5.next=4;break;}_context5.next=6;break;case 4:_context5.next=6;return _this3.sendUserDbId(peerJoined);case 6:case\"end\":return _context5.stop();}}},_callee5);})),2000);case 9:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x){return _ref2.apply(this,arguments);};}());case 1:case\"end\":return _context7.stop();}}},_callee7,this);}));function listenForJoinedPeers(){return _listenForJoinedPeers.apply(this,arguments);}return listenForJoinedPeers;}()},{key:\"listenForLeftPeers\",value:function(){var _listenForLeftPeers=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(){var _this4=this;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:this.monitor.on(\"leave\",/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(peerLeft){return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:console.log(\"Peer left: \"+peerLeft);_context8.t0=console;_context8.t1=\"Peers on Pubsub \".concat(_this4.topicName,\": \");_context8.next=5;return _this4.monitor.getPeers();case 5:_context8.t2=_context8.sent;_context8.t3=_context8.t1+_context8.t2;_context8.t0.log.call(_context8.t0,_context8.t3);case 8:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x2){return _ref4.apply(this,arguments);};}());case 1:case\"end\":return _context9.stop();}}},_callee9,this);}));function listenForLeftPeers(){return _listenForLeftPeers.apply(this,arguments);}return listenForLeftPeers;}()},{key:\"peerIsInDb\",value:function peerIsInDb(peer){console.log(peer);var peers=toJS(this.peers);console.log(toJS(this.peers));return peers.find(function(item){return item.user.peerId===peer;});}},{key:\"savePeer\",value:function(){var _savePeer=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11(peer){var _this5=this;return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:runInAction(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(){return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:console.log(!_this5.peerIsInDb(peer));if(_this5.peerIsInDb(peer)){_context10.next=5;break;}_this5.peers.push(peer);_context10.next=5;return _this5.peersDb.add(peer);case 5:case\"end\":return _context10.stop();}}},_callee10);})));case 1:case\"end\":return _context11.stop();}}},_callee11);}));function savePeer(_x3){return _savePeer.apply(this,arguments);}return savePeer;}()},{key:\"removePeer\",value:function(){var _removePeer=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12(peer){var entry;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return this.peersDb.iterator().collect().map(function(item){return item.payload.value===peer?item:undefined;});case 2:entry=_context12.sent;console.log(entry);if(!entry){_context12.next=7;break;}_context12.next=7;return this.peersDb.remove(entry[0].hash);case 7:case\"end\":return _context12.stop();}}},_callee12,this);}));function removePeer(_x4){return _removePeer.apply(this,arguments);}return removePeer;}()},{key:\"sendUserDbId\",value:function(){var _sendUserDbId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee13(peer){var userDbId,stringifyPayload;return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:console.log(this.peerIsInDb(peer));_context13.next=3;return this.rootStore.userStore.getUserDbId();case 3:userDbId=_context13.sent;stringifyPayload=JSON.stringify({userDb:userDbId});console.log(stringifyPayload);_context13.next=8;return this.rootStore.dataStore.ipfsNode.pubsub.publish(peer,stringifyPayload);case 8:case\"end\":return _context13.stop();}}},_callee13,this);}));function sendUserDbId(_x5){return _sendUserDbId.apply(this,arguments);}return sendUserDbId;}()},{key:\"subscribeToOwnPubsub\",value:function(){var _subscribeToOwnPubsub=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee15(){var _this6=this;var peerInfoId;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:peerInfoId=this.rootStore.dataStore.peerId;console.log(\"Peer ID: \"+peerInfoId);_context15.next=4;return this.rootStore.dataStore.ipfsNode.pubsub.subscribe(peerInfoId,/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee14(msg){var parsedMsg,room,targetRoom;return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:console.log(msg.data);// this.processMessage(msg);\nif(typeof msg.data===\"object\")msg.data=_this6.texDecoder.decode(msg.data);parsedMsg=JSON.parse(msg.data);console.log(parsedMsg);console.log(parsedMsg.userDb);//TODO: tahle podminka vubec nefunguje\nif(!parsedMsg.userDb){_context14.next=15;break;}_context14.next=8;return _this6.replicateUserDb(parsedMsg);case 8:_context14.next=10;return _this6.rootStore.roomStore.createRoom(msg.from);case 10:room=_context14.sent;_context14.next=13;return room.init();case 13:_context14.next=18;break;case 15:targetRoom=_this6.rootStore.roomStore.getRoom(msg.from);console.log(targetRoom);if(targetRoom){targetRoom.setMessage(msg);}case 18:case\"end\":return _context14.stop();}}},_callee14);}));return function(_x6){return _ref6.apply(this,arguments);};}());case 4:case\"end\":return _context15.stop();}}},_callee15,this);}));function subscribeToOwnPubsub(){return _subscribeToOwnPubsub.apply(this,arguments);}return subscribeToOwnPubsub;}()},{key:\"subscribeToDecentioPubsub\",value:function(){var _subscribeToDecentioPubsub=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee16(){return _regeneratorRuntime().wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:_context16.next=2;return this.rootStore.dataStore.ipfsNode.pubsub.subscribe(\"DecentioGlobalNetwork\",function(){});case 2:case\"end\":return _context16.stop();}}},_callee16,this);}));function subscribeToDecentioPubsub(){return _subscribeToDecentioPubsub.apply(this,arguments);}return subscribeToDecentioPubsub;}()},{key:\"replicateUserDb\",value:function(){var _replicateUserDb=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee18(parsedMsg){var _this7=this;var peerDbOuter;return _regeneratorRuntime().wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:_context18.next=2;return this.rootStore.dataStore.orbitDb.open(parsedMsg.userDb);case 2:peerDbOuter=_context18.sent;peerDbOuter.events.on(\"replicated\",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee17(){return _regeneratorRuntime().wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:console.log(\"DB replicated\");_context17.next=3;return _this7.peersDb.add(peerDbOuter.all);case 3:console.log(peerDbOuter.all);_this7.peers.push(peerDbOuter.all);console.log(_this7.peersDb.all);console.log(_this7.peers);case 7:case\"end\":return _context17.stop();}}},_callee17);})));case 4:case\"end\":return _context18.stop();}}},_callee18,this);}));function replicateUserDb(_x7){return _replicateUserDb.apply(this,arguments);}return replicateUserDb;}()},{key:\"loadPeersDb\",value:function(){var _loadPeersDb=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee19(){return _regeneratorRuntime().wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:_context19.next=2;return this.rootStore.dataStore.orbitDb.feed(\"peers\");case 2:this.peersDb=_context19.sent;_context19.next=5;return this.peersDb.load();case 5:case\"end\":return _context19.stop();}}},_callee19,this);}));function loadPeersDb(){return _loadPeersDb.apply(this,arguments);}return loadPeersDb;}()},{key:\"replicatePeersDB\",value:function replicatePeersDB(){var _this8=this;setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee20(){var nodeId,peersDbId;return _regeneratorRuntime().wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:_context20.next=2;return _this8.rootStore.dataStore.getPeerId();case 2:nodeId=_context20.sent;_context20.next=5;return _this8.peersDb.id;case 5:peersDbId=_context20.sent;console.log(nodeId);_context20.next=9;return _this8.peersDb.all.map(function(peer){var peerId=peer.payload.value;if(peerId!==nodeId){console.log(\"jsem tu \");console.log(peerId);console.log(peersDbId);var stringifyPayload=JSON.stringify({peerDb:peersDbId});_this8.rootStore.dataStore.ipfsNode.pubsub.publish(peerId,stringifyPayload);}});case 9:case\"end\":return _context20.stop();}}},_callee20);})),2000);}},{key:\"processMessage\",value:function processMessage(msg){if(typeof msg.data===\"object\")msg.data=this.texDecoder.decode(msg.data);}},{key:\"getPeersDbId\",value:function(){var _getPeersDbId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee21(){var id;return _regeneratorRuntime().wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:_context21.next=2;return this.peersDb.id;case 2:id=_context21.sent;return _context21.abrupt(\"return\",id);case 4:case\"end\":return _context21.stop();}}},_callee21,this);}));function getPeersDbId(){return _getPeersDbId.apply(this,arguments);}return getPeersDbId;}()}]);return MonitorStore;}();","map":{"version":3,"names":["IpfsPubsubPeerMonitor","makeAutoObservable","runInAction","toJS","MonitorStore","rootStore","monitor","undefined","peersDb","peers","topicName","texDecoder","TextDecoder","dataStore","ipfsNode","Error","orbitDb","subscribeToOwnPubsub","subscribeToDecentioPubsub","loadPeersDb","setPeersFromDb","pubsub","listenForJoinedPeers","listenForLeftPeers","all","map","e","push","payload","value","on","peerJoined","console","log","getPeers","setTimeout","peerInDb","peerIsInDb","sendUserDbId","peerLeft","peer","find","item","user","peerId","add","iterator","collect","entry","remove","hash","userStore","getUserDbId","userDbId","stringifyPayload","JSON","stringify","userDb","publish","peerInfoId","subscribe","msg","data","decode","parsedMsg","parse","replicateUserDb","roomStore","createRoom","from","room","init","targetRoom","getRoom","setMessage","open","peerDbOuter","events","feed","load","getPeerId","nodeId","id","peersDbId","peerDb"],"sources":["C:/Users/zajan/GitHub/chatApplication/src/data/store/MonitorStore.js"],"sourcesContent":["import IpfsPubsubPeerMonitor from \"ipfs-pubsub-peer-monitor\";\r\nimport { makeAutoObservable, runInAction, toJS } from \"mobx\";\r\n\r\nexport class MonitorStore {\r\n  monitor;\r\n  topicName;\r\n  peers;\r\n  peersDb;\r\n  texDecoder;\r\n  constructor(rootStore) {\r\n    this.rootStore = rootStore;\r\n    this.monitor = undefined;\r\n    this.peersDb = undefined;\r\n    this.peers = [];\r\n    this.topicName = \"DecentioGlobalNetwork\";\r\n    this.texDecoder = new TextDecoder();\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  async init() {\r\n    if (this.rootStore.dataStore.ipfsNode === undefined) throw Error(\"IPFS Node not defined!\");\r\n    if (this.rootStore.dataStore.orbitDb === undefined) throw Error(\"OrbitDb not defined!\");\r\n    runInAction(async () => {\r\n      await this.subscribeToOwnPubsub();\r\n      await this.subscribeToDecentioPubsub();\r\n      await this.loadPeersDb();\r\n      await this.setPeersFromDb();\r\n      this.monitor = new IpfsPubsubPeerMonitor(this.rootStore.dataStore.ipfsNode.pubsub, this.topicName);\r\n      await this.listenForJoinedPeers();\r\n      await this.listenForLeftPeers();\r\n    });\r\n  }\r\n  async isMonitorReady() {\r\n    return this.monitor;\r\n  }\r\n\r\n  async setPeersFromDb() {\r\n    const all = await toJS(this.peersDb.all);\r\n    runInAction(() => {\r\n      all.map((e) => {\r\n        // console.log(e.payload.value);\r\n        return this.peers.push(e.payload.value);\r\n      });\r\n    });\r\n  }\r\n\r\n  async listenForJoinedPeers() {\r\n    this.monitor.on(\"join\", async (peerJoined) => {\r\n      console.log(\"Peer joined: \" + peerJoined);\r\n      console.log(`Peers on Pubsub ${this.topicName}: ` + (await this.monitor.getPeers()));\r\n      setTimeout(async () => {\r\n        let peerInDb = this.peerIsInDb(peerJoined);\r\n\r\n        if (peerInDb) {\r\n          // const room = await this.rootStore.roomStore.getRoom(peerJoined);\r\n          // //mozna lepsi ten init\r\n          // await room.connectToChatRoom();\r\n        } else {\r\n          await this.sendUserDbId(peerJoined);\r\n          // const room = await this.rootStore.roomStore.createRoom(peerJoined);\r\n          // await room.init();\r\n        }\r\n      }, 2000);\r\n    });\r\n  }\r\n\r\n  async listenForLeftPeers() {\r\n    this.monitor.on(\"leave\", async (peerLeft) => {\r\n      console.log(\"Peer left: \" + peerLeft);\r\n      console.log(`Peers on Pubsub ${this.topicName}: ` + (await this.monitor.getPeers()));\r\n      // await this.removePeer(peerLeft);\r\n    });\r\n  }\r\n\r\n  peerIsInDb(peer) {\r\n    console.log(peer);\r\n    const peers = toJS(this.peers);\r\n    console.log(toJS(this.peers));\r\n    return peers.find((item) => item.user.peerId === peer);\r\n  }\r\n\r\n  async savePeer(peer) {\r\n    runInAction(async () => {\r\n      console.log(!this.peerIsInDb(peer));\r\n      if (!this.peerIsInDb(peer)) {\r\n        this.peers.push(peer);\r\n        await this.peersDb.add(peer);\r\n      }\r\n    });\r\n  }\r\n  async removePeer(peer) {\r\n    const entry = await this.peersDb\r\n      .iterator()\r\n      .collect()\r\n      .map((item) => (item.payload.value === peer ? item : undefined));\r\n    console.log(entry);\r\n    if (entry) {\r\n      await this.peersDb.remove(entry[0].hash);\r\n    }\r\n  }\r\n  async sendUserDbId(peer) {\r\n    console.log(this.peerIsInDb(peer));\r\n\r\n    const userDbId = await this.rootStore.userStore.getUserDbId();\r\n\r\n    const stringifyPayload = JSON.stringify({ userDb: userDbId });\r\n    console.log(stringifyPayload);\r\n    await this.rootStore.dataStore.ipfsNode.pubsub.publish(peer, stringifyPayload);\r\n  }\r\n\r\n  async subscribeToOwnPubsub() {\r\n    const peerInfoId = this.rootStore.dataStore.peerId;\r\n    console.log(\"Peer ID: \" + peerInfoId);\r\n    await this.rootStore.dataStore.ipfsNode.pubsub.subscribe(peerInfoId, async (msg) => {\r\n      console.log(msg.data);\r\n\r\n      // this.processMessage(msg);\r\n      if (typeof msg.data === \"object\") msg.data = this.texDecoder.decode(msg.data);\r\n      const parsedMsg = JSON.parse(msg.data);\r\n      console.log(parsedMsg);\r\n      console.log(parsedMsg.userDb);\r\n      //TODO: tahle podminka vubec nefunguje\r\n\r\n      if (parsedMsg.userDb) {\r\n        await this.replicateUserDb(parsedMsg);\r\n        const room = await this.rootStore.roomStore.createRoom(msg.from);\r\n        await room.init();\r\n      } else {\r\n        const targetRoom = this.rootStore.roomStore.getRoom(msg.from);\r\n        console.log(targetRoom);\r\n        if (targetRoom) {\r\n          targetRoom.setMessage(msg);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  async subscribeToDecentioPubsub() {\r\n    await this.rootStore.dataStore.ipfsNode.pubsub.subscribe(\"DecentioGlobalNetwork\", () => {});\r\n  }\r\n\r\n  async replicateUserDb(parsedMsg) {\r\n    var peerDbOuter = await this.rootStore.dataStore.orbitDb.open(parsedMsg.userDb);\r\n    peerDbOuter.events.on(\"replicated\", async () => {\r\n      console.log(\"DB replicated\");\r\n      await this.peersDb.add(peerDbOuter.all);\r\n      console.log(peerDbOuter.all);\r\n      this.peers.push(peerDbOuter.all);\r\n      console.log(this.peersDb.all);\r\n      console.log(this.peers);\r\n    });\r\n  }\r\n\r\n  async loadPeersDb() {\r\n    this.peersDb = await this.rootStore.dataStore.orbitDb.feed(\"peers\");\r\n    await this.peersDb.load();\r\n  }\r\n\r\n  replicatePeersDB() {\r\n    setTimeout(async () => {\r\n      const nodeId = await this.rootStore.dataStore.getPeerId();\r\n      const peersDbId = await this.peersDb.id;\r\n      console.log(nodeId);\r\n      await this.peersDb.all.map((peer) => {\r\n        const peerId = peer.payload.value;\r\n        if (peerId !== nodeId) {\r\n          console.log(\"jsem tu \");\r\n          console.log(peerId);\r\n          console.log(peersDbId);\r\n          const stringifyPayload = JSON.stringify({ peerDb: peersDbId });\r\n          this.rootStore.dataStore.ipfsNode.pubsub.publish(peerId, stringifyPayload);\r\n        }\r\n      });\r\n    }, 2000);\r\n  }\r\n  processMessage(msg) {\r\n    if (typeof msg.data === \"object\") msg.data = this.texDecoder.decode(msg.data);\r\n  }\r\n  async getPeersDbId() {\r\n    const id = await this.peersDb.id;\r\n    return id;\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}