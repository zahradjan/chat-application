{"ast":null,"code":"'use strict';\n\nconst debug = require('debug');\n\nconst log = Object.assign(debug('libp2p:ping'), {\n  error: debug('libp2p:ping:err')\n});\n\nconst errCode = require('err-code');\n\nconst crypto = require('libp2p-crypto');\n\nconst {\n  pipe\n} = require('it-pipe'); // @ts-ignore it-buffer has no types exported\n\n\nconst {\n  toBuffer\n} = require('it-buffer');\n\nconst {\n  collect,\n  take\n} = require('streaming-iterables');\n\nconst {\n  equals\n} = require('uint8arrays/equals');\n\nconst {\n  PROTOCOL_NAME,\n  PING_LENGTH,\n  PROTOCOL_VERSION\n} = require('./constants');\n/**\n * @typedef {import('../')} Libp2p\n * @typedef {import('multiaddr').Multiaddr} Multiaddr\n * @typedef {import('peer-id')} PeerId\n * @typedef {import('libp2p-interfaces/src/stream-muxer/types').MuxedStream} MuxedStream\n */\n\n/**\n * Ping a given peer and wait for its response, getting the operation latency.\n *\n * @param {Libp2p} node\n * @param {PeerId|Multiaddr} peer\n * @returns {Promise<number>}\n */\n\n\nasync function ping(node, peer) {\n  const protocol = `/${node._config.protocolPrefix}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`; // @ts-ignore multiaddr might not have toB58String\n\n  log('dialing %s to %s', protocol, peer.toB58String ? peer.toB58String() : peer);\n  const connection = await node.dial(peer);\n  const {\n    stream\n  } = await connection.newStream(protocol);\n  const start = Date.now();\n  const data = crypto.randomBytes(PING_LENGTH);\n  const [result] = await pipe([data], stream, (\n  /** @type {MuxedStream} */\n  stream) => take(1, stream), toBuffer, collect);\n  const end = Date.now();\n\n  if (!equals(data, result)) {\n    throw errCode(new Error('Received wrong ping ack'), 'ERR_WRONG_PING_ACK');\n  }\n\n  return end - start;\n}\n/**\n * Subscribe ping protocol handler.\n *\n * @param {Libp2p} node\n */\n\n\nfunction mount(node) {\n  node.handle(`/${node._config.protocolPrefix}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`, _ref => {\n    let {\n      stream\n    } = _ref;\n    return pipe(stream, stream);\n  });\n}\n/**\n * Unsubscribe ping protocol handler.\n *\n * @param {Libp2p} node\n */\n\n\nfunction unmount(node) {\n  node.unhandle(`/${node._config.protocolPrefix}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`);\n}\n\nexports = module.exports = ping;\nexports.mount = mount;\nexports.unmount = unmount;","map":{"version":3,"names":["debug","require","log","Object","assign","error","errCode","crypto","pipe","toBuffer","collect","take","equals","PROTOCOL_NAME","PING_LENGTH","PROTOCOL_VERSION","ping","node","peer","protocol","_config","protocolPrefix","toB58String","connection","dial","stream","newStream","start","Date","now","data","randomBytes","result","end","Error","mount","handle","unmount","unhandle","exports","module"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/libp2p/src/ping/index.js"],"sourcesContent":["'use strict'\n\nconst debug = require('debug')\nconst log = Object.assign(debug('libp2p:ping'), {\n  error: debug('libp2p:ping:err')\n})\nconst errCode = require('err-code')\n\nconst crypto = require('libp2p-crypto')\nconst { pipe } = require('it-pipe')\n// @ts-ignore it-buffer has no types exported\nconst { toBuffer } = require('it-buffer')\nconst { collect, take } = require('streaming-iterables')\nconst { equals } = require('uint8arrays/equals')\n\nconst { PROTOCOL_NAME, PING_LENGTH, PROTOCOL_VERSION } = require('./constants')\n\n/**\n * @typedef {import('../')} Libp2p\n * @typedef {import('multiaddr').Multiaddr} Multiaddr\n * @typedef {import('peer-id')} PeerId\n * @typedef {import('libp2p-interfaces/src/stream-muxer/types').MuxedStream} MuxedStream\n */\n\n/**\n * Ping a given peer and wait for its response, getting the operation latency.\n *\n * @param {Libp2p} node\n * @param {PeerId|Multiaddr} peer\n * @returns {Promise<number>}\n */\nasync function ping (node, peer) {\n  const protocol = `/${node._config.protocolPrefix}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`\n  // @ts-ignore multiaddr might not have toB58String\n  log('dialing %s to %s', protocol, peer.toB58String ? peer.toB58String() : peer)\n\n  const connection = await node.dial(peer)\n  const { stream } = await connection.newStream(protocol)\n\n  const start = Date.now()\n  const data = crypto.randomBytes(PING_LENGTH)\n\n  const [result] = await pipe(\n    [data],\n    stream,\n    (/** @type {MuxedStream} */ stream) => take(1, stream),\n    toBuffer,\n    collect\n  )\n  const end = Date.now()\n\n  if (!equals(data, result)) {\n    throw errCode(new Error('Received wrong ping ack'), 'ERR_WRONG_PING_ACK')\n  }\n\n  return end - start\n}\n\n/**\n * Subscribe ping protocol handler.\n *\n * @param {Libp2p} node\n */\nfunction mount (node) {\n  node.handle(`/${node._config.protocolPrefix}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`, ({ stream }) => pipe(stream, stream))\n}\n\n/**\n * Unsubscribe ping protocol handler.\n *\n * @param {Libp2p} node\n */\nfunction unmount (node) {\n  node.unhandle(`/${node._config.protocolPrefix}/${PROTOCOL_NAME}/${PROTOCOL_VERSION}`)\n}\n\nexports = module.exports = ping\nexports.mount = mount\nexports.unmount = unmount\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}