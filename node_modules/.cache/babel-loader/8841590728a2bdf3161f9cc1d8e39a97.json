{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/zajan/GitHub/chatApplication/node_modules/@babel/runtime/helpers/esm/createClass.js\";import Cookies from\"js-cookie\";import{makeAutoObservable}from\"mobx\";var cookieKey=\"orbit-chat-username\";var SessionStore=/*#__PURE__*/function(){function SessionStore(rootStore){_classCallCheck(this,SessionStore);this.rootStore=rootStore;this._user=undefined;makeAutoObservable(this);}_createClass(SessionStore,[{key:\"init\",value:function(){var _init=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.loadFromCache();case 2:case\"end\":return _context.stop();}}},_callee,this);}));function init(){return _init.apply(this,arguments);}return init;}()},{key:\"_readUserFromCache\",value:function _readUserFromCache(){var username=Cookies.get(cookieKey);return username?username:null;}},{key:\"isAuthenticated\",value:function isAuthenticated(){return!!this._user;}},{key:\"_setUser\",value:function(){var _setUser2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(user){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(user){_context2.next=2;break;}throw new Error('\"username\" is not defined');case 2:// ;if (user && !user.username) throw new Error('\"user.username\" is not defined')\nthis._cacheUser(user);this._user=user;case 4:case\"end\":return _context2.stop();}}},_callee2,this);}));function _setUser(_x){return _setUser2.apply(this,arguments);}return _setUser;}()},{key:\"_cacheUser\",value:function _cacheUser(user){if(user){Cookies.set(cookieKey,user);}else{Cookies.remove(cookieKey);}}},{key:\"loadFromCache\",value:function(){var _loadFromCache=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var cached;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:cached=this._readUserFromCache();if(!cached){_context3.next=4;break;}_context3.next=4;return this.login(cached);case 4:case\"end\":return _context3.stop();}}},_callee3,this);}));function loadFromCache(){return _loadFromCache.apply(this,arguments);}return loadFromCache;}()},{key:\"login\",value:function(){var _login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(user){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:console.log(\"User login\");_context4.next=3;return this._setUser(user);case 3:return _context4.abrupt(\"return\",_context4.sent);case 4:case\"end\":return _context4.stop();}}},_callee4,this);}));function login(_x2){return _login.apply(this,arguments);}return login;}()},{key:\"logout\",value:function logout(){console.log(\"User logout\");return this._setUser(null);}}]);return SessionStore;}();export{SessionStore as default};","map":{"version":3,"names":["Cookies","makeAutoObservable","cookieKey","SessionStore","rootStore","_user","undefined","loadFromCache","username","get","user","Error","_cacheUser","set","remove","cached","_readUserFromCache","login","console","log","_setUser"],"sources":["C:/Users/zajan/GitHub/chatApplication/src/data/store/SessionStore.js"],"sourcesContent":["import Cookies from \"js-cookie\";\r\nimport { makeAutoObservable } from \"mobx\";\r\nconst cookieKey = \"orbit-chat-username\";\r\nexport default class SessionStore {\r\n  _user;\r\n\r\n  constructor(rootStore) {\r\n    this.rootStore = rootStore;\r\n    this._user = undefined;\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  async init() {\r\n    await this.loadFromCache();\r\n  }\r\n  _readUserFromCache() {\r\n    const username = Cookies.get(cookieKey);\r\n    return username ? username : null;\r\n  }\r\n  isAuthenticated() {\r\n    return !!this._user;\r\n  }\r\n\r\n  async _setUser(user) {\r\n    if (!user) throw new Error('\"username\" is not defined');\r\n    // ;if (user && !user.username) throw new Error('\"user.username\" is not defined')\r\n    this._cacheUser(user);\r\n    this._user = user;\r\n  }\r\n\r\n  _cacheUser(user) {\r\n    if (user) {\r\n      Cookies.set(cookieKey, user);\r\n    } else {\r\n      Cookies.remove(cookieKey);\r\n    }\r\n  }\r\n\r\n  async loadFromCache() {\r\n    const cached = this._readUserFromCache();\r\n    if (cached) await this.login(cached);\r\n  }\r\n\r\n  async login(user) {\r\n    console.log(\"User login\");\r\n    return await this._setUser(user);\r\n  }\r\n\r\n  logout() {\r\n    console.log(\"User logout\");\r\n    return this._setUser(null);\r\n  }\r\n}\r\n"],"mappings":"0fAAA,MAAOA,QAAP,KAAoB,WAApB,CACA,OAASC,kBAAT,KAAmC,MAAnC,CACA,GAAMC,UAAS,CAAG,qBAAlB,C,GACqBC,a,yBAGnB,sBAAYC,SAAZ,CAAuB,oCACrB,KAAKA,SAAL,CAAiBA,SAAjB,CACA,KAAKC,KAAL,CAAaC,SAAb,CACAL,kBAAkB,CAAC,IAAD,CAAlB,CACD,C,4HAED,2JACQ,MAAKM,aAAL,EADR,4D,wGAGA,6BAAqB,CACnB,GAAMC,SAAQ,CAAGR,OAAO,CAACS,GAAR,CAAYP,SAAZ,CAAjB,CACA,MAAOM,SAAQ,CAAGA,QAAH,CAAc,IAA7B,CACD,C,+BACD,0BAAkB,CAChB,MAAO,CAAC,CAAC,KAAKH,KAAd,CACD,C,2GAED,kBAAeK,IAAf,2HACOA,IADP,+BACmB,IAAIC,MAAJ,CAAU,2BAAV,CADnB,QAEE;AACA,KAAKC,UAAL,CAAgBF,IAAhB,EACA,KAAKL,KAAL,CAAaK,IAAb,CAJF,6D,8GAOA,oBAAWA,IAAX,CAAiB,CACf,GAAIA,IAAJ,CAAU,CACRV,OAAO,CAACa,GAAR,CAAYX,SAAZ,CAAuBQ,IAAvB,EACD,CAFD,IAEO,CACLV,OAAO,CAACc,MAAR,CAAeZ,SAAf,EACD,CACF,C,qHAED,qJACQa,MADR,CACiB,KAAKC,kBAAL,EADjB,KAEMD,MAFN,iDAEoB,MAAKE,KAAL,CAAWF,MAAX,CAFpB,8D,sMAKA,kBAAYL,IAAZ,wHACEQ,OAAO,CAACC,GAAR,CAAY,YAAZ,EADF,uBAEe,MAAKC,QAAL,CAAcV,IAAd,CAFf,sH,kGAKA,iBAAS,CACPQ,OAAO,CAACC,GAAR,CAAY,aAAZ,EACA,MAAO,MAAKC,QAAL,CAAc,IAAd,CAAP,CACD,C,mCAhDkBjB,Y"},"metadata":{},"sourceType":"module"}