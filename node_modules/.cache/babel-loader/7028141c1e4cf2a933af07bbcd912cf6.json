{"ast":null,"code":"'use strict';\n\nconst {\n  equals: uint8ArrayEquals\n} = require('uint8arrays/equals');\n\nconst Message = require('../../message');\n\nconst utils = require('../../utils');\n/**\n * @typedef {import('peer-id')} PeerId\n */\n\n/**\n * @param {import('../../index')} dht\n */\n\n\nmodule.exports = dht => {\n  const log = utils.logger(dht.peerId, 'rpc:find-node');\n  /**\n   * Process `FindNode` DHT messages.\n   *\n   * @param {PeerId} peerId\n   * @param {Message} msg\n   */\n\n  async function findNode(peerId, msg) {\n    log('start');\n    let closer;\n\n    if (uint8ArrayEquals(msg.key, dht.peerId.id)) {\n      closer = [{\n        id: dht.peerId,\n        multiaddrs: dht.libp2p.multiaddrs\n      }];\n    } else {\n      closer = await dht._betterPeersToQuery(msg, peerId);\n    }\n\n    const response = new Message(msg.type, new Uint8Array(0), msg.clusterLevel);\n\n    if (closer.length > 0) {\n      response.closerPeers = closer;\n    } else {\n      log('handle FindNode %s: could not find anything', peerId.toB58String());\n    }\n\n    return response;\n  }\n\n  return findNode;\n};","map":{"version":3,"names":["equals","uint8ArrayEquals","require","Message","utils","module","exports","dht","log","logger","peerId","findNode","msg","closer","key","id","multiaddrs","libp2p","_betterPeersToQuery","response","type","Uint8Array","clusterLevel","length","closerPeers","toB58String"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/libp2p-kad-dht/src/rpc/handlers/find-node.js"],"sourcesContent":["'use strict'\n\nconst { equals: uint8ArrayEquals } = require('uint8arrays/equals')\n\nconst Message = require('../../message')\nconst utils = require('../../utils')\n\n/**\n * @typedef {import('peer-id')} PeerId\n */\n\n/**\n * @param {import('../../index')} dht\n */\nmodule.exports = (dht) => {\n  const log = utils.logger(dht.peerId, 'rpc:find-node')\n\n  /**\n   * Process `FindNode` DHT messages.\n   *\n   * @param {PeerId} peerId\n   * @param {Message} msg\n   */\n  async function findNode (peerId, msg) {\n    log('start')\n\n    let closer\n    if (uint8ArrayEquals(msg.key, dht.peerId.id)) {\n      closer = [{\n        id: dht.peerId,\n        multiaddrs: dht.libp2p.multiaddrs\n      }]\n    } else {\n      closer = await dht._betterPeersToQuery(msg, peerId)\n    }\n\n    const response = new Message(msg.type, new Uint8Array(0), msg.clusterLevel)\n\n    if (closer.length > 0) {\n      response.closerPeers = closer\n    } else {\n      log('handle FindNode %s: could not find anything', peerId.toB58String())\n    }\n\n    return response\n  }\n\n  return findNode\n}\n"],"mappings":"AAAA;;AAEA,MAAM;EAAEA,MAAM,EAAEC;AAAV,IAA+BC,OAAO,CAAC,oBAAD,CAA5C;;AAEA,MAAMC,OAAO,GAAGD,OAAO,CAAC,eAAD,CAAvB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAC,aAAD,CAArB;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AACAG,MAAM,CAACC,OAAP,GAAkBC,GAAD,IAAS;EACxB,MAAMC,GAAG,GAAGJ,KAAK,CAACK,MAAN,CAAaF,GAAG,CAACG,MAAjB,EAAyB,eAAzB,CAAZ;EAEA;AACF;AACA;AACA;AACA;AACA;;EACE,eAAeC,QAAf,CAAyBD,MAAzB,EAAiCE,GAAjC,EAAsC;IACpCJ,GAAG,CAAC,OAAD,CAAH;IAEA,IAAIK,MAAJ;;IACA,IAAIZ,gBAAgB,CAACW,GAAG,CAACE,GAAL,EAAUP,GAAG,CAACG,MAAJ,CAAWK,EAArB,CAApB,EAA8C;MAC5CF,MAAM,GAAG,CAAC;QACRE,EAAE,EAAER,GAAG,CAACG,MADA;QAERM,UAAU,EAAET,GAAG,CAACU,MAAJ,CAAWD;MAFf,CAAD,CAAT;IAID,CALD,MAKO;MACLH,MAAM,GAAG,MAAMN,GAAG,CAACW,mBAAJ,CAAwBN,GAAxB,EAA6BF,MAA7B,CAAf;IACD;;IAED,MAAMS,QAAQ,GAAG,IAAIhB,OAAJ,CAAYS,GAAG,CAACQ,IAAhB,EAAsB,IAAIC,UAAJ,CAAe,CAAf,CAAtB,EAAyCT,GAAG,CAACU,YAA7C,CAAjB;;IAEA,IAAIT,MAAM,CAACU,MAAP,GAAgB,CAApB,EAAuB;MACrBJ,QAAQ,CAACK,WAAT,GAAuBX,MAAvB;IACD,CAFD,MAEO;MACLL,GAAG,CAAC,6CAAD,EAAgDE,MAAM,CAACe,WAAP,EAAhD,CAAH;IACD;;IAED,OAAON,QAAP;EACD;;EAED,OAAOR,QAAP;AACD,CAlCD"},"metadata":{},"sourceType":"script"}