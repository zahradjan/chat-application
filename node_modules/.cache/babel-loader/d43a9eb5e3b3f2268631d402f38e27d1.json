{"ast":null,"code":"import { createTrackingData } from \"./reactionCleanupTrackingCommon\";\n/**\n * FinalizationRegistry-based uncommitted reaction cleanup\n */\n\nexport function createReactionCleanupTrackingUsingFinalizationRegister(FinalizationRegistry) {\n  var cleanupTokenToReactionTrackingMap = new Map();\n  var globalCleanupTokensCounter = 1;\n  var registry = new FinalizationRegistry(function cleanupFunction(token) {\n    var trackedReaction = cleanupTokenToReactionTrackingMap.get(token);\n\n    if (trackedReaction) {\n      trackedReaction.reaction.dispose();\n      cleanupTokenToReactionTrackingMap.delete(token);\n    }\n  });\n  return {\n    addReactionToTrack: function addReactionToTrack(reactionTrackingRef, reaction, objectRetainedByReact) {\n      var token = globalCleanupTokensCounter++;\n      registry.register(objectRetainedByReact, token, reactionTrackingRef);\n      reactionTrackingRef.current = createTrackingData(reaction);\n      reactionTrackingRef.current.finalizationRegistryCleanupToken = token;\n      cleanupTokenToReactionTrackingMap.set(token, reactionTrackingRef.current);\n      return reactionTrackingRef.current;\n    },\n    recordReactionAsCommitted: function recordReactionAsCommitted(reactionRef) {\n      registry.unregister(reactionRef);\n\n      if (reactionRef.current && reactionRef.current.finalizationRegistryCleanupToken) {\n        cleanupTokenToReactionTrackingMap.delete(reactionRef.current.finalizationRegistryCleanupToken);\n      }\n    },\n    forceCleanupTimerToRunNowForTests: function forceCleanupTimerToRunNowForTests() {// When FinalizationRegistry in use, this this is no-op\n    },\n    resetCleanupScheduleForTests: function resetCleanupScheduleForTests() {// When FinalizationRegistry in use, this this is no-op\n    }\n  };\n}","map":{"version":3,"mappings":"AAEA,SAGIA,kBAHJ,QAIO,iCAJP;AAMA;;;;AAGA,OAAM,SAAUC,sDAAV,CACFC,oBADE,EAC0E;EAE5E,IAAMC,iCAAiC,GAAG,IAAIC,GAAJ,EAA1C;EACA,IAAIC,0BAA0B,GAAG,CAAjC;EAEA,IAAMC,QAAQ,GAAG,IAAIJ,oBAAJ,CAAyB,SAASK,eAAT,CAAyBC,KAAzB,EAAsC;IAC5E,IAAMC,eAAe,GAAGN,iCAAiC,CAACO,GAAlC,CAAsCF,KAAtC,CAAxB;;IACA,IAAIC,eAAJ,EAAqB;MACjBA,eAAe,CAACE,QAAhB,CAAyBC,OAAzB;MACAT,iCAAiC,CAACU,MAAlC,CAAyCL,KAAzC;IACH;EACJ,CANgB,CAAjB;EAQA,OAAO;IACHM,kBAAkB,EAAlB,4BACIC,mBADJ,EAEIJ,QAFJ,EAGIK,qBAHJ,EAGiC;MAE7B,IAAMR,KAAK,GAAGH,0BAA0B,EAAxC;MAEAC,QAAQ,CAACW,QAAT,CAAkBD,qBAAlB,EAAyCR,KAAzC,EAAgDO,mBAAhD;MACAA,mBAAmB,CAACG,OAApB,GAA8BlB,kBAAkB,CAACW,QAAD,CAAhD;MACAI,mBAAmB,CAACG,OAApB,CAA4BC,gCAA5B,GAA+DX,KAA/D;MACAL,iCAAiC,CAACiB,GAAlC,CAAsCZ,KAAtC,EAA6CO,mBAAmB,CAACG,OAAjE;MAEA,OAAOH,mBAAmB,CAACG,OAA3B;IACH,CAdE;IAeHG,yBAAyB,EAAzB,mCAA0BC,WAA1B,EAAuF;MACnFhB,QAAQ,CAACiB,UAAT,CAAoBD,WAApB;;MAEA,IAAIA,WAAW,CAACJ,OAAZ,IAAuBI,WAAW,CAACJ,OAAZ,CAAoBC,gCAA/C,EAAiF;QAC7EhB,iCAAiC,CAACU,MAAlC,CACIS,WAAW,CAACJ,OAAZ,CAAoBC,gCADxB;MAGH;IACJ,CAvBE;IAwBHK,iCAAiC,gDAC7B;IACH,CA1BE;IA2BHC,4BAA4B,2CACxB;IACH;EA7BE,CAAP;AA+BH","names":["createTrackingData","createReactionCleanupTrackingUsingFinalizationRegister","FinalizationRegistry","cleanupTokenToReactionTrackingMap","Map","globalCleanupTokensCounter","registry","cleanupFunction","token","trackedReaction","get","reaction","dispose","delete","addReactionToTrack","reactionTrackingRef","objectRetainedByReact","register","current","finalizationRegistryCleanupToken","set","recordReactionAsCommitted","reactionRef","unregister","forceCleanupTimerToRunNowForTests","resetCleanupScheduleForTests"],"sourceRoot":"","sources":["../../src/utils/createReactionCleanupTrackingUsingFinalizationRegister.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}