{"ast":null,"code":"'use strict';\n\nconst Logger = require('logplease');\n\nconst logger = Logger.create('cache', {\n  color: Logger.Colors.Magenta\n});\nLogger.setLogLevel('ERROR');\n\nclass Cache {\n  constructor(store) {\n    this._store = store;\n  }\n\n  get status() {\n    return this._store.db.status;\n  }\n\n  async close() {\n    if (!this._store) return Promise.reject(new Error('No cache store found to close'));\n\n    if (this.status === 'open') {\n      await this._store.close();\n      return Promise.resolve();\n    }\n  }\n\n  async open() {\n    if (!this._store) return Promise.reject(new Error('No cache store found to open'));\n\n    if (this.status !== 'open') {\n      await this._store.open();\n      return Promise.resolve();\n    }\n  }\n\n  async get(key) {\n    return new Promise((resolve, reject) => {\n      this._store.get(key, (err, value) => {\n        if (err) {\n          // Ignore error if key was not found\n          if (err.toString().indexOf('NotFoundError: Key not found in database') === -1 && err.toString().indexOf('NotFound') === -1) {\n            return reject(err);\n          }\n        }\n\n        resolve(value ? JSON.parse(value) : null);\n      });\n    });\n  } // Set value in the cache and return the new value\n\n\n  set(key, value) {\n    return new Promise((resolve, reject) => {\n      this._store.put(key, JSON.stringify(value), err => {\n        if (err) {\n          // Ignore error if key was not found\n          if (err.toString().indexOf('NotFoundError: Key not found in database') === -1 && err.toString().indexOf('NotFound') === -1) {\n            return reject(err);\n          }\n        }\n\n        logger.debug(`cache: Set ${key} to ${value}`);\n        resolve();\n      });\n    });\n  }\n\n  load() {} // noop\n\n\n  destroy() {} // noop\n  // Remove a value and key from the cache\n\n\n  async del(key) {\n    return new Promise((resolve, reject) => {\n      this._store.del(key, err => {\n        if (err) {\n          // Ignore error if key was not found\n          if (err.toString().indexOf('NotFoundError: Key not found in database') === -1 && err.toString().indexOf('NotFound') === -1) {\n            return reject(err);\n          }\n        }\n\n        resolve();\n      });\n    });\n  }\n\n}\n\nmodule.exports = Cache;","map":{"version":3,"names":["Logger","require","logger","create","color","Colors","Magenta","setLogLevel","Cache","constructor","store","_store","status","db","close","Promise","reject","Error","resolve","open","get","key","err","value","toString","indexOf","JSON","parse","set","put","stringify","debug","load","destroy","del","module","exports"],"sources":["C:/Users/zajan/GitHub/chatApplication/node_modules/orbit-db-cache/src/Cache.js"],"sourcesContent":["'use strict'\n\nconst Logger = require('logplease')\nconst logger = Logger.create('cache', { color: Logger.Colors.Magenta })\nLogger.setLogLevel('ERROR')\n\nclass Cache {\n  constructor (store) {\n    this._store = store\n  }\n\n  get status () { return this._store.db.status }\n\n  async close () {\n    if (!this._store) return Promise.reject(new Error('No cache store found to close'))\n    if (this.status === 'open') {\n      await this._store.close()\n      return Promise.resolve()\n    }\n  }\n\n  async open () {\n    if (!this._store) return Promise.reject(new Error('No cache store found to open'))\n    if (this.status !== 'open') {\n      await this._store.open()\n      return Promise.resolve()\n    }\n  }\n\n  async get (key) {\n    return new Promise((resolve, reject) => {\n      this._store.get(key, (err, value) => {\n        if (err) {\n          // Ignore error if key was not found\n          if (err.toString().indexOf('NotFoundError: Key not found in database') === -1 &&\n            err.toString().indexOf('NotFound') === -1) {\n            return reject(err)\n          }\n        }\n        resolve(value ? JSON.parse(value) : null)\n      })\n    })\n  }\n\n  // Set value in the cache and return the new value\n  set (key, value) {\n    return new Promise((resolve, reject) => {\n      this._store.put(key, JSON.stringify(value), (err) => {\n        if (err) {\n          // Ignore error if key was not found\n          if (err.toString().indexOf('NotFoundError: Key not found in database') === -1 &&\n            err.toString().indexOf('NotFound') === -1) {\n            return reject(err)\n          }\n        }\n        logger.debug(`cache: Set ${key} to ${value}`)\n        resolve()\n      })\n    })\n  }\n\n  load () {} // noop\n  destroy () { } // noop\n\n  // Remove a value and key from the cache\n  async del (key) {\n    return new Promise((resolve, reject) => {\n      this._store.del(key, (err) => {\n        if (err) {\n          // Ignore error if key was not found\n          if (err.toString().indexOf('NotFoundError: Key not found in database') === -1 &&\n            err.toString().indexOf('NotFound') === -1) {\n            return reject(err)\n          }\n        }\n        resolve()\n      })\n    })\n  }\n}\n\nmodule.exports = Cache\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}