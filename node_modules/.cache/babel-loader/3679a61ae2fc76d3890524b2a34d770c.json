{"ast":null,"code":"import { makeAutoObservable, runInAction } from \"mobx\";\nimport User from \"../models/User.js\";\nexport default class UserStore {\n  constructor(rootStore) {\n    this.rootStore = rootStore;\n    this.userDb = undefined;\n    makeAutoObservable(this);\n  }\n\n  async init() {\n    await this.setUserStore();\n  }\n\n  isUserStoreReady() {\n    return this.userDb;\n  }\n\n  async setUserStore() {\n    if (this.rootStore.dataStore.orbitDb === undefined) throw Error(\"OrbitDb not defined!\");\n    const defaultOptions = {\n      accessController: {\n        write: [\"*\"]\n      }\n    };\n    this.userDb = await this.rootStore.dataStore.orbitDb.kvstore(\"user\", defaultOptions);\n    await this.userDb.load();\n  }\n\n  async createUser(username, password) {\n    const peersId = [];\n    const peerId = this.rootStore.dataStore.peerId;\n    peersId.push(peerId);\n    const user = new User(username, peersId, password);\n    await this.userDb.set(\"user\", user);\n  }\n\n  async setUser(user) {\n    console.log(user.identity);\n    console.log(user);\n    this.userDb = await this.rootStore.dataStore.orbitDb.open(user.identity);\n    const peerId = this.rootStore.dataStore.peerId; // // console.log(user);\n\n    user.data.user.peerId.push(peerId); // // console.log(user);\n\n    await this.userDb.set(\"user\", user);\n    console.log(user);\n  } // async updatePeerId() {\n  //   const peerId = this.rootStore.dataStore.peerId;\n  //   this.updateUserField(\"peerId\", [...peerId]);\n  // }\n\n\n  async deleteProfileField(key) {\n    const cid = await this.userDb.del(key);\n    return cid;\n  }\n\n  getAllProfileFields() {\n    return this.userDb.all;\n  }\n\n  getProfileField(key) {\n    return this.userDb.get(key);\n  }\n\n  async updateUserField(key, value) {\n    const cid = await this.userDb.set(key, value);\n    return cid;\n  }\n\n  async getUserDbId() {\n    const id = await this.userDb.id;\n    return id;\n  }\n\n}","map":{"version":3,"names":["makeAutoObservable","runInAction","User","UserStore","constructor","rootStore","userDb","undefined","init","setUserStore","isUserStoreReady","dataStore","orbitDb","Error","defaultOptions","accessController","write","kvstore","load","createUser","username","password","peersId","peerId","push","user","set","setUser","console","log","identity","open","data","deleteProfileField","key","cid","del","getAllProfileFields","all","getProfileField","get","updateUserField","value","getUserDbId","id"],"sources":["C:/Users/zajan/GitHub/chatApplication/src/data/store/UserStore.js"],"sourcesContent":["import { makeAutoObservable, runInAction } from \"mobx\";\r\nimport User from \"../models/User.js\";\r\n\r\nexport default class UserStore {\r\n  userDb;\r\n  constructor(rootStore) {\r\n    this.rootStore = rootStore;\r\n    this.userDb = undefined;\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  async init() {\r\n    await this.setUserStore();\r\n  }\r\n  isUserStoreReady() {\r\n    return this.userDb;\r\n  }\r\n  async setUserStore() {\r\n    if (this.rootStore.dataStore.orbitDb === undefined) throw Error(\"OrbitDb not defined!\");\r\n    const defaultOptions = { accessController: { write: [\"*\"] } };\r\n\r\n    this.userDb = await this.rootStore.dataStore.orbitDb.kvstore(\"user\", defaultOptions);\r\n    await this.userDb.load();\r\n  }\r\n  async createUser(username, password) {\r\n    const peersId = [];\r\n    const peerId = this.rootStore.dataStore.peerId;\r\n    peersId.push(peerId);\r\n\r\n    const user = new User(username, peersId, password);\r\n\r\n    await this.userDb.set(\"user\", user);\r\n  }\r\n  async setUser(user) {\r\n    console.log(user.identity);\r\n    console.log(user);\r\n    this.userDb = await this.rootStore.dataStore.orbitDb.open(user.identity);\r\n    const peerId = this.rootStore.dataStore.peerId;\r\n    // // console.log(user);\r\n    user.data.user.peerId.push(peerId);\r\n    // // console.log(user);\r\n    await this.userDb.set(\"user\", user);\r\n    console.log(user);\r\n  }\r\n  // async updatePeerId() {\r\n  //   const peerId = this.rootStore.dataStore.peerId;\r\n  //   this.updateUserField(\"peerId\", [...peerId]);\r\n  // }\r\n\r\n  async deleteProfileField(key) {\r\n    const cid = await this.userDb.del(key);\r\n    return cid;\r\n  }\r\n\r\n  getAllProfileFields() {\r\n    return this.userDb.all;\r\n  }\r\n\r\n  getProfileField(key) {\r\n    return this.userDb.get(key);\r\n  }\r\n\r\n  async updateUserField(key, value) {\r\n    const cid = await this.userDb.set(key, value);\r\n    return cid;\r\n  }\r\n\r\n  async getUserDbId() {\r\n    const id = await this.userDb.id;\r\n    return id;\r\n  }\r\n}\r\n"],"mappings":"AAAA,SAASA,kBAAT,EAA6BC,WAA7B,QAAgD,MAAhD;AACA,OAAOC,IAAP,MAAiB,mBAAjB;AAEA,eAAe,MAAMC,SAAN,CAAgB;EAE7BC,WAAW,CAACC,SAAD,EAAY;IACrB,KAAKA,SAAL,GAAiBA,SAAjB;IACA,KAAKC,MAAL,GAAcC,SAAd;IACAP,kBAAkB,CAAC,IAAD,CAAlB;EACD;;EAES,MAAJQ,IAAI,GAAG;IACX,MAAM,KAAKC,YAAL,EAAN;EACD;;EACDC,gBAAgB,GAAG;IACjB,OAAO,KAAKJ,MAAZ;EACD;;EACiB,MAAZG,YAAY,GAAG;IACnB,IAAI,KAAKJ,SAAL,CAAeM,SAAf,CAAyBC,OAAzB,KAAqCL,SAAzC,EAAoD,MAAMM,KAAK,CAAC,sBAAD,CAAX;IACpD,MAAMC,cAAc,GAAG;MAAEC,gBAAgB,EAAE;QAAEC,KAAK,EAAE,CAAC,GAAD;MAAT;IAApB,CAAvB;IAEA,KAAKV,MAAL,GAAc,MAAM,KAAKD,SAAL,CAAeM,SAAf,CAAyBC,OAAzB,CAAiCK,OAAjC,CAAyC,MAAzC,EAAiDH,cAAjD,CAApB;IACA,MAAM,KAAKR,MAAL,CAAYY,IAAZ,EAAN;EACD;;EACe,MAAVC,UAAU,CAACC,QAAD,EAAWC,QAAX,EAAqB;IACnC,MAAMC,OAAO,GAAG,EAAhB;IACA,MAAMC,MAAM,GAAG,KAAKlB,SAAL,CAAeM,SAAf,CAAyBY,MAAxC;IACAD,OAAO,CAACE,IAAR,CAAaD,MAAb;IAEA,MAAME,IAAI,GAAG,IAAIvB,IAAJ,CAASkB,QAAT,EAAmBE,OAAnB,EAA4BD,QAA5B,CAAb;IAEA,MAAM,KAAKf,MAAL,CAAYoB,GAAZ,CAAgB,MAAhB,EAAwBD,IAAxB,CAAN;EACD;;EACY,MAAPE,OAAO,CAACF,IAAD,EAAO;IAClBG,OAAO,CAACC,GAAR,CAAYJ,IAAI,CAACK,QAAjB;IACAF,OAAO,CAACC,GAAR,CAAYJ,IAAZ;IACA,KAAKnB,MAAL,GAAc,MAAM,KAAKD,SAAL,CAAeM,SAAf,CAAyBC,OAAzB,CAAiCmB,IAAjC,CAAsCN,IAAI,CAACK,QAA3C,CAApB;IACA,MAAMP,MAAM,GAAG,KAAKlB,SAAL,CAAeM,SAAf,CAAyBY,MAAxC,CAJkB,CAKlB;;IACAE,IAAI,CAACO,IAAL,CAAUP,IAAV,CAAeF,MAAf,CAAsBC,IAAtB,CAA2BD,MAA3B,EANkB,CAOlB;;IACA,MAAM,KAAKjB,MAAL,CAAYoB,GAAZ,CAAgB,MAAhB,EAAwBD,IAAxB,CAAN;IACAG,OAAO,CAACC,GAAR,CAAYJ,IAAZ;EACD,CAxC4B,CAyC7B;EACA;EACA;EACA;;;EAEwB,MAAlBQ,kBAAkB,CAACC,GAAD,EAAM;IAC5B,MAAMC,GAAG,GAAG,MAAM,KAAK7B,MAAL,CAAY8B,GAAZ,CAAgBF,GAAhB,CAAlB;IACA,OAAOC,GAAP;EACD;;EAEDE,mBAAmB,GAAG;IACpB,OAAO,KAAK/B,MAAL,CAAYgC,GAAnB;EACD;;EAEDC,eAAe,CAACL,GAAD,EAAM;IACnB,OAAO,KAAK5B,MAAL,CAAYkC,GAAZ,CAAgBN,GAAhB,CAAP;EACD;;EAEoB,MAAfO,eAAe,CAACP,GAAD,EAAMQ,KAAN,EAAa;IAChC,MAAMP,GAAG,GAAG,MAAM,KAAK7B,MAAL,CAAYoB,GAAZ,CAAgBQ,GAAhB,EAAqBQ,KAArB,CAAlB;IACA,OAAOP,GAAP;EACD;;EAEgB,MAAXQ,WAAW,GAAG;IAClB,MAAMC,EAAE,GAAG,MAAM,KAAKtC,MAAL,CAAYsC,EAA7B;IACA,OAAOA,EAAP;EACD;;AAnE4B"},"metadata":{},"sourceType":"module"}